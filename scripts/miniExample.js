!function e(t,r,n){function o(d,i){if(!r[d]){if(!t[d]){var h="function"==typeof require&&require;if(!i&&h)return h(d,!0);if(a)return a(d,!0);var s=new Error("Cannot find module '"+d+"'");throw s.code="MODULE_NOT_FOUND",s}var c=r[d]={exports:{}};t[d][0].call(c.exports,function(e){var r=t[d][1][e];return o(r?r:e)},c,c.exports,e,t,r,n)}return r[d].exports}for(var a="function"==typeof require&&require,d=0;d<n.length;d++)o(n[d]);return o}({1:[function(e,t,r){"use strict";var n=e("./tubemap"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n),a=[{name:"A",seq:"AAAA"},{name:"B",seq:"TTG"},{name:"C",seq:"CC"}],d=[{id:0,name:"Track 1",sequence:["A","B","C"]},{id:1,name:"Track 2",sequence:["A","-B","C"]},{id:2,name:"Track 3",sequence:["A","C"]}];o.create({svgID:"#svg",nodes:a,tracks:d}),o.useColorScheme(0)},{"./tubemap":2}],2:[function(e,t,r){"use strict";function n(e){De=e.svgID,Pe=d3.select(e.svgID),Ce=JSON.parse(JSON.stringify(e.nodes)),Ae=JSON.parse(JSON.stringify(e.tracks)),Te=e.reads||null,rt=e.bed||null,je.clickableNodesFlag=e.clickableNodes||!1;c();ue()}function o(e){Ae.unshift(Ae[e]),Ae.splice(e+1,1),a(0)}function a(e){var t=void 0,r=void 0,n=[],o=void 0,a=void 0;for(o=Ae[e].sequence,t=0;t<o.length;t+=1)"-"===o[t].charAt(0)&&(a=o[t].substr(1),(o.indexOf(a)===-1||o.indexOf(a)>t)&&n.push(o[t].substr(1)));for(t=0;t<Ae.length;t+=1)for(o=Ae[t].sequence,r=0;r<o.length;r+=1)"-"!==o[r].charAt(0)?n.indexOf(o[r])!==-1&&(o[r]="-"+o[r]):n.indexOf(o[r].substr(1))!==-1&&(o[r]=o[r].substr(1));Ce.forEach(function(e){n.indexOf(e.name)!==-1&&(e.seq=e.seq.split("").reverse().join(""))})}function d(e){for(var t=0;t<Ae.length&&Ae[t].id!==e;)t+=1;t<Ae.length&&(Ae[t].hasOwnProperty("hidden")?Ae[t].hidden=!Ae[t].hidden:Ae[t].hidden=!0),c()}function i(){je.showExonsFlag=!je.showExonsFlag,c()}function h(e){je.mergeNodesFlag!==e&&(je.mergeNodesFlag=e,Pe=d3.select(De),c())}function s(e){0!==e&&1!==e&&2!==e||je.nodeWidthOption!==e&&(je.nodeWidthOption=e,void 0!==Pe&&(Pe=d3.select(De),c()))}function c(){Ve=[],$e=[],Ge=[],Xe=[],Ke=[],Ye=[],Je=[],ze=[],et=0,tt=0,Pe=d3.select(De),Pe.selectAll("*").remove(),He=JSON.parse(JSON.stringify(Ce)),_e=JSON.parse(JSON.stringify(Ae)),Ue=JSON.parse(JSON.stringify(Te));for(var e=_e.length-1;e>=0;e-=1)_e[e].hasOwnProperty("type")||(_e[e].type="haplo"),_e[e].hasOwnProperty("hidden")&&_e[e].hidden===!0&&_e.splice(e,1);return Re=S(),q(_e),Ue&&q(Ue),je.mergeNodesFlag&&(k(),I(),Ue&&E(),Fe(),Re=S(),q(_e),Ue&&q(Ue)),We=He.length,Be=_e.length,k(),Ee(),A(),be&&console.log(We+" nodes."),I(),Ze=L(),j(),_(),je.showExonsFlag===!0&&null!==rt&&Z(),T(),Ue&&(l(),E(),q(Ue),u(),_e=_e.concat(Ue)),ee(),O(),console.log("Tracks:"),console.log(_e),console.log("Nodes:"),console.log(He),console.log("Lane assignment:"),console.log(Ye),F(),ce(),he(Ve),le(),oe(Ge,Xe),he(Ke),he(Ve,"read"),le("read"),ae(),oe(Ge,Xe,"read"),0===je.nodeWidthOption&&de(),be&&(console.log("number of tracks: "+Be),console.log("number of nodes: "+We)),_e}function l(){Qe=[];for(var e=0;e<=Ze;e+=1)Qe[e]=[];var t=new Map;He.forEach(function(e){e.hasOwnProperty("order")&&e.hasOwnProperty("y")&&(t.has(e.order)?t.set(e.order,Math.max(e.y+e.contentHeight,t.get(e.order))):t.set(e.order,e.y+e.contentHeight))}),He.forEach(function(e,r){e.hasOwnProperty("order")&&!e.hasOwnProperty("y")&&(console.log("adding to "+e.name),e.y=t.get(e.order)+25,e.contentHeight=0,Qe[e.order].push(r))})}function p(){He.forEach(function(e){e.incomingReads=[],e.outgoingReads=[],e.internalReads=[]}),Ue.forEach(function(e,t){e.width=7,1===e.path.length?He[e.path[0].node].internalReads.push(t):e.path.forEach(function(r,n){0===n?He[e.path[0].node].outgoingReads.push([t,n]):null!==e.path[n].node&&He[e.path[n].node].incomingReads.push([t,n])})})}function u(){m(),p();var e=He.slice();e.sort(z),e.forEach(function(e){e.incomingReads.sort(v);var t=e.y+e.contentHeight,r=new Map;e.incomingReads.forEach(function(n){Ue[n[0]].path[n[1]].y=t,f(r,Ue[n[0]],n[1],t,e),t+=7});var n=t;e.outgoingReads.sort(y);var o=new Map;t=e.y+e.contentHeight,e.outgoingReads.forEach(function(a){Ue[a[0]].path[a[1]].y=t,o.set(t,Ue[a[0]].firstNodeOffset),!r.has(t)||r.get(t)+1<Ue[a[0]].firstNodeOffset?(t+=7,n=Math.max(n,t)):(r.set(t,0),e.incomingReads.forEach(function(n){var o=Ue[n[0]],a=o.path[n[1]];a.y>=t&&(a.y+=7,f(r,o,n[1],a.y,e))}),t+=7,n+=7)}),e.internalReads.sort(w),e.internalReads.forEach(function(a){var d=Ue[a];for(t=e.y+e.contentHeight;d.firstNodeOffset<r.get(t)+2||d.finalNodeCoverLength>o.get(t)-3;)t+=7;d.path[0].y=t,r.set(t,d.finalNodeCoverLength),n=Math.max(n,t)});var a=n-e.y-e.contentHeight;e.contentHeight+=a,Q(e,a)});var t=x(),r=[];Ue.forEach(function(e,t){e.path.forEach(function(e,n){e.hasOwnProperty("y")||r.push({readIndex:t,pathIndex:n,previousY:Ue[t].path[n-1].y})})}),r.sort(g),r.forEach(function(e){var r=Ue[e.readIndex].path[e.pathIndex];r.y=t[r.order],t[r.order]+=Ue[e.readIndex].width}),console.log("Reads:"),console.log(Ue)}function f(e,t,r,n,o){r===t.path.length-1?e.set(n,t.finalNodeCoverLength):e.set(n,o.sequenceLength)}function g(e,t){var r=Ue[e.readIndex].path[e.pathIndex],n=Ue[t.readIndex].path[t.pathIndex];return r.order===n.order?e.previousY-t.previousY:r.order-n.order}function y(e,t){for(var r=e[1],n=t[1],o=He[Ue[e[0]].path[r].node],a=He[Ue[t[0]].path[n].node];null!==o&&null!==a&&o===a;){if(r<Ue[e[0]].path.length-1){for(r+=1;null===Ue[e[0]].path[r].node;)r+=1;o=He[Ue[e[0]].path[r].node]}else o=null;if(n<Ue[t[0]].path.length-1){for(n+=1;null===Ue[t[0]].path[n].node;)n+=1;a=He[Ue[t[0]].path[n].node]}else a=null}if(null!==o)return null!==a?z(o,a):1;if(null!==a)return-1;var d=Ue[e[0]].firstNodeOffset-Ue[t[0]].firstNodeOffset;return 0!==d?d:Ue[e[0]].finalNodeCoverLength-Ue[t[0]].finalNodeCoverLength}function v(e,t){var r=Ue[e[0]].path[e[1]-1],n=Ue[t[0]].path[t[1]-1];return r.hasOwnProperty("y")?n.hasOwnProperty("y")?r.y-n.y:-1:n.hasOwnProperty("y")?1:v([e[0],e[1]-1],[t[0],t[1]-1])}function w(e,t){var r=Ue[e],n=Ue[t];return r.firstNodeOffset<n.firstNodeOffset?-1:r.firstNodeOffset>n.firstNodeOffset?1:r.finalNodeCoverLength<n.finalNodeCoverLength?-1:r.finalNodeCoverLength>n.finalNodeCoverLength?1:0}function x(){for(var e=[],t=0;t<=Ze;t+=1)e.push(0);return He.forEach(function(t){e[t.order]=Math.max(e[t.order],t.y+t.contentHeight+20)}),_e.forEach(function(t){t.path.forEach(function(r){e[r.order]=Math.max(e[r.order],r.y+t.width)})}),e}function m(){var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0;Ue.forEach(function(a){e=Math.abs(a.indexSequence[0]),t=a.indexSequence[0]>=0,r=He[e],a.path=[],a.path.push({order:r.order,isForward:t,node:e});for(var d=1;d<a.sequence.length;d+=1)if(n=r,o=t,e=Math.abs(a.indexSequence[d]),t=a.indexSequence[d]>=0,r=He[e],r.order>n.order){o||a.path.push({order:n.order,isForward:!0,node:null});for(var i=n.order+1;i<r.order;i+=1)a.path.push({order:i,isForward:!0,node:null});t?a.path.push({order:r.order,isForward:!0,node:e}):(a.path.push({order:r.order,isForward:!0,node:null}),a.path.push({order:r.order,isForward:!1,node:e}))}else if(r.order<n.order){o&&a.path.push({order:n.order,isForward:!1,node:null});for(var h=n.order-1;h>r.order;h-=1)a.path.push({order:h,isForward:!1,node:null});t?(a.path.push({order:r.order,isForward:!1,node:null}),a.path.push({order:r.order,isForward:!0,node:e})):a.path.push({order:r.order,isForward:!1,node:e})}else t!==o?a.path.push({order:r.order,isForward:t,node:e}):(a.path.push({order:r.order,isForward:!t,node:null}),a.path.push({order:r.order,isForward:t,node:e}))})}function E(){Ue.forEach(function(e){for(var t=0;t<e.sequence.length&&"-"===e.sequence[t].charAt(0);)t+=1;if(t===e.sequence.length){e.sequence=e.sequence.reverse();for(var r=0;r<e.sequence.length;r+=1)e.sequence[r]=e.sequence[r].substr(1);var n=e.firstNodeOffset,o=He[Re.get(e.sequence[0])].sequenceLength;e.firstNodeOffset=o-e.finalNodeCoverLength,o=He[Re.get(e.sequence[e.sequence.length-1])].sequenceLength,e.finalNodeCoverLength=o-n}})}function q(e){e.forEach(function(e){e.indexSequence=[],e.sequence.forEach(function(t){"-"===t.charAt(0)?(t=t.substr(1),e.indexSequence.push(-Re.get(t))):e.indexSequence.push(Re.get(t))})})}function O(){var e=void 0;for(e=He.length-1;e>=0;e-=1)He[e].hasOwnProperty("x")||He.splice(e,1);We=He.length}function F(){var e=-9007199254740991;He.forEach(function(t){t.hasOwnProperty("x")&&(e=Math.max(e,t.x+20+t.pixelWidth))});var t=d3.behavior.zoom().scaleExtent([.1,5]).on("zoom",function(){Pe.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")});Pe=Pe.call(t).on("dblclick.zoom",null).append("g"),t.translate([0,15-tt]),t.event(Pe);var r=d3.select(De);r.attr("height",et-tt+30),r.attr("width",Math.max(e,$(De).parent().width()))}function S(){return Re=new Map,He.forEach(function(e,t){Re.set(e.name,t)}),Re}function k(){var e=void 0,t=void 0;He.forEach(function(e){e.successors=[],e.predecessors=[]}),_e.forEach(function(r){for(var n=0;n<r.indexSequence.length-1;n+=1)e=Math.abs(r.indexSequence[n]),t=Math.abs(r.indexSequence[n+1]),He[e].successors.indexOf(t)===-1&&He[e].successors.push(t),He[t].predecessors.indexOf(e)===-1&&He[t].predecessors.push(e)}),Ue&&Ue.forEach(function(r){for(var n=0;n<r.indexSequence.length-1;n+=1)e=Math.abs(r.indexSequence[n]),t=Math.abs(r.indexSequence[n+1]),He[e].successors.indexOf(t)===-1&&He[e].successors.push(t),He[t].predecessors.indexOf(e)===-1&&He[t].predecessors.push(e)})}function b(e){var t=0,r=0,n=void 0,o=0;e.forEach(function(e){e<0?(n=He[Math.abs(e)],n.hasOwnProperty("order")||(n.order=r),n.order<o&&(o=n.order),t=n.order,r=n.order-1):(n=He[e],n.hasOwnProperty("order")||(n.order=t),t=n.order+1,r=n.order)}),o<0&&P(-o)}function M(e){for(var t=0,r=void 0,n=void 0,o=0,a=void 0;!He[Math.abs(e[t])].hasOwnProperty("order");)t+=1;e[t]>=0?(r=He[e[t]].order-1,a=-1):(r=He[-e[t]].order+1,a=1);for(var d=t-1;d>=0;d-=1)n=He[Math.abs(e[d])],n.hasOwnProperty("order")||(n.order=r,o=Math.min(o,r),r+=a);return o<0&&P(-o),t}function I(){var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0,a=0,d=void 0;d=Ue?_e.concat(Ue):_e,He.forEach(function(e){delete e.order}),b(_e[0].indexSequence);for(var i=1;i<d.length;i+=1)for(be&&console.log("generating order for track "+(i+1)),n=M(d[i].indexSequence),e=D(d[i].indexSequence);n<e.length;){for(o=n,n+=1;n<e.length&&!He[e[n]].hasOwnProperty("order");)n+=1;if(n<e.length){t=He[e[o]].order+1;for(var h=o+1;h<n;h+=1)He[e[h]].order=t,t+=1;if(He[e[n]].order>He[e[o]].order)He[e[n]].order<t&&C(e[n],e[n-1],t);else if(d[i].indexSequence[n]>=0&&!N(e[n],e[o]))C(e[n],e[n-1],t);else if(d[i].sequence[o]<0||He[e[o+1]].degree<2&&He[e[n]].order<He[e[o]].order){t=He[e[o]].order-1;for(var s=o+1;s<n;s+=1)He[e[s]].order=t,t-=1}}else if(d[i].sequence[o]>=0){t=He[e[o]].order+1;for(var c=o+1;c<e.length;c+=1)r=He[e[c]],r.hasOwnProperty("order")||(r.order=t,t+=1)}else{t=He[e[o]].order-1;for(var l=o+1;l<e.length;l+=1)r=He[e[l]],r.hasOwnProperty("order")||(r.order=t,a=Math.min(a,t),t-=1)}}a<0&&P(-a)}function N(e,t){var r=new Array(We).fill(!1),n=[];for(n.push(e),r[e]=!0;n.length>0;){var o=n.pop();if(o===t)return!0;for(var a=0;a<He[o].successors.length;a+=1){var d=He[o].successors[a];r[d]||(r[d]=!0,n.push(d))}}return!1}function L(){var e=-1;return He.forEach(function(t){t.hasOwnProperty("order")&&t.order>e&&(e=t.order)}),e}function D(e){for(var t=[],r=0;r<e.length;r+=1)e[r]>=0?t.push(e[r]):t.push(-e[r]);return t}function P(e){He.forEach(function(t){t.hasOwnProperty("order")&&(t.order+=e)})}function C(e,t,r){var n=new Map,o=[];o.push([e,r]);for(;o.length>0;)!function(){var r=o.shift(),a=r[0],d=r[1];He[a].hasOwnProperty("order")&&He[a].order<d&&(!n.has(a)||n.get(a)<d)&&(n.set(a,d),He[a].successors.forEach(function(e){He[e].order>He[a].order&&e!==t&&o.push([e,d+1])}),a!==e&&He[a].predecessors.forEach(function(e){He[e].order>a.order&&e!==t&&o.push([e,d+1])}))}();n.forEach(function(e,t){He[t].order=e})}function A(){He.forEach(function(e){e.tracks=[]}),_e.forEach(function(e){e.indexSequence.forEach(function(t){He[Math.abs(t)].tracks.push(e.id)})}),He.forEach(function(e){e.hasOwnProperty("tracks")&&(e.degree=e.tracks.length)})}function T(){var e=0,t=20,r=-1,n=He.slice();n.sort(z);var o=H();n.forEach(function(n){n.hasOwnProperty("order")&&(n.order>r&&(r=n.order,e=t+10*o[n.order]),n.x=e,t=Math.max(t,e+40+n.pixelWidth))})}function H(){for(var e=[],t=[],r=[],n=0;n<=Ze;n+=1)e.push(0),t.push(0);_e.forEach(function(r){for(var n=1;n<r.path.length;n+=1)r.path[n].order===r.path[n-1].order&&(r.path[n].isForward===!0?e[r.path[n].order]+=1:t[r.path[n].order]+=1)}),r.push(Math.max(0,e[0]-1));for(var o=1;o<=Ze;o+=1)r.push(Math.max(0,e[o]-1)+Math.max(0,t[o-1]-1));return r}function _(){for(var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0,a=void 0,d=[],i=0;i<=Ze;i+=1){Ye[i]=[],d[i]=[];for(var h=0;h<Be;h+=1)d[i][h]=null}_e.forEach(function(i,h){t=Math.abs(i.indexSequence[0]),r=i.indexSequence[0]>=0,n=He[t],i.path=[],i.path.push({order:n.order,lane:null,isForward:r,node:t}),U(n.order,t,h,0,d),e=1;for(var s=1;s<i.sequence.length;s+=1)if(o=n,a=r,t=Math.abs(i.indexSequence[s]),r=i.indexSequence[s]>=0,n=He[t],n.order>o.order){a||(i.path.push({order:o.order,lane:null,isForward:!0,node:null}),U(o.order,null,h,e,d),e+=1);for(var c=o.order+1;c<n.order;c+=1)i.path.push({order:c,lane:null,isForward:!0,node:null}),U(c,null,h,e,d),e+=1;r?(i.path.push({order:n.order,lane:null,isForward:!0,node:t}),U(n.order,t,h,e,d),e+=1):(i.path.push({order:n.order,lane:null,isForward:!0,node:null}),U(n.order,null,h,e,d),e+=1,i.path.push({order:n.order,lane:null,isForward:!1,node:t}),U(n.order,t,h,e,d),e+=1)}else if(n.order<o.order){a&&(i.path.push({order:o.order,lane:null,isForward:!1,node:null}),U(o.order,null,h,e,d),e+=1);for(var l=o.order-1;l>n.order;l-=1)i.path.push({order:l,lane:null,isForward:!1,node:null}),U(l,null,h,e,d),e+=1;r?(i.path.push({order:n.order,lane:null,isForward:!1,node:null}),U(n.order,null,h,e,d),e+=1,i.path.push({order:n.order,lane:null,isForward:!0,node:t}),U(n.order,t,h,e,d),e+=1):(i.path.push({order:n.order,lane:null,isForward:!1,node:t}),U(n.order,t,h,e,d),e+=1)}else r!==a?(i.path.push({order:n.order,lane:null,isForward:r,node:t}),U(n.order,t,h,e,d),e+=1):(i.path.push({order:n.order,lane:null,isForward:!r,node:null}),U(n.order,null,h,e,d),e+=1,i.path.push({order:n.order,lane:null,isForward:r,node:t}),U(n.order,t,h,e,d),e+=1)});for(var s=0;s<=Ze;s+=1)B(Ye[s],s)}function U(e,t,r,n,o){var a=o[e][r];if(null===t)Ye[e].push({type:"single",node:null,tracks:[{trackID:r,segmentID:n,compareToFromSame:a}]}),o[e][r]=Ye[e][Ye[e].length-1].tracks[0];else{for(var d=0;d<Ye[e].length;d+=1)if(Ye[e][d].node===t)return Ye[e][d].type="multiple",Ye[e][d].tracks.push({trackID:r,segmentID:n,compareToFromSame:a}),void(o[e][r]=Ye[e][d].tracks[Ye[e][d].tracks.length-1]);Ye[e].push({type:"single",node:t,tracks:[{trackID:r,segmentID:n,compareToFromSame:a}]}),o[e][r]=Ye[e][Ye[e].length-1].tracks[0]}}function W(e,t){var r=void 0;e.forEach(function(e){e.idealLane=0,e.tracks.forEach(function(n){if(0===n.segmentID)n.idealLane=n.trackID,n.idealY=null;else if(_e[n.trackID].path[n.segmentID-1].order===t-1)n.idealLane=_e[n.trackID].path[n.segmentID-1].lane,n.idealY=_e[n.trackID].path[n.segmentID-1].y;else if(n.segmentID<_e[n.trackID].path.length-1&&_e[n.trackID].path[n.segmentID+1].order===t-1)n.idealLane=_e[n.trackID].path[n.segmentID+1].lane,n.idealY=_e[n.trackID].path[n.segmentID+1].y;else{for(r=n.segmentID-1;r>=0&&_e[n.trackID].path[r].order!==t-1;)r-=1;r<0?(n.idealLane=n.trackID,n.idealY=null):(n.idealLane=_e[n.trackID].path[r].lane,n.idealY=_e[n.trackID].path[r].y)}e.idealLane+=n.idealLane}),e.idealLane/=e.tracks.length})}function B(e,t){var r=0,n=new Set,o=20,a=!1,d=-1;W(e,t),e.sort(J),e.forEach(function(e){null!==e.node?(He[e.node].topLane=r,a&&(o-=10),He[e.node].y=o,He[e.node].contentHeight=0,a=!1):(a?o-=25:o>20&&(o-=10),a=!0),e.tracks.sort(J),e.tracks.forEach(function(t){t.lane=r,t.trackID===d&&null===e.node&&a&&(o+=10),_e[t.trackID].path[t.segmentID].lane=r,_e[t.trackID].path[t.segmentID].y=o,null!==t.idealY&&n.add(t.idealY-o),r+=1,o+=_e[t.trackID].width,null!==e.node&&(He[e.node].contentHeight+=_e[t.trackID].width),d=t.trackID}),o+=25}),R(e,n)}function R(e,t){var r=0,n=Number.MAX_SAFE_INTEGER;t.forEach(function(t){Y(e,t)<n&&(n=Y(e,t),r=t)}),e.forEach(function(e){null!==e.node&&(He[e.node].y+=r),e.tracks.forEach(function(e){_e[e.trackID].path[e.segmentID].y+=r})})}function Q(e,t){e.hasOwnProperty("order")&&(Ye[e.order].forEach(function(r){if(null!==r.node){var n=He[r.node];n!==e&&n.y>e.y&&(n.y+=t,r.tracks.forEach(function(e){_e[e.trackID].path[e.segmentID].y+=t}))}else r.tracks.forEach(function(r){_e[r.trackID].path[r.segmentID].y>=e.y&&(_e[r.trackID].path[r.segmentID].y+=t)})}),Qe[e.order].length>0&&Qe[e.order].forEach(function(r){He[r]!==e&&He[r].y>e.y&&(He[r].y+=t)}))}function Y(e,t){var r=0;return e.forEach(function(e){e.tracks.forEach(function(e){null!==e.idealY&&"read"!==_e[e.trackID].type&&(r+=Math.abs(e.idealY-t-_e[e.trackID].path[e.segmentID].y)*_e[e.trackID].width)})}),r}function J(e,t){return e.hasOwnProperty("idealLane")?t.hasOwnProperty("idealLane")?e.idealLane<t.idealLane?-1:e.idealLane>t.idealLane?1:0:-1:t.hasOwnProperty("idealLane")?1:0}function z(e,t){if(null===e)return null===t?0:-1;if(null===t)return 1;if(e.hasOwnProperty("order")){if(t.hasOwnProperty("order")){if(e.order<t.order)return-1;if(e.order>t.order)return 1;if(e.hasOwnProperty("y")&&t.hasOwnProperty("y")){if(e.y<t.y)return-1;if(e.y>t.y)return 1}return 0}return-1}return t.hasOwnProperty("order")?1:0}function Z(){var e=void 0,t=void 0,r={};rt.forEach(function(n){for(var o=0;o<Be&&_e[o].name!==n.track;)o+=1;o<Be&&(e=0,_e[o].path.forEach(function(o){null!==o.node&&(r={},t=He[o.node].hasOwnProperty("sequenceLength")?e+He[o.node].sequenceLength-1:e+He[o.node].width-1,e>=n.start&&e<=n.end&&(r.start=0),e<n.start&&t>=n.start&&(r.start=n.start-e),t<=n.end&&t>=n.start&&(r.end=t-e,t<n.end&&(r.continue=!0)),t>n.end&&e<=n.end&&(r.end=n.end-e),r.hasOwnProperty("start")&&(r.type=n.type,r.name=n.name,o.hasOwnProperty("features")||(o.features=[]),o.features.push(r)),e=t+1)}))})}function j(){_e.forEach(function(e){e.hasOwnProperty("freq")?e.width=Math.round(4*(Math.log(e.freq)+1)):(e.width=15,e.hasOwnProperty("type")&&"read"===e.type&&(e.width=4))})}function V(e){je.colorScheme=e,Pe=d3.select(De);c();ue()}function G(e,t){void 0===t&&(t="plain");var r=void 0;return e.hasOwnProperty("type")&&"read"===e.type?(r=Ie[e.id%Ie.length],"-"===e.sequence[0].charAt(0)&&(r=Me[e.id%Me.length])):0===je.colorScheme?r=je.showExonsFlag===!1||"plain"!==t?Ne[e.id%Ne.length]:Le[e.id%Le.length]:1===je.colorScheme&&(r=je.showExonsFlag===!1||"plain"===t?Me[e.id%Me.length]:Ie[e.id%Ie.length]),r}function X(e){var t=void 0,r=void 0,n=He[e.path[0].node],o=n.x-4,a=n.x+n.pixelWidth+4;return e.path[0].isForward?(r=e.firstNodeOffset,t=o+r/n.sequenceLength*(a-o)):(r=e.firstNodeOffset,t=a-r/n.sequenceLength*(a-o)),t}function K(e){var t=void 0,r=void 0,n=He[e.path[e.path.length-1].node],o=n.x-4,a=n.x+n.pixelWidth+4;return e.path[e.path.length-1].isForward?(r=e.finalNodeCoverLength,t=o+r/n.sequenceLength*(a-o)):(r=n.sequenceLength-e.finalNodeCoverLength,t=o+r/n.sequenceLength*(a-o)),t}function ee(){for(var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0,a=void 0,d=void 0,i=void 0,h=0;h<=Ze;h+=1)Je.push(0),ze.push(0);var s=[],c=[];He.forEach(function(e){e.hasOwnProperty("order")&&(s[e.order]=e.x,void 0===c[e.order]?c[e.order]=e.x+e.pixelWidth:c[e.order]=Math.max(c[e.order],e.x+e.pixelWidth))}),_e.forEach(function(h){a="plain",o=G(h,a),r=h.path[0].y,e="read"!==h.type?"-"===h.sequence[0].charAt(0)?c[h.path[0].order]+20:s[h.path[0].order]-20:X(h),et=Math.max(et,r+h.width),tt=Math.min(tt,r);for(var l=0;l<h.path.length;l+=1)h.path[l].y===r?h.path[l].hasOwnProperty("features")&&(i=l>0&&h.path[l-1].order===h.path[l].order,d=te(h.path[l],s[h.path[l].order],c[h.path[l].order],a,h,e,r,o,i),a=d.highlight,e=d.xStart):(t=h.path[l-1].isForward?c[h.path[l-1].order]:s[h.path[l-1].order],t!==e&&(o=G(h,a),Ve.push({xStart:Math.min(e,t),yStart:r,xEnd:Math.max(e,t),yEnd:r+h.width-1,color:o,id:h.id,type:h.type})),h.path[l].order-1===h.path[l-1].order?(e=t,t=s[h.path[l].order],n=h.path[l].y,o=G(h,a),$e.push({xStart:e,yStart:r,xEnd:t+1,yEnd:n,width:h.width,color:o,laneChange:Math.abs(h.path[l].lane-h.path[l-1].lane),id:h.id,type:h.type}),e=t,r=n):h.path[l].order+1===h.path[l-1].order?(e=t,t=c[h.path[l].order],n=h.path[l].y,o=G(h,a),$e.push({xStart:e+1,yStart:r,xEnd:t,yEnd:n,width:h.width,color:o,laneChange:Math.abs(h.path[l].lane-h.path[l-1].lane),id:h.id,type:h.type}),e=t,r=n):h.path[l-1].isForward?(n=h.path[l].y,re(t,r,n,h.width,o,h.id,h.path[l].order,h.type),e=c[h.path[l].order],r=h.path[l].y):(n=h.path[l].y,ne(t,r,n,h.width,o,h.id,h.path[l].order,h.type),e=s[h.path[l].order],r=h.path[l].y),h.path[l].hasOwnProperty("features")&&(i=h.path[l-1].order===h.path[l].order,d=te(h.path[l],s[h.path[l].order],c[h.path[l].order],a,h,e,r,o,i),a=d.highlight,e=d.xStart),et=Math.max(et,r+h.width),tt=Math.min(tt,r));et=Math.max(et,r+h.width),tt=Math.min(tt,r),t="read"!==h.type?h.path[h.path.length-1].isForward?c[h.path[h.path.length-1].order]+20:s[h.path[h.path.length-1].order]-20:K(h),Ve.push({xStart:Math.min(e,t),yStart:r,xEnd:Math.max(e,t),yEnd:r+h.width-1,color:o,id:h.id,type:h.type})})}function te(e,t,r,n,o,a,d,i,h){var s=void 0,c=n,l=void 0,p=void 0,u=void 0,f=void 0;return t-=8,r+=8,s=He[e.node].hasOwnProperty("sequenceLength")?He[e.node].sequenceLength:He[e.node].width,e.features.sort(function(e,t){return e.start-t.start}),e.features.forEach(function(n){c!==n.type&&(l=G(o,c),e.isForward===!0?(u=t+Math.round(n.start*(r-t+1)/s),h&&u<t+8&&(f=t+Math.round((n.end+1)*(r-t+1)/s)-1,p=G(o,n.type),Ke.push({xStart:u,yStart:d,xEnd:f,yEnd:d+o.width-1,color:p,id:o.id,type:o.type})),u>a+1&&Ke.push({xStart:a,yStart:d,xEnd:u-1,yEnd:d+o.width-1,color:l,id:o.id,type:o.type})):(u=r-Math.round(n.start*(r-t+1)/s),h&&u>r-8&&(f=r-Math.round((n.end+1)*(r-t+1)/s)-1,p=G(o,n.type),Ke.push({xStart:f,yStart:d,xEnd:u,yEnd:d+o.width-1,color:p,id:o.id,type:o.type})),a>u+1&&Ke.push({xStart:u+1,yStart:d,xEnd:a,yEnd:d+o.width-1,color:l,id:o.id,type:o.type})),a=u,c=n.type),(n.end<s-1||!n.hasOwnProperty("continue"))&&(l=G(o,c),e.isForward===!0?(f=t+Math.round((n.end+1)*(r-t+1)/s)-1,Ke.push({xStart:a,yStart:d,xEnd:f,yEnd:d+o.width-1,color:l,id:o.id,type:o.type})):(f=r-Math.round((n.end+1)*(r-t+1)/s)-1,Ke.push({xStart:f,yStart:d,xEnd:a,yEnd:d+o.width-1,color:l,id:o.id,type:o.type})),a=f+1,c="plain")}),{xStart:a,highlight:c}}function re(e,t,r,n,o,a,d,i){e+=10*ze[d];var h=Math.min(t,r),s=Math.max(t,r);Xe.push({xStart:e-10*ze[d],yStart:t,xEnd:e+5,yEnd:t+n-1,color:o,id:a,type:i}),Xe.push({xStart:e+5+7,yStart:h+n+7-1,xEnd:e+5+7+Math.min(7,n)-1,yEnd:s-7+1,color:o,id:a,type:i}),Xe.push({xStart:e-10*ze[d],yStart:r,xEnd:e+5,yEnd:r+n-1,color:o,id:a,type:i});var c="M "+(e+5)+" "+s;c+=" Q "+(e+5+7)+" "+s+" "+(e+5+7)+" "+(s-7),c+=" H "+(e+5+7+Math.min(7,n)),c+=" Q "+(e+5+7+Math.min(7,n))+" "+(s+n)+" "+(e+5)+" "+(s+n),c+=" Z ",Ge.push({path:c,color:o,id:a,type:i}),c="M "+(e+5)+" "+h,c+=" Q "+(e+5+7+Math.min(7,n))+" "+h+" "+(e+5+7+Math.min(7,n))+" "+(h+n+7),c+=" H "+(e+5+7),c+=" Q "+(e+5+7)+" "+(h+n)+" "+(e+5)+" "+(h+n),c+=" Z ",Ge.push({path:c,color:o,id:a,type:i}),ze[d]+=1}function ne(e,t,r,n,o,a,d,i){var h=Math.min(t,r),s=Math.max(t,r);e-=10*Je[d],Xe.push({xStart:e-6,yStart:t,xEnd:e+10*Je[d],yEnd:t+n-1,color:o,id:a,type:i}),Xe.push({xStart:e-5-7-Math.min(7,n),yStart:h+n+7-1,xEnd:e-5-7-1,yEnd:s-7+1,color:o,id:a,type:i}),Xe.push({xStart:e-6,yStart:r,xEnd:e+10*Je[d],yEnd:r+n-1,color:o,id:a,type:i});var c="M "+(e-5)+" "+s;c+=" Q "+(e-5-7)+" "+s+" "+(e-5-7)+" "+(s-7),c+=" H "+(e-5-7-Math.min(7,n)),c+=" Q "+(e-5-7-Math.min(7,n))+" "+(s+n)+" "+(e-5)+" "+(s+n),c+=" Z ",Ge.push({path:c,color:o,id:a,type:i}),c="M "+(e-5)+" "+h,c+=" Q "+(e-5-7-Math.min(7,n))+" "+h+" "+(e-5-7-Math.min(7,n))+" "+(h+n+7),c+=" H "+(e-5-7),c+=" Q "+(e-5-7)+" "+(h+n)+" "+(e-5)+" "+(h+n),c+=" Z ",Ge.push({path:c,color:o,id:a,type:i}),Je[d]+=1}function oe(e,t,r){void 0===r&&(r="haplo");var n=new Set;t.forEach(function(e){n.add(e.color)}),n.forEach(function(n){he(t.filter(ie("color",n)),r),pe(e.filter(ie("color",n)),r)})}function ae(){var e=void 0,t=void 0;He.forEach(function(r){r.d="M "+(r.x-9)+" "+r.y+" Q "+(r.x-9)+" "+(r.y-9)+" "+r.x+" "+(r.y-9),e=r.x,t=r.y-9,r.width>1&&(e+=r.pixelWidth,r.d+=" L "+e+" "+t),r.d+=" Q "+(e+9)+" "+t+" "+(e+9)+" "+(t+9),e+=9,t+=9,r.contentHeight>0&&(t+=r.contentHeight-0,r.d+=" L "+e+" "+t),r.d+=" Q "+e+" "+(t+9)+" "+(e-9)+" "+(t+9),e-=9,t+=9,r.width>1&&(e-=r.pixelWidth,r.d+=" L "+e+" "+t),r.d+=" Q "+(e-9)+" "+t+" "+(e-9)+" "+(t-9),e-=9,t-=9,r.contentHeight>0&&(t-=r.contentHeight-0,r.d+=" L "+e+" "+t)}),Pe.selectAll(".node").data(He).enter().append("path").attr("id",function(e){return e.name}).attr("d",function(e){return e.d}).on("mouseover",ge).on("mouseout",ve).on("dblclick",xe).style("fill","#fff").style("fill-opacity",je.showExonsFlag?"0.4":"0.8").style("stroke","black").style("stroke-width","2px").append("svg:title").text(function(e){return e.name})}function de(){0===je.nodeWidthOption&&Pe.selectAll("text").data(He).enter().append("text").attr("x",function(e){return e.x-4}).attr("y",function(e){return e.y+4}).text(function(e){return e.seq}).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none")}function ie(e,t){return function(r){return r[e]===t}}function he(e,t){void 0===t&&(t="haplo"),e=e.filter(ie("type",t)),Pe.selectAll("trackRectangles").data(e).enter().append("rect").attr("x",function(e){return e.xStart}).attr("y",function(e){return e.yStart}).attr("width",function(e){return e.xEnd-e.xStart+1}).attr("height",function(e){return e.yEnd-e.yStart+1}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",fe).on("mouseout",ye).on("dblclick",we)}function se(e,t){return e[6]<t[6]?-1:e[6]>t[6]?1:0}function ce(){var e=Pe.append("defs").append("pattern").attr({id:"patternA",width:"7",height:"7",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"});e.append("rect").attr({x:"0",y:"0",width:"7",height:"7",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"0",y:"4",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"4",y:"0",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"4",y:"4",width:"3",height:"3",fill:"#505050"}),e=Pe.append("defs").append("pattern").attr({id:"patternB",width:"8",height:"8",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"8",height:"8",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"0",y:"5",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"5",y:"0",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"5",y:"5",width:"3",height:"3",fill:"#1f77b4"}),e=Pe.append("defs").append("pattern").attr({id:"plaid0",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#1f77b4"}),e=Pe.append("defs").append("pattern").attr({id:"plaid1",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),e=Pe.append("defs").append("pattern").attr({id:"plaid2",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#2ca02c"}),e=Pe.append("defs").append("pattern").attr({id:"plaid3",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#d62728"}),e=Pe.append("defs").append("pattern").attr({id:"plaid4",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#9467bd"}),e=Pe.append("defs").append("pattern").attr({id:"plaid5",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#8c564b"})}function le(e){void 0===e&&(e="haplo");var t=$e.filter(ie("type",e));t.sort(se),t.forEach(function(e){var t=(e.xStart+e.xEnd)/2,r="M "+e.xStart+" "+e.yStart;r+=" C "+t+" "+e.yStart+" "+t+" "+e.yEnd+" "+e.xEnd+" "+e.yEnd,r+=" V "+(e.yEnd+e.width),r+=" C "+t+" "+(e.yEnd+e.width)+" "+t+" "+(e.yStart+e.width)+" "+e.xStart+" "+(e.yStart+e.width),r+=" Z",e.path=r}),Pe.selectAll("trackCurves").data($e).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",fe).on("mouseout",ye).on("dblclick",we)}function pe(e,t){void 0===t&&(t="haplo"),e=e.filter(ie("type",t)),Pe.selectAll("trackCorners").data(e).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",fe).on("mouseout",ye).on("dblclick",we)}function ue(){for(var e='<table class="table table-condensed table-nonfluid"><thead><tr><th>Color</th><th>Trackname</th><th>Show Track</th></tr></thead>',t=[],r=0;r<_e.length;r+=1)"haplo"===_e[r].type&&(e+='<tr><td><span style="color: '+G(_e[r],"exon")+'"><span class="glyphicon glyphicon-stop" aria-hidden="true"></span></td>',e+=_e[r].hasOwnProperty("name")?"<td>"+_e[r].name+"</td>":"<td>"+_e[r].id+"</td>",e+='<td><input type="checkbox" checked=true id="showTrack'+r+'"></td>',t.push(r));e+="</table",$("#legendDiv").html(e),t.forEach(function(e){document.getElementById("showTrack"+e).addEventListener("click",function(){return d(e)},!1)})}function fe(){var e=d3.select(this).attr("trackID");d3.selectAll(".track"+e).style("fill","url(#patternA)")}function ge(){d3.select(this).style("stroke-width","4px")}
function ye(){var e=d3.select(this).attr("trackID");d3.selectAll(".track"+e).each(function(){var e=d3.select(this).attr("color");d3.select(this).style("fill",e)})}function ve(){d3.select(this).style("stroke-width","2px")}function we(){for(var e=d3.select(this).attr("trackID"),t=0;Ae[t].id!==e;)t+=1;console.log("moving index: "+t),o(t),c()}function xe(){var e=d3.select(this).attr("id");je.clickableNodesFlag&&(Ue?(document.getElementById("hgvmNodeID").value=e,document.getElementById("hgvmPostButton").click()):(document.getElementById("nodeID").value=e,document.getElementById("postButton").click()))}function me(e){var t=[];return e.node.forEach(function(e){t.push({name:""+e.id,sequenceLength:e.sequence.length,seq:e.sequence})}),t}function Ee(){switch(He.forEach(function(e){e.hasOwnProperty("sequenceLength")||(e.sequenceLength=e.seq.length)}),je.nodeWidthOption){case 1:He.forEach(function(e){e.width=1+Math.log(e.sequenceLength)/Math.log(2),e.pixelWidth=Math.round(8.401*(e.width-1))});break;case 2:He.forEach(function(e){e.width=e.sequenceLength/100,e.pixelWidth=Math.round(8.401*(e.width-1))});break;default:He.forEach(function(e){e.width=e.sequenceLength,Pe.append("text").attr("x",0).attr("y",100).attr("id","dummytext").text(e.seq.substr(1)).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none"),e.pixelWidth=Math.round(document.getElementById("dummytext").getComputedTextLength()),$("#dummytext").remove()})}}function qe(e){var t=[];return e.path.forEach(function(e,r){var n=[],o=!0;e.mapping.forEach(function(e){e.position.hasOwnProperty("is_reverse")&&e.position.is_reverse===!0?n.push("-"+e.position.node_id):(n.push(""+e.position.node_id),o=!1)}),o&&(n.reverse(),n.forEach(function(e,t){n[t]=e.substr(1)}));var a={};a.id=r,a.sequence=n,e.hasOwnProperty("freq")&&(a.freq=e.freq),e.hasOwnProperty("name")&&(a.name=e.name),t.push(a)}),t}function Oe(e,t,r){var n=[],o=[];e.forEach(function(e){o.push(parseInt(e.name,10))});for(var a=0;a<r.length;a+=1)!function(e){var a=r[e],d=[],i=-1,h=-1;if(a.path.mapping.forEach(function(e,t){o.indexOf(e.position.node_id)>-1&&(e.position.hasOwnProperty("is_reverse")&&e.position.is_reverse===!0?d.push("-"+e.position.node_id):d.push(""+e.position.node_id),i<0&&(i=t),h=t)}),0===d.length)console.log("read "+e+" is empty");else{var s={};s.id=t.length+n.length,s.sequence=d,s.type="read",a.path.hasOwnProperty("freq")&&(s.freq=a.path.freq),a.path.hasOwnProperty("name")&&(s.name=a.path.name),s.firstNodeOffset=0,a.path.mapping[i].position.hasOwnProperty("offset")&&(s.firstNodeOffset=a.path.mapping[i].position.offset);var c=a.path.mapping[h].edit;s.finalNodeCoverLength=0,a.path.mapping[h].position.hasOwnProperty("offset")&&(s.finalNodeCoverLength+=a.path.mapping[h].position.offset),c.forEach(function(e){e.hasOwnProperty("from_length")&&(s.finalNodeCoverLength+=e.from_length)}),n.push(s)}}(a);return n}function Fe(){for(var e=void 0,t=void 0,r=[],n=[],o=0;o<He.length;o+=1)r.push(new Set),n.push(new Set);var a=void 0;a=Ue?_e.concat(Ue):_e,a.forEach(function(o){for(var a=0;a<o.sequence.length;a+=1)"-"!==o.sequence[a].charAt(0)?(a>0?(e=o.sequence[a-1],r[Re.get(o.sequence[a])].add(e),"-"===e.charAt(0)&&r[Re.get(o.sequence[a])].add(e.substr(1))):"haplo"===o.type&&r[Re.get(o.sequence[a])].add("None"),a<o.sequence.length-1?(e=o.sequence[a+1],n[Re.get(o.sequence[a])].add(e),"-"===e.charAt(0)&&n[Re.get(o.sequence[a])].add(e.substr(1))):"haplo"===o.type&&n[Re.get(o.sequence[a])].add("None")):(e=o.sequence[a].substr(1),a>0?(t=o.sequence[a-1],"-"===t.charAt(0)?n[Re.get(e)].add(t.substr(1)):(n[Re.get(e)].add(t),n[Re.get(e)].add("-"+t))):"haplo"===o.type&&n[Re.get(e)].add("None"),a<o.sequence.length-1?(t=o.sequence[a+1],"-"===t.charAt(0)?r[Re.get(e)].add(t.substr(1)):(r[Re.get(e)].add(t),r[Re.get(e)].add("-"+t))):"haplo"===o.type&&r[Re.get(e)].add("None"))});for(var d=0;d<He.length;d+=1)n[d]=Array.from(n[d]),r[d]=Array.from(r[d]);if(Ue){var i=He.slice();i.sort(z);var h=new Map,s=new Map;i.forEach(function(e){var t=Se(Re.get(e.name),r,n);t?(h.set(e.name,h.get(t)+He[Re.get(t)].sequenceLength),s.set(e.name,s.get(t))):(h.set(e.name,0),s.set(e.name,e.name))}),Ue.forEach(function(e){e.firstNodeOffset+=h.get(e.sequence[0]),e.finalNodeCoverLength+=h.get(e.sequence[e.sequence.length-1]);for(var t=e.sequence.length-1;t>=0;t-=1)if(Se(Re.get(e.sequence[t]),r,n)){var o=Re.get(e.sequence[t]),a=He[o].predecessors[0].toString(),d=(Re.get(a),Se(Re.get(e.sequence[t]),r,n));ke(Re.get(d),r,n)&&(t>0?e.sequence.splice(t,1):e.sequence[0]=s.get(e.sequence[0]))}})}for(var c=0;c<He.length;c+=1)if(ke(c,r,n)&&!Se(c,r,n))for(var l=c;ke(l,r,n);)l=n[l][0],"-"===l.charAt(0)&&(l=l.substr(1)),l=Re.get(l),He[c].hasOwnProperty("sequenceLength")?He[c].sequenceLength+=He[l].sequenceLength:He[c].width+=He[l].width,He[c].seq+=He[l].seq;_e.forEach(function(t){for(var o=t.sequence.length-1;o>=0;o-=1){e=t.sequence[o],"-"===e.charAt(0)&&(e=e.substr(1));Se(Re.get(e),r,n)&&t.sequence.splice(o,1)}}),Ue&&Ue.forEach(function(t){for(var o=t.sequence.length-1;o>=0;o-=1){e=t.sequence[o],"-"===e.charAt(0)&&(e=e.substr(1));Se(Re.get(e),r,n)&&t.sequence.splice(o,1)}});for(var p=He.length-1;p>=0;p-=1)Se(p,r,n)&&He.splice(p,1)}function Se(e,t,r){if(1!==t[e].length)return!1;if("None"===t[e][0])return!1;var n=t[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var o=Re.get(n);return 1===r[o].length&&("None"!==r[o][0]&&n)}function ke(e,t,r){if(1!==r[e].length)return!1;if("None"===r[e][0])return!1;var n=r[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var o=Re.get(n);return 1===t[o].length&&"None"!==t[o][0]}Object.defineProperty(r,"__esModule",{value:!0}),r.create=n,r.changeTrackVisibility=d,r.changeExonVisibility=i,r.setMergeNodesFlag=h,r.setNodeWidthOption=s,r.useColorScheme=V,r.vgExtractNodes=me,r.vgExtractTracks=qe,r.vgExtractReads=Oe;var be=!1,Me=["#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],Ie=["#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],Ne=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],Le=["#ABCCE3","#FFCFA5","#B0DBB0","#F0AEAE","#D7C6E6","#C6ABA5","#F4CCE8","#CFCFCF","#E6E6AC","#A8E7ED"],De=void 0,Pe=void 0,Ce=[],Ae=[],Te=[],He=void 0,_e=void 0,Ue=void 0,We=void 0,Be=void 0,Re=void 0,Qe=void 0,Ye=[],Je=[],ze=[],Ze=void 0,je={mergeNodesFlag:!0,clickableNodesFlag:!1,showExonsFlag:!1,colorScheme:1,nodeWidthOption:0},Ve=[],$e=[],Ge=[],Xe=[],Ke=[],et=0,tt=0,rt=void 0},{}]},{},[1]);