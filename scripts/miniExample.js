!function e(t,r,n){function a(d,i){if(!r[d]){if(!t[d]){var h="function"==typeof require&&require;if(!i&&h)return h(d,!0);if(o)return o(d,!0);var s=new Error("Cannot find module '"+d+"'");throw s.code="MODULE_NOT_FOUND",s}var c=r[d]={exports:{}};t[d][0].call(c.exports,function(e){var r=t[d][1][e];return a(r?r:e)},c,c.exports,e,t,r,n)}return r[d].exports}for(var o="function"==typeof require&&require,d=0;d<n.length;d++)a(n[d]);return a}({1:[function(e,t,r){"use strict";var n=e("./tubemap"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n),o=[{name:"A",seq:"AAAA"},{name:"B",seq:"TTG"},{name:"C",seq:"CC"}],d=[{id:0,name:"Track 1",sequence:["A","B","C"]},{id:1,name:"Track 2",sequence:["A","-B","C"]},{id:2,name:"Track 3",sequence:["A","C"]}];a.create({svgID:"#svg",nodes:o,tracks:d}),a.useColorScheme(0)},{"./tubemap":2}],2:[function(e,t,r){"use strict";function n(e){Te=e.svgID,Be=d3.select(e.svgID),He=JSON.parse(JSON.stringify(e.nodes)),_e=JSON.parse(JSON.stringify(e.tracks)),Ue=e.reads||null,ht=e.bed||null,Xe.clickableNodesFlag=e.clickableNodes||!1;c();ve()}function a(e){_e.unshift(_e[e]),_e.splice(e+1,1),o(0)}function o(e){var t=void 0,r=void 0,n=[],a=void 0,o=void 0;for(a=_e[e].sequence,t=0;t<a.length;t+=1)"-"===a[t].charAt(0)&&(o=a[t].substr(1),(a.indexOf(o)===-1||a.indexOf(o)>t)&&n.push(a[t].substr(1)));for(t=0;t<_e.length;t+=1)for(a=_e[t].sequence,r=0;r<a.length;r+=1)"-"!==a[r].charAt(0)?n.indexOf(a[r])!==-1&&(a[r]="-"+a[r]):n.indexOf(a[r].substr(1))!==-1&&(a[r]=a[r].substr(1));He.forEach(function(e){n.indexOf(e.name)!==-1&&(e.seq=e.seq.split("").reverse().join(""))})}function d(e){for(var t=0;t<_e.length&&_e[t].id!==e;)t+=1;t<_e.length&&(_e[t].hasOwnProperty("hidden")?_e[t].hidden=!_e[t].hidden:_e[t].hidden=!0),c()}function i(){Xe.showExonsFlag=!Xe.showExonsFlag,c()}function h(e){Xe.mergeNodesFlag!==e&&(Xe.mergeNodesFlag=e,Be=d3.select(Te),c())}function s(e){0!==e&&1!==e&&2!==e||Xe.nodeWidthOption!==e&&(Xe.nodeWidthOption=e,void 0!==Be&&(Be=d3.select(Te),c()))}function c(){Ke=[],et=[],tt=[],rt=[],nt=[],je=[],Ve=[],$e=[],at=0,ot=0,dt=0,it=void 0,Be=d3.select(Te),Be.selectAll("*").remove(),We=JSON.parse(JSON.stringify(He)),Re=JSON.parse(JSON.stringify(_e)),Qe=JSON.parse(JSON.stringify(Ue));for(var e=Re.length-1;e>=0;e-=1)Re[e].hasOwnProperty("type")||(Re[e].type="haplo"),Re[e].hasOwnProperty("hidden")&&Re[e].hidden===!0&&Re.splice(e,1),Re[e].hasOwnProperty("indexOfFirstBase")&&(it=Re[e].name);return ze=k(),q(Re),Qe&&q(Qe),Xe.mergeNodesFlag&&(b(),N(),Qe&&E(),Me(),ze=k(),q(Re),Qe&&q(Qe)),Ye=We.length,Je=Re.length,b(),Se(),T(),Le&&console.log(Ye+" nodes."),N(),Ge=D(),V(),_(),Xe.showExonsFlag===!0&&null!==ht&&j(),B(),Qe&&(l(),E(),q(Qe),u(),Re=Re.concat(Qe)),re(),O(),console.log("Tracks:"),console.log(Re),console.log("Nodes:"),console.log(We),console.log("Lane assignment:"),console.log(je),F(),S(),fe(),pe(Ke),ge(),de(tt,rt),pe(nt),pe(Ke,"read"),ge("read"),ie(),de(tt,rt,"read"),0===Xe.nodeWidthOption&&he(),void 0!==it&&(ze=k(),q(Re),Qe&&q(Qe),se()),Le&&(console.log("number of tracks: "+Je),console.log("number of nodes: "+Ye)),Re}function l(){Ze=[];for(var e=0;e<=Ge;e+=1)Ze[e]=[];var t=new Map;We.forEach(function(e){e.hasOwnProperty("order")&&e.hasOwnProperty("y")&&(t.has(e.order)?t.set(e.order,Math.max(e.y+e.contentHeight,t.get(e.order))):t.set(e.order,e.y+e.contentHeight))}),We.forEach(function(e,r){e.hasOwnProperty("order")&&!e.hasOwnProperty("y")&&(console.log("adding to "+e.name),e.y=t.get(e.order)+25,e.contentHeight=0,Ze[e.order].push(r))})}function p(){We.forEach(function(e){e.incomingReads=[],e.outgoingReads=[],e.internalReads=[]}),Qe.forEach(function(e,t){e.width=7,1===e.path.length?We[e.path[0].node].internalReads.push(t):e.path.forEach(function(r,n){0===n?We[e.path[0].node].outgoingReads.push([t,n]):null!==e.path[n].node&&We[e.path[n].node].incomingReads.push([t,n])})})}function u(){m(),p();var e=We.slice();e.sort(Z),e.forEach(function(e){e.incomingReads.sort(v);var t=e.y+e.contentHeight,r=new Map;e.incomingReads.forEach(function(n){Qe[n[0]].path[n[1]].y=t,f(r,Qe[n[0]],n[1],t,e),t+=7});var n=t;e.outgoingReads.sort(y);var a=new Map;t=e.y+e.contentHeight,e.outgoingReads.forEach(function(o){Qe[o[0]].path[o[1]].y=t,a.set(t,Qe[o[0]].firstNodeOffset),!r.has(t)||r.get(t)+1<Qe[o[0]].firstNodeOffset?(t+=7,n=Math.max(n,t)):(r.set(t,0),e.incomingReads.forEach(function(n){var a=Qe[n[0]],o=a.path[n[1]];o.y>=t&&(o.y+=7,f(r,a,n[1],o.y,e))}),t+=7,n+=7)}),e.internalReads.sort(w),e.internalReads.forEach(function(o){var d=Qe[o];for(t=e.y+e.contentHeight;d.firstNodeOffset<r.get(t)+2||d.finalNodeCoverLength>a.get(t)-3;)t+=7;d.path[0].y=t,r.set(t,d.finalNodeCoverLength),n=Math.max(n,t)});var o=n-e.y-e.contentHeight;e.contentHeight+=o,Y(e,o)});var t=x(),r=[];Qe.forEach(function(e,t){e.path.forEach(function(e,n){e.hasOwnProperty("y")||r.push({readIndex:t,pathIndex:n,previousY:Qe[t].path[n-1].y})})}),r.sort(g),r.forEach(function(e){var r=Qe[e.readIndex].path[e.pathIndex];r.y=t[r.order],t[r.order]+=Qe[e.readIndex].width}),console.log("Reads:"),console.log(Qe)}function f(e,t,r,n,a){r===t.path.length-1?e.set(n,t.finalNodeCoverLength):e.set(n,a.sequenceLength)}function g(e,t){var r=Qe[e.readIndex].path[e.pathIndex],n=Qe[t.readIndex].path[t.pathIndex];return r.order===n.order?e.previousY-t.previousY:r.order-n.order}function y(e,t){for(var r=e[1],n=t[1],a=We[Qe[e[0]].path[r].node],o=We[Qe[t[0]].path[n].node];null!==a&&null!==o&&a===o;){if(r<Qe[e[0]].path.length-1){for(r+=1;null===Qe[e[0]].path[r].node;)r+=1;a=We[Qe[e[0]].path[r].node]}else a=null;if(n<Qe[t[0]].path.length-1){for(n+=1;null===Qe[t[0]].path[n].node;)n+=1;o=We[Qe[t[0]].path[n].node]}else o=null}if(null!==a)return null!==o?Z(a,o):1;if(null!==o)return-1;var d=Qe[e[0]].firstNodeOffset-Qe[t[0]].firstNodeOffset;return 0!==d?d:Qe[e[0]].finalNodeCoverLength-Qe[t[0]].finalNodeCoverLength}function v(e,t){var r=Qe[e[0]].path[e[1]-1],n=Qe[t[0]].path[t[1]-1];return r.hasOwnProperty("y")?n.hasOwnProperty("y")?r.y-n.y:-1:n.hasOwnProperty("y")?1:v([e[0],e[1]-1],[t[0],t[1]-1])}function w(e,t){var r=Qe[e],n=Qe[t];return r.firstNodeOffset<n.firstNodeOffset?-1:r.firstNodeOffset>n.firstNodeOffset?1:r.finalNodeCoverLength<n.finalNodeCoverLength?-1:r.finalNodeCoverLength>n.finalNodeCoverLength?1:0}function x(){for(var e=[],t=0;t<=Ge;t+=1)e.push(0);return We.forEach(function(t){e[t.order]=Math.max(e[t.order],t.y+t.contentHeight+20)}),Re.forEach(function(t){t.path.forEach(function(r){e[r.order]=Math.max(e[r.order],r.y+t.width)})}),e}function m(){var e=void 0,t=void 0,r=void 0,n=void 0,a=void 0;Qe.forEach(function(o){e=Math.abs(o.indexSequence[0]),t=o.indexSequence[0]>=0,r=We[e],o.path=[],o.path.push({order:r.order,isForward:t,node:e});for(var d=1;d<o.sequence.length;d+=1)if(n=r,a=t,e=Math.abs(o.indexSequence[d]),t=o.indexSequence[d]>=0,r=We[e],r.order>n.order){a||o.path.push({order:n.order,isForward:!0,node:null});for(var i=n.order+1;i<r.order;i+=1)o.path.push({order:i,isForward:!0,node:null});t?o.path.push({order:r.order,isForward:!0,node:e}):(o.path.push({order:r.order,isForward:!0,node:null}),o.path.push({order:r.order,isForward:!1,node:e}))}else if(r.order<n.order){a&&o.path.push({order:n.order,isForward:!1,node:null});for(var h=n.order-1;h>r.order;h-=1)o.path.push({order:h,isForward:!1,node:null});t?(o.path.push({order:r.order,isForward:!1,node:null}),o.path.push({order:r.order,isForward:!0,node:e})):o.path.push({order:r.order,isForward:!1,node:e})}else t!==a?o.path.push({order:r.order,isForward:t,node:e}):(o.path.push({order:r.order,isForward:!t,node:null}),o.path.push({order:r.order,isForward:t,node:e}))})}function E(){Qe.forEach(function(e){for(var t=0;t<e.sequence.length&&"-"===e.sequence[t].charAt(0);)t+=1;if(t===e.sequence.length){e.sequence=e.sequence.reverse();for(var r=0;r<e.sequence.length;r+=1)e.sequence[r]=e.sequence[r].substr(1);var n=e.firstNodeOffset,a=We[ze.get(e.sequence[0])].sequenceLength;e.firstNodeOffset=a-e.finalNodeCoverLength,a=We[ze.get(e.sequence[e.sequence.length-1])].sequenceLength,e.finalNodeCoverLength=a-n}})}function q(e){e.forEach(function(e){e.indexSequence=[],e.sequence.forEach(function(t){"-"===t.charAt(0)?(t=t.substr(1),e.indexSequence.push(-ze.get(t))):e.indexSequence.push(ze.get(t))})})}function O(){var e=void 0;for(e=We.length-1;e>=0;e-=1)We[e].hasOwnProperty("x")||We.splice(e,1);Ye=We.length}function F(){dt=-99,ot=99,at=-99,We.forEach(function(e){e.hasOwnProperty("x")&&(dt=Math.max(dt,e.x+20+e.pixelWidth)),e.hasOwnProperty("y")&&(ot=Math.min(ot,e.y-10),at=Math.max(at,e.y+e.contentHeight+10))}),Re.forEach(function(e){e.path.forEach(function(t){at=Math.max(at,t.y+e.width),ot=Math.min(ot,t.y)})})}function S(){var e=d3.behavior.zoom().scaleExtent([.1,5]).on("zoom",function(){Be.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")});Be=Be.call(e).on("dblclick.zoom",null).append("g"),e.translate([0,25-ot]),e.event(Be);var t=d3.select(Te);t.attr("height",at-ot+50),t.attr("width",Math.max(dt,$(Te).parent().width()))}function k(){return ze=new Map,We.forEach(function(e,t){ze.set(e.name,t)}),ze}function b(){var e=void 0,t=void 0;We.forEach(function(e){e.successors=[],e.predecessors=[]}),Re.forEach(function(r){for(var n=0;n<r.indexSequence.length-1;n+=1)e=Math.abs(r.indexSequence[n]),t=Math.abs(r.indexSequence[n+1]),We[e].successors.indexOf(t)===-1&&We[e].successors.push(t),We[t].predecessors.indexOf(e)===-1&&We[t].predecessors.push(e)}),Qe&&Qe.forEach(function(r){for(var n=0;n<r.indexSequence.length-1;n+=1)e=Math.abs(r.indexSequence[n]),t=Math.abs(r.indexSequence[n+1]),We[e].successors.indexOf(t)===-1&&We[e].successors.push(t),We[t].predecessors.indexOf(e)===-1&&We[t].predecessors.push(e)})}function M(e){var t=0,r=0,n=void 0,a=0;e.forEach(function(e){e<0?(n=We[Math.abs(e)],n.hasOwnProperty("order")||(n.order=r),n.order<a&&(a=n.order),t=n.order,r=n.order-1):(n=We[e],n.hasOwnProperty("order")||(n.order=t),t=n.order+1,r=n.order)}),a<0&&C(-a)}function I(e){for(var t=0,r=void 0,n=void 0,a=0,o=void 0;!We[Math.abs(e[t])].hasOwnProperty("order");)t+=1;e[t]>=0?(r=We[e[t]].order-1,o=-1):(r=We[-e[t]].order+1,o=1);for(var d=t-1;d>=0;d-=1)n=We[Math.abs(e[d])],n.hasOwnProperty("order")||(n.order=r,a=Math.min(a,r),r+=o);return a<0&&C(-a),t}function N(){var e=void 0,t=void 0,r=void 0,n=void 0,a=void 0,o=0,d=void 0;d=Qe?Re.concat(Qe):Re,We.forEach(function(e){delete e.order}),M(Re[0].indexSequence);for(var i=1;i<d.length;i+=1)for(Le&&console.log("generating order for track "+(i+1)),n=I(d[i].indexSequence),e=P(d[i].indexSequence);n<e.length;){for(a=n,n+=1;n<e.length&&!We[e[n]].hasOwnProperty("order");)n+=1;if(n<e.length){t=We[e[a]].order+1;for(var h=a+1;h<n;h+=1)We[e[h]].order=t,t+=1;if(We[e[n]].order>We[e[a]].order)We[e[n]].order<t&&A(e[n],e[n-1],t);else if(d[i].indexSequence[n]>=0&&!L(e[n],e[a]))A(e[n],e[n-1],t);else if(d[i].sequence[a]<0||We[e[a+1]].degree<2&&We[e[n]].order<We[e[a]].order){t=We[e[a]].order-1;for(var s=a+1;s<n;s+=1)We[e[s]].order=t,t-=1}}else if(d[i].sequence[a]>=0){t=We[e[a]].order+1;for(var c=a+1;c<e.length;c+=1)r=We[e[c]],r.hasOwnProperty("order")||(r.order=t,t+=1)}else{t=We[e[a]].order-1;for(var l=a+1;l<e.length;l+=1)r=We[e[l]],r.hasOwnProperty("order")||(r.order=t,o=Math.min(o,t),t-=1)}}o<0&&C(-o)}function L(e,t){var r=new Array(Ye).fill(!1),n=[];for(n.push(e),r[e]=!0;n.length>0;){var a=n.pop();if(a===t)return!0;for(var o=0;o<We[a].successors.length;o+=1){var d=We[a].successors[o];r[d]||(r[d]=!0,n.push(d))}}return!1}function D(){var e=-1;return We.forEach(function(t){t.hasOwnProperty("order")&&t.order>e&&(e=t.order)}),e}function P(e){for(var t=[],r=0;r<e.length;r+=1)e[r]>=0?t.push(e[r]):t.push(-e[r]);return t}function C(e){We.forEach(function(t){t.hasOwnProperty("order")&&(t.order+=e)})}function A(e,t,r){var n=new Map,a=[];a.push([e,r]);for(;a.length>0;)!function(){var r=a.shift(),o=r[0],d=r[1];We[o].hasOwnProperty("order")&&We[o].order<d&&(!n.has(o)||n.get(o)<d)&&(n.set(o,d),We[o].successors.forEach(function(e){We[e].order>We[o].order&&e!==t&&a.push([e,d+1])}),o!==e&&We[o].predecessors.forEach(function(e){We[e].order>o.order&&e!==t&&a.push([e,d+1])}))}();n.forEach(function(e,t){We[t].order=e})}function T(){We.forEach(function(e){e.tracks=[]}),Re.forEach(function(e){e.indexSequence.forEach(function(t){We[Math.abs(t)].tracks.push(e.id)})}),We.forEach(function(e){e.hasOwnProperty("tracks")&&(e.degree=e.tracks.length)})}function B(){var e=0,t=20,r=-1,n=We.slice();n.sort(Z);var a=H();n.forEach(function(n){n.hasOwnProperty("order")&&(n.order>r&&(r=n.order,e=t+10*a[n.order]),n.x=e,t=Math.max(t,e+40+n.pixelWidth))})}function H(){for(var e=[],t=[],r=[],n=0;n<=Ge;n+=1)e.push(0),t.push(0);Re.forEach(function(r){for(var n=1;n<r.path.length;n+=1)r.path[n].order===r.path[n-1].order&&(r.path[n].isForward===!0?e[r.path[n].order]+=1:t[r.path[n].order]+=1)}),r.push(Math.max(0,e[0]-1));for(var a=1;a<=Ge;a+=1)r.push(Math.max(0,e[a]-1)+Math.max(0,t[a-1]-1));return r}function _(){for(var e=void 0,t=void 0,r=void 0,n=void 0,a=void 0,o=void 0,d=[],i=0;i<=Ge;i+=1){je[i]=[],d[i]=[];for(var h=0;h<Je;h+=1)d[i][h]=null}Re.forEach(function(i,h){t=Math.abs(i.indexSequence[0]),r=i.indexSequence[0]>=0,n=We[t],i.path=[],i.path.push({order:n.order,lane:null,isForward:r,node:t}),U(n.order,t,h,0,d),e=1;for(var s=1;s<i.sequence.length;s+=1)if(a=n,o=r,t=Math.abs(i.indexSequence[s]),r=i.indexSequence[s]>=0,n=We[t],n.order>a.order){o||(i.path.push({order:a.order,lane:null,isForward:!0,node:null}),U(a.order,null,h,e,d),e+=1);for(var c=a.order+1;c<n.order;c+=1)i.path.push({order:c,lane:null,isForward:!0,node:null}),U(c,null,h,e,d),e+=1;r?(i.path.push({order:n.order,lane:null,isForward:!0,node:t}),U(n.order,t,h,e,d),e+=1):(i.path.push({order:n.order,lane:null,isForward:!0,node:null}),U(n.order,null,h,e,d),e+=1,i.path.push({order:n.order,lane:null,isForward:!1,node:t}),U(n.order,t,h,e,d),e+=1)}else if(n.order<a.order){o&&(i.path.push({order:a.order,lane:null,isForward:!1,node:null}),U(a.order,null,h,e,d),e+=1);for(var l=a.order-1;l>n.order;l-=1)i.path.push({order:l,lane:null,isForward:!1,node:null}),U(l,null,h,e,d),e+=1;r?(i.path.push({order:n.order,lane:null,isForward:!1,node:null}),U(n.order,null,h,e,d),e+=1,i.path.push({order:n.order,lane:null,isForward:!0,node:t}),U(n.order,t,h,e,d),e+=1):(i.path.push({order:n.order,lane:null,isForward:!1,node:t}),U(n.order,t,h,e,d),e+=1)}else r!==o?(i.path.push({order:n.order,lane:null,isForward:r,node:t}),U(n.order,t,h,e,d),e+=1):(i.path.push({order:n.order,lane:null,isForward:!r,node:null}),U(n.order,null,h,e,d),e+=1,i.path.push({order:n.order,lane:null,isForward:r,node:t}),U(n.order,t,h,e,d),e+=1)});for(var s=0;s<=Ge;s+=1)R(je[s],s)}function U(e,t,r,n,a){var o=a[e][r];if(null===t)je[e].push({type:"single",node:null,tracks:[{trackID:r,segmentID:n,compareToFromSame:o}]}),a[e][r]=je[e][je[e].length-1].tracks[0];else{for(var d=0;d<je[e].length;d+=1)if(je[e][d].node===t)return je[e][d].type="multiple",je[e][d].tracks.push({trackID:r,segmentID:n,compareToFromSame:o}),void(a[e][r]=je[e][d].tracks[je[e][d].tracks.length-1]);je[e].push({type:"single",node:t,tracks:[{trackID:r,segmentID:n,compareToFromSame:o}]}),a[e][r]=je[e][je[e].length-1].tracks[0]}}function W(e,t){var r=void 0;e.forEach(function(e){e.idealLane=0,e.tracks.forEach(function(n){if(0===n.segmentID)n.idealLane=n.trackID,n.idealY=null;else if(Re[n.trackID].path[n.segmentID-1].order===t-1)n.idealLane=Re[n.trackID].path[n.segmentID-1].lane,n.idealY=Re[n.trackID].path[n.segmentID-1].y;else if(n.segmentID<Re[n.trackID].path.length-1&&Re[n.trackID].path[n.segmentID+1].order===t-1)n.idealLane=Re[n.trackID].path[n.segmentID+1].lane,n.idealY=Re[n.trackID].path[n.segmentID+1].y;else{for(r=n.segmentID-1;r>=0&&Re[n.trackID].path[r].order!==t-1;)r-=1;r<0?(n.idealLane=n.trackID,n.idealY=null):(n.idealLane=Re[n.trackID].path[r].lane,n.idealY=Re[n.trackID].path[r].y)}e.idealLane+=n.idealLane}),e.idealLane/=e.tracks.length})}function R(e,t){var r=0,n=new Set,a=20,o=!1,d=-1;W(e,t),e.sort(z),e.forEach(function(e){null!==e.node?(We[e.node].topLane=r,o&&(a-=10),We[e.node].y=a,We[e.node].contentHeight=0,o=!1):(o?a-=25:a>20&&(a-=10),o=!0),e.tracks.sort(z),e.tracks.forEach(function(t){t.lane=r,t.trackID===d&&null===e.node&&o&&(a+=10),Re[t.trackID].path[t.segmentID].lane=r,Re[t.trackID].path[t.segmentID].y=a,null!==t.idealY&&n.add(t.idealY-a),r+=1,a+=Re[t.trackID].width,null!==e.node&&(We[e.node].contentHeight+=Re[t.trackID].width),d=t.trackID}),a+=25}),Q(e,n)}function Q(e,t){var r=0,n=Number.MAX_SAFE_INTEGER;t.forEach(function(t){J(e,t)<n&&(n=J(e,t),r=t)}),e.forEach(function(e){null!==e.node&&(We[e.node].y+=r),e.tracks.forEach(function(e){Re[e.trackID].path[e.segmentID].y+=r})})}function Y(e,t){e.hasOwnProperty("order")&&(je[e.order].forEach(function(r){if(null!==r.node){var n=We[r.node];n!==e&&n.y>e.y&&(n.y+=t,r.tracks.forEach(function(e){Re[e.trackID].path[e.segmentID].y+=t}))}else r.tracks.forEach(function(r){Re[r.trackID].path[r.segmentID].y>=e.y&&(Re[r.trackID].path[r.segmentID].y+=t)})}),Ze[e.order].length>0&&Ze[e.order].forEach(function(r){We[r]!==e&&We[r].y>e.y&&(We[r].y+=t)}))}function J(e,t){var r=0;return e.forEach(function(e){e.tracks.forEach(function(e){null!==e.idealY&&"read"!==Re[e.trackID].type&&(r+=Math.abs(e.idealY-t-Re[e.trackID].path[e.segmentID].y)*Re[e.trackID].width)})}),r}function z(e,t){return e.hasOwnProperty("idealLane")?t.hasOwnProperty("idealLane")?e.idealLane<t.idealLane?-1:e.idealLane>t.idealLane?1:0:-1:t.hasOwnProperty("idealLane")?1:0}function Z(e,t){if(null===e)return null===t?0:-1;if(null===t)return 1;if(e.hasOwnProperty("order")){if(t.hasOwnProperty("order")){if(e.order<t.order)return-1;if(e.order>t.order)return 1;if(e.hasOwnProperty("y")&&t.hasOwnProperty("y")){if(e.y<t.y)return-1;if(e.y>t.y)return 1}return 0}return-1}return t.hasOwnProperty("order")?1:0}function j(){var e=void 0,t=void 0,r={};ht.forEach(function(n){for(var a=0;a<Je&&Re[a].name!==n.track;)a+=1;a<Je&&(e=0,Re[a].path.forEach(function(a){null!==a.node&&(r={},t=We[a.node].hasOwnProperty("sequenceLength")?e+We[a.node].sequenceLength-1:e+We[a.node].width-1,e>=n.start&&e<=n.end&&(r.start=0),e<n.start&&t>=n.start&&(r.start=n.start-e),t<=n.end&&t>=n.start&&(r.end=t-e,t<n.end&&(r.continue=!0)),t>n.end&&e<=n.end&&(r.end=n.end-e),r.hasOwnProperty("start")&&(r.type=n.type,r.name=n.name,a.hasOwnProperty("features")||(a.features=[]),a.features.push(r)),e=t+1)}))})}function V(){Re.forEach(function(e){e.hasOwnProperty("freq")?e.width=Math.round(4*(Math.log(e.freq)+1)):(e.width=15,e.hasOwnProperty("type")&&"read"===e.type&&(e.width=4))})}function G(e){Xe.colorScheme=e,Be=d3.select(Te);c();ve()}function X(e,t){void 0===t&&(t="plain");var r=void 0;return e.hasOwnProperty("type")&&"read"===e.type?(r=Pe[e.id%Pe.length],"-"===e.sequence[0].charAt(0)&&(r=De[e.id%De.length])):0===Xe.colorScheme?r=Xe.showExonsFlag===!1||"plain"!==t?Ce[e.id%Ce.length]:Ae[e.id%Ae.length]:1===Xe.colorScheme&&(r=Xe.showExonsFlag===!1||"plain"===t?De[e.id%De.length]:Pe[e.id%Pe.length]),r}function K(e){var t=We[e.path[0].node];return e.path[0].isForward?te(t,e.firstNodeOffset):te(t,t.sequenceLength-e.firstNodeOffset)}function ee(e){var t=We[e.path[e.path.length-1].node];return e.path[e.path.length-1].isForward?te(t,e.finalNodeCoverLength):te(t,t.sequenceLength-e.finalNodeCoverLength)}function te(e,t){if(t>e.width)return null;var r=e.x-4,n=e.x+e.pixelWidth+4;return r+t/e.sequenceLength*(n-r)}function re(){for(var e=void 0,t=void 0,r=void 0,n=void 0,a=void 0,o=void 0,d=void 0,i=void 0,h=0;h<=Ge;h+=1)Ve.push(0),$e.push(0);var s=[],c=[];We.forEach(function(e){e.hasOwnProperty("order")&&(s[e.order]=e.x,void 0===c[e.order]?c[e.order]=e.x+e.pixelWidth:c[e.order]=Math.max(c[e.order],e.x+e.pixelWidth))}),Re.forEach(function(h){o="plain",a=X(h,o),r=h.path[0].y,e="read"!==h.type?"-"===h.sequence[0].charAt(0)?c[h.path[0].order]+20:s[h.path[0].order]-20:K(h);for(var l=0;l<h.path.length;l+=1)h.path[l].y===r?h.path[l].hasOwnProperty("features")&&(i=l>0&&h.path[l-1].order===h.path[l].order,d=ne(h.path[l],s[h.path[l].order],c[h.path[l].order],o,h,e,r,a,i),o=d.highlight,e=d.xStart):(t=h.path[l-1].isForward?c[h.path[l-1].order]:s[h.path[l-1].order],t!==e&&(a=X(h,o),Ke.push({xStart:Math.min(e,t),yStart:r,xEnd:Math.max(e,t),yEnd:r+h.width-1,color:a,id:h.id,type:h.type})),h.path[l].order-1===h.path[l-1].order?(e=t,t=s[h.path[l].order],n=h.path[l].y,a=X(h,o),et.push({xStart:e,yStart:r,xEnd:t+1,yEnd:n,width:h.width,color:a,laneChange:Math.abs(h.path[l].lane-h.path[l-1].lane),id:h.id,type:h.type}),e=t,r=n):h.path[l].order+1===h.path[l-1].order?(e=t,t=c[h.path[l].order],n=h.path[l].y,a=X(h,o),et.push({xStart:e+1,yStart:r,xEnd:t,yEnd:n,width:h.width,color:a,laneChange:Math.abs(h.path[l].lane-h.path[l-1].lane),id:h.id,type:h.type}),e=t,r=n):h.path[l-1].isForward?(n=h.path[l].y,ae(t,r,n,h.width,a,h.id,h.path[l].order,h.type),e=c[h.path[l].order],r=h.path[l].y):(n=h.path[l].y,oe(t,r,n,h.width,a,h.id,h.path[l].order,h.type),e=s[h.path[l].order],r=h.path[l].y),h.path[l].hasOwnProperty("features")&&(i=h.path[l-1].order===h.path[l].order,d=ne(h.path[l],s[h.path[l].order],c[h.path[l].order],o,h,e,r,a,i),o=d.highlight,e=d.xStart));t="read"!==h.type?h.path[h.path.length-1].isForward?c[h.path[h.path.length-1].order]+20:s[h.path[h.path.length-1].order]-20:ee(h),Ke.push({xStart:Math.min(e,t),yStart:r,xEnd:Math.max(e,t),yEnd:r+h.width-1,color:a,id:h.id,type:h.type})})}function ne(e,t,r,n,a,o,d,i,h){var s=void 0,c=n,l=void 0,p=void 0,u=void 0,f=void 0;return t-=8,r+=8,s=We[e.node].hasOwnProperty("sequenceLength")?We[e.node].sequenceLength:We[e.node].width,e.features.sort(function(e,t){return e.start-t.start}),e.features.forEach(function(n){c!==n.type&&(l=X(a,c),e.isForward===!0?(u=t+Math.round(n.start*(r-t+1)/s),h&&u<t+8&&(f=t+Math.round((n.end+1)*(r-t+1)/s)-1,p=X(a,n.type),nt.push({xStart:u,yStart:d,xEnd:f,yEnd:d+a.width-1,color:p,id:a.id,type:a.type})),u>o+1&&nt.push({xStart:o,yStart:d,xEnd:u-1,yEnd:d+a.width-1,color:l,id:a.id,type:a.type})):(u=r-Math.round(n.start*(r-t+1)/s),h&&u>r-8&&(f=r-Math.round((n.end+1)*(r-t+1)/s)-1,p=X(a,n.type),nt.push({xStart:f,yStart:d,xEnd:u,yEnd:d+a.width-1,color:p,id:a.id,type:a.type})),o>u+1&&nt.push({xStart:u+1,yStart:d,xEnd:o,yEnd:d+a.width-1,color:l,id:a.id,type:a.type})),o=u,c=n.type),(n.end<s-1||!n.hasOwnProperty("continue"))&&(l=X(a,c),e.isForward===!0?(f=t+Math.round((n.end+1)*(r-t+1)/s)-1,nt.push({xStart:o,yStart:d,xEnd:f,yEnd:d+a.width-1,color:l,id:a.id,type:a.type})):(f=r-Math.round((n.end+1)*(r-t+1)/s)-1,nt.push({xStart:f,yStart:d,xEnd:o,yEnd:d+a.width-1,color:l,id:a.id,type:a.type})),o=f+1,c="plain")}),{xStart:o,highlight:c}}function ae(e,t,r,n,a,o,d,i){e+=10*$e[d];var h=Math.min(t,r),s=Math.max(t,r);rt.push({xStart:e-10*$e[d],yStart:t,xEnd:e+5,yEnd:t+n-1,color:a,id:o,type:i}),rt.push({xStart:e+5+7,yStart:h+n+7-1,xEnd:e+5+7+Math.min(7,n)-1,yEnd:s-7+1,color:a,id:o,type:i}),rt.push({xStart:e-10*$e[d],yStart:r,xEnd:e+5,yEnd:r+n-1,color:a,id:o,type:i});var c="M "+(e+5)+" "+s;c+=" Q "+(e+5+7)+" "+s+" "+(e+5+7)+" "+(s-7),c+=" H "+(e+5+7+Math.min(7,n)),c+=" Q "+(e+5+7+Math.min(7,n))+" "+(s+n)+" "+(e+5)+" "+(s+n),c+=" Z ",tt.push({path:c,color:a,id:o,type:i}),c="M "+(e+5)+" "+h,c+=" Q "+(e+5+7+Math.min(7,n))+" "+h+" "+(e+5+7+Math.min(7,n))+" "+(h+n+7),c+=" H "+(e+5+7),c+=" Q "+(e+5+7)+" "+(h+n)+" "+(e+5)+" "+(h+n),c+=" Z ",tt.push({path:c,color:a,id:o,type:i}),$e[d]+=1}function oe(e,t,r,n,a,o,d,i){var h=Math.min(t,r),s=Math.max(t,r);e-=10*Ve[d],rt.push({xStart:e-6,yStart:t,xEnd:e+10*Ve[d],yEnd:t+n-1,color:a,id:o,type:i}),rt.push({xStart:e-5-7-Math.min(7,n),yStart:h+n+7-1,xEnd:e-5-7-1,yEnd:s-7+1,color:a,id:o,type:i}),rt.push({xStart:e-6,yStart:r,xEnd:e+10*Ve[d],yEnd:r+n-1,color:a,id:o,type:i});var c="M "+(e-5)+" "+s;c+=" Q "+(e-5-7)+" "+s+" "+(e-5-7)+" "+(s-7),c+=" H "+(e-5-7-Math.min(7,n)),c+=" Q "+(e-5-7-Math.min(7,n))+" "+(s+n)+" "+(e-5)+" "+(s+n),c+=" Z ",tt.push({path:c,color:a,id:o,type:i}),c="M "+(e-5)+" "+h,c+=" Q "+(e-5-7-Math.min(7,n))+" "+h+" "+(e-5-7-Math.min(7,n))+" "+(h+n+7),c+=" H "+(e-5-7),c+=" Q "+(e-5-7)+" "+(h+n)+" "+(e-5)+" "+(h+n),c+=" Z ",tt.push({path:c,color:a,id:o,type:i}),Ve[d]+=1}function de(e,t,r){void 0===r&&(r="haplo");var n=new Set;t.forEach(function(e){n.add(e.color)}),n.forEach(function(n){pe(t.filter(le("color",n)),r),ye(e.filter(le("color",n)),r)})}function ie(){var e=void 0,t=void 0;We.forEach(function(r){r.d="M "+(r.x-9)+" "+r.y+" Q "+(r.x-9)+" "+(r.y-9)+" "+r.x+" "+(r.y-9),e=r.x,t=r.y-9,r.width>1&&(e+=r.pixelWidth,r.d+=" L "+e+" "+t),r.d+=" Q "+(e+9)+" "+t+" "+(e+9)+" "+(t+9),e+=9,t+=9,r.contentHeight>0&&(t+=r.contentHeight-0,r.d+=" L "+e+" "+t),r.d+=" Q "+e+" "+(t+9)+" "+(e-9)+" "+(t+9),e-=9,t+=9,r.width>1&&(e-=r.pixelWidth,r.d+=" L "+e+" "+t),r.d+=" Q "+(e-9)+" "+t+" "+(e-9)+" "+(t-9),e-=9,t-=9,r.contentHeight>0&&(t-=r.contentHeight-0,r.d+=" L "+e+" "+t)}),Be.selectAll(".node").data(We).enter().append("path").attr("id",function(e){return e.name}).attr("d",function(e){return e.d}).on("mouseover",xe).on("mouseout",Ee).on("dblclick",Oe).style("fill","#fff").style("fill-opacity",Xe.showExonsFlag?"0.4":"0.8").style("stroke","black").style("stroke-width","2px").append("svg:title").text(function(e){return e.name})}function he(){0===Xe.nodeWidthOption&&Be.selectAll("text").data(We).enter().append("text").attr("x",function(e){return e.x-4}).attr("y",function(e){return e.y+4}).text(function(e){return e.seq}).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none")}function se(){for(var e=0;Re[e].name!==it;)e+=1;var t=Re[e];Be.append("line").attr("x1",0).attr("y1",ot-10).attr("x2",dt).attr("y2",ot-10).attr("stroke-width",1).attr("stroke","black");var r=100;0===Xe.nodeWidthOption&&(r=20);var n=t.indexOfFirstBase,a=!1;t.indexSequence.forEach(function(e){for(var t=We[e],o=Math.ceil(n/r)*r;o<n+t.width;){ce(o,te(t,o-n)),a=!0,o+=r}n+=We[e].width}),a||ce(t.indexOfFirstBase,We[t.indexSequence[0]].x-4)}function ce(e,t){Be.append("text").attr("x",t).attr("y",ot-13).text("|"+e).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","12px").attr("fill","black").style("pointer-events","none")}function le(e,t){return function(r){return r[e]===t}}function pe(e,t){void 0===t&&(t="haplo"),e=e.filter(le("type",t)),Be.selectAll("trackRectangles").data(e).enter().append("rect").attr("x",function(e){return e.xStart}).attr("y",function(e){return e.yStart}).attr("width",function(e){return e.xEnd-e.xStart+1}).attr("height",function(e){return e.yEnd-e.yStart+1}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",we).on("mouseout",me).on("dblclick",qe)}function ue(e,t){return e[6]<t[6]?-1:e[6]>t[6]?1:0}function fe(){var e=Be.append("defs").append("pattern").attr({id:"patternA",width:"7",height:"7",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"});e.append("rect").attr({x:"0",y:"0",width:"7",height:"7",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"0",y:"4",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"4",y:"0",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"4",y:"4",width:"3",height:"3",fill:"#505050"}),e=Be.append("defs").append("pattern").attr({id:"patternB",width:"8",height:"8",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"8",height:"8",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"0",y:"5",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"5",y:"0",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"5",y:"5",width:"3",height:"3",fill:"#1f77b4"}),e=Be.append("defs").append("pattern").attr({id:"plaid0",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#1f77b4"}),e=Be.append("defs").append("pattern").attr({id:"plaid1",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),e=Be.append("defs").append("pattern").attr({id:"plaid2",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#2ca02c"}),e=Be.append("defs").append("pattern").attr({id:"plaid3",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#d62728"}),e=Be.append("defs").append("pattern").attr({id:"plaid4",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#9467bd"}),e=Be.append("defs").append("pattern").attr({id:"plaid5",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#8c564b"})}function ge(e){void 0===e&&(e="haplo");var t=et.filter(le("type",e));t.sort(ue),t.forEach(function(e){var t=(e.xStart+e.xEnd)/2,r="M "+e.xStart+" "+e.yStart;r+=" C "+t+" "+e.yStart+" "+t+" "+e.yEnd+" "+e.xEnd+" "+e.yEnd,r+=" V "+(e.yEnd+e.width),r+=" C "+t+" "+(e.yEnd+e.width)+" "+t+" "+(e.yStart+e.width)+" "+e.xStart+" "+(e.yStart+e.width),r+=" Z",e.path=r}),Be.selectAll("trackCurves").data(et).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",we).on("mouseout",me).on("dblclick",qe)}function ye(e,t){void 0===t&&(t="haplo"),e=e.filter(le("type",t)),Be.selectAll("trackCorners").data(e).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",we).on("mouseout",me).on("dblclick",qe)}function ve(){
for(var e='<table class="table table-condensed table-nonfluid"><thead><tr><th>Color</th><th>Trackname</th><th>Show Track</th></tr></thead>',t=[],r=0;r<Re.length;r+=1)"haplo"===Re[r].type&&(e+='<tr><td><span style="color: '+X(Re[r],"exon")+'"><span class="glyphicon glyphicon-stop" aria-hidden="true"></span></td>',e+=Re[r].hasOwnProperty("name")?"<td>"+Re[r].name+"</td>":"<td>"+Re[r].id+"</td>",e+='<td><input type="checkbox" checked=true id="showTrack'+r+'"></td>',t.push(r));e+="</table",$("#legendDiv").html(e),t.forEach(function(e){document.getElementById("showTrack"+e).addEventListener("click",function(){return d(e)},!1)})}function we(){var e=d3.select(this).attr("trackID");d3.selectAll(".track"+e).style("fill","url(#patternA)")}function xe(){d3.select(this).style("stroke-width","4px")}function me(){var e=d3.select(this).attr("trackID");d3.selectAll(".track"+e).each(function(){var e=d3.select(this).attr("color");d3.select(this).style("fill",e)})}function Ee(){d3.select(this).style("stroke-width","2px")}function qe(){for(var e=d3.select(this).attr("trackID"),t=0;_e[t].id!==e;)t+=1;console.log("moving index: "+t),a(t),c()}function Oe(){var e=d3.select(this).attr("id");Xe.clickableNodesFlag&&(Qe?(document.getElementById("hgvmNodeID").value=e,document.getElementById("hgvmPostButton").click()):(document.getElementById("nodeID").value=e,document.getElementById("postButton").click()))}function Fe(e){var t=[];return e.node.forEach(function(e){t.push({name:""+e.id,sequenceLength:e.sequence.length,seq:e.sequence})}),t}function Se(){switch(We.forEach(function(e){e.hasOwnProperty("sequenceLength")||(e.sequenceLength=e.seq.length)}),Xe.nodeWidthOption){case 1:We.forEach(function(e){e.width=1+Math.log(e.sequenceLength)/Math.log(2),e.pixelWidth=Math.round(8.401*(e.width-1))});break;case 2:We.forEach(function(e){e.width=e.sequenceLength/100,e.pixelWidth=Math.round(8.401*(e.width-1))});break;default:We.forEach(function(e){e.width=e.sequenceLength,Be.append("text").attr("x",0).attr("y",100).attr("id","dummytext").text(e.seq.substr(1)).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none"),e.pixelWidth=Math.round(document.getElementById("dummytext").getComputedTextLength()),$("#dummytext").remove()})}}function ke(e){var t=[];return e.path.forEach(function(e,r){var n=[],a=!0;e.mapping.forEach(function(e){e.position.hasOwnProperty("is_reverse")&&e.position.is_reverse===!0?n.push("-"+e.position.node_id):(n.push(""+e.position.node_id),a=!1)}),a&&(n.reverse(),n.forEach(function(e,t){n[t]=e.substr(1)}));var o={};o.id=r,o.sequence=n,e.hasOwnProperty("freq")&&(o.freq=e.freq),e.hasOwnProperty("name")&&(o.name=e.name),e.hasOwnProperty("indexOfFirstBase")&&(o.indexOfFirstBase=Number(e.indexOfFirstBase)),t.push(o)}),t}function be(e,t,r){var n=[],a=[];e.forEach(function(e){a.push(parseInt(e.name,10))});for(var o=0;o<r.length;o+=1)!function(e){var o=r[e],d=[],i=-1,h=-1;if(o.path.mapping.forEach(function(e,t){a.indexOf(e.position.node_id)>-1&&(e.position.hasOwnProperty("is_reverse")&&e.position.is_reverse===!0?d.push("-"+e.position.node_id):d.push(""+e.position.node_id),i<0&&(i=t),h=t)}),0===d.length)console.log("read "+e+" is empty");else{var s={};s.id=t.length+n.length,s.sequence=d,s.type="read",o.path.hasOwnProperty("freq")&&(s.freq=o.path.freq),o.path.hasOwnProperty("name")&&(s.name=o.path.name),s.firstNodeOffset=0,o.path.mapping[i].position.hasOwnProperty("offset")&&(s.firstNodeOffset=o.path.mapping[i].position.offset);var c=o.path.mapping[h].edit;s.finalNodeCoverLength=0,o.path.mapping[h].position.hasOwnProperty("offset")&&(s.finalNodeCoverLength+=o.path.mapping[h].position.offset),c.forEach(function(e){e.hasOwnProperty("from_length")&&(s.finalNodeCoverLength+=e.from_length)}),n.push(s)}}(o);return n}function Me(){for(var e=void 0,t=void 0,r=[],n=[],a=0;a<We.length;a+=1)r.push(new Set),n.push(new Set);var o=void 0;o=Qe?Re.concat(Qe):Re,o.forEach(function(a){for(var o=0;o<a.sequence.length;o+=1)"-"!==a.sequence[o].charAt(0)?(o>0?(e=a.sequence[o-1],r[ze.get(a.sequence[o])].add(e),"-"===e.charAt(0)&&r[ze.get(a.sequence[o])].add(e.substr(1))):"haplo"===a.type&&r[ze.get(a.sequence[o])].add("None"),o<a.sequence.length-1?(e=a.sequence[o+1],n[ze.get(a.sequence[o])].add(e),"-"===e.charAt(0)&&n[ze.get(a.sequence[o])].add(e.substr(1))):"haplo"===a.type&&n[ze.get(a.sequence[o])].add("None")):(e=a.sequence[o].substr(1),o>0?(t=a.sequence[o-1],"-"===t.charAt(0)?n[ze.get(e)].add(t.substr(1)):(n[ze.get(e)].add(t),n[ze.get(e)].add("-"+t))):"haplo"===a.type&&n[ze.get(e)].add("None"),o<a.sequence.length-1?(t=a.sequence[o+1],"-"===t.charAt(0)?r[ze.get(e)].add(t.substr(1)):(r[ze.get(e)].add(t),r[ze.get(e)].add("-"+t))):"haplo"===a.type&&r[ze.get(e)].add("None"))});for(var d=0;d<We.length;d+=1)n[d]=Array.from(n[d]),r[d]=Array.from(r[d]);if(Qe){var i=We.slice();i.sort(Z);var h=new Map,s=new Map;i.forEach(function(e){var t=Ie(ze.get(e.name),r,n);t?(h.set(e.name,h.get(t)+We[ze.get(t)].sequenceLength),s.set(e.name,s.get(t))):(h.set(e.name,0),s.set(e.name,e.name))}),Qe.forEach(function(e){e.firstNodeOffset+=h.get(e.sequence[0]),e.finalNodeCoverLength+=h.get(e.sequence[e.sequence.length-1]);for(var t=e.sequence.length-1;t>=0;t-=1)if(Ie(ze.get(e.sequence[t]),r,n)){var a=ze.get(e.sequence[t]),o=We[a].predecessors[0].toString(),d=(ze.get(o),Ie(ze.get(e.sequence[t]),r,n));Ne(ze.get(d),r,n)&&(t>0?e.sequence.splice(t,1):e.sequence[0]=s.get(e.sequence[0]))}})}for(var c=0;c<We.length;c+=1)if(Ne(c,r,n)&&!Ie(c,r,n))for(var l=c;Ne(l,r,n);)l=n[l][0],"-"===l.charAt(0)&&(l=l.substr(1)),l=ze.get(l),We[c].hasOwnProperty("sequenceLength")?We[c].sequenceLength+=We[l].sequenceLength:We[c].width+=We[l].width,We[c].seq+=We[l].seq;Re.forEach(function(t){for(var a=t.sequence.length-1;a>=0;a-=1){e=t.sequence[a],"-"===e.charAt(0)&&(e=e.substr(1));Ie(ze.get(e),r,n)&&t.sequence.splice(a,1)}}),Qe&&Qe.forEach(function(t){for(var a=t.sequence.length-1;a>=0;a-=1){e=t.sequence[a],"-"===e.charAt(0)&&(e=e.substr(1));Ie(ze.get(e),r,n)&&t.sequence.splice(a,1)}});for(var p=We.length-1;p>=0;p-=1)Ie(p,r,n)&&We.splice(p,1)}function Ie(e,t,r){if(1!==t[e].length)return!1;if("None"===t[e][0])return!1;var n=t[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var a=ze.get(n);return 1===r[a].length&&("None"!==r[a][0]&&n)}function Ne(e,t,r){if(1!==r[e].length)return!1;if("None"===r[e][0])return!1;var n=r[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var a=ze.get(n);return 1===t[a].length&&"None"!==t[a][0]}Object.defineProperty(r,"__esModule",{value:!0}),r.create=n,r.changeTrackVisibility=d,r.changeExonVisibility=i,r.setMergeNodesFlag=h,r.setNodeWidthOption=s,r.useColorScheme=G,r.vgExtractNodes=Fe,r.vgExtractTracks=ke,r.vgExtractReads=be;var Le=!1,De=["#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],Pe=["#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],Ce=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],Ae=["#ABCCE3","#FFCFA5","#B0DBB0","#F0AEAE","#D7C6E6","#C6ABA5","#F4CCE8","#CFCFCF","#E6E6AC","#A8E7ED"],Te=void 0,Be=void 0,He=[],_e=[],Ue=[],We=void 0,Re=void 0,Qe=void 0,Ye=void 0,Je=void 0,ze=void 0,Ze=void 0,je=[],Ve=[],$e=[],Ge=void 0,Xe={mergeNodesFlag:!0,clickableNodesFlag:!1,showExonsFlag:!1,colorScheme:1,nodeWidthOption:0},Ke=[],et=[],tt=[],rt=[],nt=[],at=0,ot=0,dt=0,it=void 0,ht=void 0},{}]},{},[1]);