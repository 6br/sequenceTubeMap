!function e(t,r,n){function a(d,i){if(!r[d]){if(!t[d]){var h="function"==typeof require&&require;if(!i&&h)return h(d,!0);if(o)return o(d,!0);var s=new Error("Cannot find module '"+d+"'");throw s.code="MODULE_NOT_FOUND",s}var c=r[d]={exports:{}};t[d][0].call(c.exports,function(e){var r=t[d][1][e];return a(r?r:e)},c,c.exports,e,t,r,n)}return r[d].exports}for(var o="function"==typeof require&&require,d=0;d<n.length;d++)a(n[d]);return a}({1:[function(e,t,r){"use strict";var n=e("./tubemap"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n),o=[{name:"A",seq:"AAAA"},{name:"B",seq:"TTG"},{name:"C",seq:"CC"}],d=[{id:0,name:"Track 1",sequence:["A","B","C"]},{id:1,name:"Track 2",sequence:["A","-B","C"]},{id:2,name:"Track 3",sequence:["A","C"]}];a.create({svgID:"#svg",nodes:o,tracks:d}),a.useColorScheme(0)},{"./tubemap":2}],2:[function(e,t,r){"use strict";function n(e){De=e.svgID,Pe=d3.select(e.svgID),Ce=JSON.parse(JSON.stringify(e.nodes)),Ae=JSON.parse(JSON.stringify(e.tracks)),Te=e.reads||null,tt=e.bed||null,Ze.clickableNodesFlag=e.clickableNodes||!1;c();ue()}function a(e){Ae.unshift(Ae[e]),Ae.splice(e+1,1),o(0)}function o(e){var t=void 0,r=void 0,n=[],a=void 0,o=void 0;for(a=Ae[e].sequence,t=0;t<a.length;t+=1)"-"===a[t].charAt(0)&&(o=a[t].substr(1),(a.indexOf(o)===-1||a.indexOf(o)>t)&&n.push(a[t].substr(1)));for(t=0;t<Ae.length;t+=1)for(a=Ae[t].sequence,r=0;r<a.length;r+=1)"-"!==a[r].charAt(0)?n.indexOf(a[r])!==-1&&(a[r]="-"+a[r]):n.indexOf(a[r].substr(1))!==-1&&(a[r]=a[r].substr(1));Ce.forEach(function(e){n.indexOf(e.name)!==-1&&(e.seq=e.seq.split("").reverse().join(""))})}function d(e){for(var t=0;t<Ae.length&&Ae[t].id!==e;)t+=1;t<Ae.length&&(Ae[t].hasOwnProperty("hidden")?Ae[t].hidden=!Ae[t].hidden:Ae[t].hidden=!0),c()}function i(){Ze.showExonsFlag=!Ze.showExonsFlag,c()}function h(e){Ze.mergeNodesFlag!==e&&(Ze.mergeNodesFlag=e,Pe=d3.select(De),c())}function s(e){0!==e&&1!==e&&2!==e||Ze.nodeWidthOption!==e&&(Ze.nodeWidthOption=e,void 0!==Pe&&(Pe=d3.select(De),c()))}function c(){je=[],Ve=[],$e=[],Ge=[],Xe=[],Qe=[],Ye=[],Je=[],Ke=0,et=0,Pe=d3.select(De),Pe.selectAll("*").remove(),_e=JSON.parse(JSON.stringify(Ce)),Ue=JSON.parse(JSON.stringify(Ae)),We=JSON.parse(JSON.stringify(Te));for(var e=Ue.length-1;e>=0;e-=1)Ue[e].hasOwnProperty("type")||(Ue[e].type="haplo"),Ue[e].hasOwnProperty("hidden")&&Ue[e].hidden===!0&&Ue.splice(e,1);return Be=k(),q(Ue),Ze.mergeNodesFlag&&(S(),I(),We&&E(),Oe(),Be=k(),q(Ue)),Re=_e.length,He=Ue.length,S(),Ee(),A(),be&&console.log(Re+" nodes."),I(),ze=L(),j(),U(),Ze.showExonsFlag===!0&&null!==tt&&Z(),T(),We&&(p(),E(),q(We),u(),Ue=Ue.concat(We)),ee(),F(),console.log("Tracks:"),console.log(Ue),console.log("Nodes:"),console.log(_e),console.log("Lane assignment:"),console.log(Qe),O(),ce(),he(je),le(),ae($e,Ge),he(Xe),he(je,"read"),le("read"),oe(),ae($e,Ge,"read"),0===Ze.nodeWidthOption&&de(),be&&(console.log("number of tracks: "+He),console.log("number of nodes: "+Re)),Ue}function l(){_e.forEach(function(e){e.incomingReads=[],e.outgoingReads=[],e.internalReads=[]}),We.forEach(function(e,t){e.width=7,1===e.path.length?_e[e.path[0].node].internalReads.push(t):e.path.forEach(function(r,n){0===n?_e[e.path[0].node].outgoingReads.push([t,n]):null!==e.path[n].node&&_e[e.path[n].node].incomingReads.push([t,n])})})}function p(){We.forEach(function(e){for(var t=e.sequence.length-1;t>=0;t-=1){var r=e.sequence[t];"-"===r.charAt(0)&&(r=r.substr(1)),Be.has(r)&&0!==_e[Be.get(r)].degree||e.sequence.splice(t,1)}})}function u(){m(),l();var e=_e.slice();e.sort(z),e.forEach(function(e){e.incomingReads.sort(v);var t=e.y+e.contentHeight,r=new Map;e.incomingReads.forEach(function(n){We[n[0]].path[n[1]].y=t,f(r,We[n[0]],n[1],t,e),t+=7});var n=t;e.outgoingReads.sort(y);var a=new Map;t=e.y+e.contentHeight,e.outgoingReads.forEach(function(o){We[o[0]].path[o[1]].y=t,a.set(t,We[o[0]].firstNodeOffset),!r.has(t)||r.get(t)+1<We[o[0]].firstNodeOffset?(t+=7,n=Math.max(n,t)):(r.set(t,0),e.incomingReads.forEach(function(n){var a=We[n[0]],o=a.path[n[1]];o.y>=t&&(o.y+=7,f(r,a,n[1],o.y,e))}),t+=7,n+=7)}),e.internalReads.sort(w),e.internalReads.forEach(function(o){var d=We[o];for(t=e.y+e.contentHeight;d.firstNodeOffset<r.get(t)+2||d.finalNodeCoverLength>a.get(t)-3;)t+=7;d.path[0].y=t,r.set(t,d.finalNodeCoverLength),n=Math.max(n,t)});var o=n-e.y-e.contentHeight;e.contentHeight+=o,Q(e,o)});var t=x(),r=[];We.forEach(function(e,t){e.path.forEach(function(e,n){e.hasOwnProperty("y")||r.push({readIndex:t,pathIndex:n,previousY:We[t].path[n-1].y})})}),r.sort(g),r.forEach(function(e){var r=We[e.readIndex].path[e.pathIndex];r.y=t[r.order],t[r.order]+=We[e.readIndex].width}),console.log("Reads:"),console.log(We)}function f(e,t,r,n,a){r===t.path.length-1?e.set(n,t.finalNodeCoverLength):e.set(n,a.sequenceLength)}function g(e,t){var r=We[e.readIndex].path[e.pathIndex],n=We[t.readIndex].path[t.pathIndex];return r.order===n.order?e.previousY-t.previousY:r.order-n.order}function y(e,t){for(var r=e[1],n=t[1],a=_e[We[e[0]].path[r].node],o=_e[We[t[0]].path[n].node];null!==a&&null!==o&&a===o;){if(r<We[e[0]].path.length-1){for(r+=1;null===We[e[0]].path[r].node;)r+=1;a=_e[We[e[0]].path[r].node]}else a=null;if(n<We[t[0]].path.length-1){for(n+=1;null===We[t[0]].path[n].node;)n+=1;o=_e[We[t[0]].path[n].node]}else o=null}if(null!==a)return null!==o?z(a,o):1;if(null!==o)return-1;var d=We[e[0]].firstNodeOffset-We[t[0]].firstNodeOffset;return 0!==d?d:We[e[0]].finalNodeCoverLength-We[t[0]].finalNodeCoverLength}function v(e,t){var r=We[e[0]].path[e[1]-1],n=We[t[0]].path[t[1]-1];return r.hasOwnProperty("y")?n.hasOwnProperty("y")?r.y-n.y:-1:n.hasOwnProperty("y")?1:v([e[0],e[1]-1],[t[0],t[1]-1])}function w(e,t){var r=We[e],n=We[t];return r.firstNodeOffset<n.firstNodeOffset?-1:r.firstNodeOffset>n.firstNodeOffset?1:r.finalNodeCoverLength<n.finalNodeCoverLength?-1:r.finalNodeCoverLength>n.finalNodeCoverLength?1:0}function x(){for(var e=[],t=0;t<=ze;t+=1)e.push(0);return _e.forEach(function(t){e[t.order]=Math.max(e[t.order],t.y+t.contentHeight+20)}),Ue.forEach(function(t){t.path.forEach(function(r){e[r.order]=Math.max(e[r.order],r.y+t.width)})}),e}function m(){var e=void 0,t=void 0,r=void 0,n=void 0,a=void 0;We.forEach(function(o){e=Math.abs(o.indexSequence[0]),t=o.indexSequence[0]>=0,r=_e[e],o.path=[],o.path.push({order:r.order,isForward:t,node:e});for(var d=1;d<o.sequence.length;d+=1)if(n=r,a=t,e=Math.abs(o.indexSequence[d]),t=o.indexSequence[d]>=0,r=_e[e],r.order>n.order){a||o.path.push({order:n.order,isForward:!0,node:null});for(var i=n.order+1;i<r.order;i+=1)o.path.push({order:i,isForward:!0,node:null});t?o.path.push({order:r.order,isForward:!0,node:e}):(o.path.push({order:r.order,isForward:!0,node:null}),o.path.push({order:r.order,isForward:!1,node:e}))}else if(r.order<n.order){a&&o.path.push({order:n.order,isForward:!1,node:null});for(var h=n.order-1;h>r.order;h-=1)o.path.push({order:h,isForward:!1,node:null});t?(o.path.push({order:r.order,isForward:!1,node:null}),o.path.push({order:r.order,isForward:!0,node:e})):o.path.push({order:r.order,isForward:!1,node:e})}else t!==a?o.path.push({order:r.order,isForward:t,node:e}):(o.path.push({order:r.order,isForward:!t,node:null}),o.path.push({order:r.order,isForward:t,node:e}))})}function E(){We.forEach(function(e){for(var t=0;t<e.sequence.length&&"-"===e.sequence[t].charAt(0);)t+=1;if(t===e.sequence.length){e.sequence=e.sequence.reverse();for(var r=0;r<e.sequence.length;r+=1)e.sequence[r]=e.sequence[r].substr(1);var n=e.firstNodeOffset,a=_e[Be.get(e.sequence[0])].sequenceLength;e.firstNodeOffset=a-e.finalNodeCoverLength,a=_e[Be.get(e.sequence[e.sequence.length-1])].sequenceLength,e.finalNodeCoverLength=a-n}})}function q(e){e.forEach(function(e){e.indexSequence=[],e.sequence.forEach(function(t){"-"===t.charAt(0)?(t=t.substr(1),e.indexSequence.push(-Be.get(t))):e.indexSequence.push(Be.get(t))})})}function F(){var e=void 0;for(e=_e.length-1;e>=0;e-=1)0===_e[e].degree&&_e.splice(e,1);Re=_e.length}function O(){var e=-9007199254740991;_e.forEach(function(t){t.hasOwnProperty("x")&&(e=Math.max(e,t.x+20+t.pixelWidth))});var t=d3.behavior.zoom().scaleExtent([.1,5]).on("zoom",function(){Pe.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")});Pe=Pe.call(t).on("dblclick.zoom",null).append("g"),t.translate([0,15-et]),t.event(Pe);var r=d3.select(De);r.attr("height",Ke-et+30),r.attr("width",Math.max(e,$(De).parent().width()))}function k(){return Be=new Map,_e.forEach(function(e,t){Be.set(e.name,t)}),Be}function S(){var e=void 0,t=void 0;_e.forEach(function(e){e.successors=[],e.predecessors=[]}),Ue.forEach(function(r){for(var n=0;n<r.indexSequence.length-1;n+=1)e=Math.abs(r.indexSequence[n]),t=Math.abs(r.indexSequence[n+1]),_e[e].successors.indexOf(t)===-1&&_e[e].successors.push(t),_e[t].predecessors.indexOf(e)===-1&&_e[t].predecessors.push(e)})}function b(e){var t=0,r=0,n=void 0,a=0;e.forEach(function(e){e<0?(n=_e[Math.abs(e)],n.hasOwnProperty("order")||(n.order=r),n.order<a&&(a=n.order),t=n.order,r=n.order-1):(n=_e[e],n.hasOwnProperty("order")||(n.order=t),t=n.order+1,r=n.order)}),a<0&&P(-a)}function M(e){for(var t=0,r=void 0,n=void 0,a=0,o=void 0;!_e[Math.abs(e[t])].hasOwnProperty("order");)t+=1;e[t]>=0?(r=_e[e[t]].order-1,o=-1):(r=_e[-e[t]].order+1,o=1);for(var d=t-1;d>=0;d-=1)n=_e[Math.abs(e[d])],n.hasOwnProperty("order")||(n.order=r,a=Math.min(a,r),r+=o);return a<0&&P(-a),t}function I(){var e=void 0,t=void 0,r=void 0,n=void 0,a=void 0,o=0;_e.forEach(function(e){delete e.order}),b(Ue[0].indexSequence);for(var d=1;d<Ue.length;d+=1)for(be&&console.log("generating order for track "+(d+1)),n=M(Ue[d].indexSequence),e=D(Ue[d].indexSequence);n<e.length;){for(a=n,n+=1;n<e.length&&!_e[e[n]].hasOwnProperty("order");)n+=1;if(n<e.length){t=_e[e[a]].order+1;for(var i=a+1;i<n;i+=1)_e[e[i]].order=t,t+=1;if(_e[e[n]].order>_e[e[a]].order)_e[e[n]].order<t&&C(e[n],e[n-1],t);else if(Ue[d].indexSequence[n]>=0&&!N(e[n],e[a]))C(e[n],e[n-1],t);else if(Ue[d].sequence[a]<0||_e[e[a+1]].degree<2&&_e[e[n]].order<_e[e[a]].order){t=_e[e[a]].order-1;for(var h=a+1;h<n;h+=1)_e[e[h]].order=t,t-=1}}else if(Ue[d].sequence[a]>=0){t=_e[e[a]].order+1;for(var s=a+1;s<e.length;s+=1)r=_e[e[s]],r.hasOwnProperty("order")||(r.order=t,t+=1)}else{t=_e[e[a]].order-1;for(var c=a+1;c<e.length;c+=1)r=_e[e[c]],r.hasOwnProperty("order")||(r.order=t,o=Math.min(o,t),t-=1)}}o<0&&P(-o)}function N(e,t){var r=new Array(Re).fill(!1),n=[];for(n.push(e),r[e]=!0;n.length>0;){var a=n.pop();if(a===t)return!0;for(var o=0;o<_e[a].successors.length;o+=1){var d=_e[a].successors[o];r[d]||(r[d]=!0,n.push(d))}}return!1}function L(){var e=-1;return _e.forEach(function(t){t.hasOwnProperty("order")&&t.order>e&&(e=t.order)}),e}function D(e){for(var t=[],r=0;r<e.length;r+=1)e[r]>=0?t.push(e[r]):t.push(-e[r]);return t}function P(e){_e.forEach(function(t){t.hasOwnProperty("order")&&(t.order+=e)})}function C(e,t,r){var n=new Map,a=[];a.push([e,r]);for(;a.length>0;)!function(){var r=a.shift(),o=r[0],d=r[1];_e[o].hasOwnProperty("order")&&_e[o].order<d&&(!n.has(o)||n.get(o)<d)&&(n.set(o,d),_e[o].successors.forEach(function(e){_e[e].order>_e[o].order&&e!==t&&a.push([e,d+1])}),o!==e&&_e[o].predecessors.forEach(function(e){_e[e].order>o.order&&e!==t&&a.push([e,d+1])}))}();n.forEach(function(e,t){_e[t].order=e})}function A(){_e.forEach(function(e){e.tracks=[]}),Ue.forEach(function(e){e.indexSequence.forEach(function(t){_e[Math.abs(t)].tracks.push(e.id)})}),_e.forEach(function(e){e.hasOwnProperty("tracks")&&(e.degree=e.tracks.length)})}function T(){var e=0,t=20,r=-1,n=_e.slice();n.sort(z);var a=_();n.forEach(function(n){n.hasOwnProperty("order")&&(n.order>r&&(r=n.order,e=t+10*a[n.order]),n.x=e,t=Math.max(t,e+40+n.pixelWidth))})}function _(){for(var e=[],t=[],r=[],n=0;n<=ze;n+=1)e.push(0),t.push(0);Ue.forEach(function(r){for(var n=1;n<r.path.length;n+=1)r.path[n].order===r.path[n-1].order&&(r.path[n].isForward===!0?e[r.path[n].order]+=1:t[r.path[n].order]+=1)}),r.push(Math.max(0,e[0]-1));for(var a=1;a<=ze;a+=1)r.push(Math.max(0,e[a]-1)+Math.max(0,t[a-1]-1));return r}function U(){for(var e=void 0,t=void 0,r=void 0,n=void 0,a=void 0,o=void 0,d=[],i=0;i<=ze;i+=1){Qe[i]=[],d[i]=[];for(var h=0;h<He;h+=1)d[i][h]=null}Ue.forEach(function(i,h){t=Math.abs(i.indexSequence[0]),r=i.indexSequence[0]>=0,n=_e[t],i.path=[],i.path.push({order:n.order,lane:null,isForward:r,node:t}),W(n.order,t,h,0,d),e=1;for(var s=1;s<i.sequence.length;s+=1)if(a=n,o=r,t=Math.abs(i.indexSequence[s]),r=i.indexSequence[s]>=0,n=_e[t],n.order>a.order){o||(i.path.push({order:a.order,lane:null,isForward:!0,node:null}),W(a.order,null,h,e,d),e+=1);for(var c=a.order+1;c<n.order;c+=1)i.path.push({order:c,lane:null,isForward:!0,node:null}),W(c,null,h,e,d),e+=1;r?(i.path.push({order:n.order,lane:null,isForward:!0,node:t}),W(n.order,t,h,e,d),e+=1):(i.path.push({order:n.order,lane:null,isForward:!0,node:null}),W(n.order,null,h,e,d),e+=1,i.path.push({order:n.order,lane:null,isForward:!1,node:t}),W(n.order,t,h,e,d),e+=1)}else if(n.order<a.order){o&&(i.path.push({order:a.order,lane:null,isForward:!1,node:null}),W(a.order,null,h,e,d),e+=1);for(var l=a.order-1;l>n.order;l-=1)i.path.push({order:l,lane:null,isForward:!1,node:null}),W(l,null,h,e,d),e+=1;r?(i.path.push({order:n.order,lane:null,isForward:!1,node:null}),W(n.order,null,h,e,d),e+=1,i.path.push({order:n.order,lane:null,isForward:!0,node:t}),W(n.order,t,h,e,d),e+=1):(i.path.push({order:n.order,lane:null,isForward:!1,node:t}),W(n.order,t,h,e,d),e+=1)}else r!==o?(i.path.push({order:n.order,lane:null,isForward:r,node:t}),W(n.order,t,h,e,d),e+=1):(i.path.push({order:n.order,lane:null,isForward:!r,node:null}),W(n.order,null,h,e,d),e+=1,i.path.push({order:n.order,lane:null,isForward:r,node:t}),W(n.order,t,h,e,d),e+=1)});for(var s=0;s<=ze;s+=1)H(Qe[s],s)}function W(e,t,r,n,a){var o=a[e][r];if(null===t)Qe[e].push({type:"single",node:null,tracks:[{trackID:r,segmentID:n,compareToFromSame:o}]}),a[e][r]=Qe[e][Qe[e].length-1].tracks[0];else{for(var d=0;d<Qe[e].length;d+=1)if(Qe[e][d].node===t)return Qe[e][d].type="multiple",Qe[e][d].tracks.push({trackID:r,segmentID:n,compareToFromSame:o}),void(a[e][r]=Qe[e][d].tracks[Qe[e][d].tracks.length-1]);Qe[e].push({type:"single",node:t,tracks:[{trackID:r,segmentID:n,compareToFromSame:o}]}),a[e][r]=Qe[e][Qe[e].length-1].tracks[0]}}function R(e,t){var r=void 0;e.forEach(function(e){e.idealLane=0,e.tracks.forEach(function(n){if(0===n.segmentID)n.idealLane=n.trackID,n.idealY=null;else if(Ue[n.trackID].path[n.segmentID-1].order===t-1)n.idealLane=Ue[n.trackID].path[n.segmentID-1].lane,n.idealY=Ue[n.trackID].path[n.segmentID-1].y;else if(n.segmentID<Ue[n.trackID].path.length-1&&Ue[n.trackID].path[n.segmentID+1].order===t-1)n.idealLane=Ue[n.trackID].path[n.segmentID+1].lane,n.idealY=Ue[n.trackID].path[n.segmentID+1].y;else{for(r=n.segmentID-1;r>=0&&Ue[n.trackID].path[r].order!==t-1;)r-=1;r<0?(n.idealLane=n.trackID,n.idealY=null):(n.idealLane=Ue[n.trackID].path[r].lane,n.idealY=Ue[n.trackID].path[r].y)}e.idealLane+=n.idealLane}),e.idealLane/=e.tracks.length})}function H(e,t){var r=0,n=new Set,a=20,o=!1,d=-1;R(e,t),e.sort(J),e.forEach(function(e){null!==e.node?(_e[e.node].topLane=r,o&&(a-=10),_e[e.node].y=a,_e[e.node].contentHeight=0,o=!1):(o?a-=25:a>20&&(a-=10),o=!0),e.tracks.sort(J),e.tracks.forEach(function(t){t.lane=r,t.trackID===d&&null===e.node&&o&&(a+=10),Ue[t.trackID].path[t.segmentID].lane=r,Ue[t.trackID].path[t.segmentID].y=a,null!==t.idealY&&n.add(t.idealY-a),r+=1,a+=Ue[t.trackID].width,null!==e.node&&(_e[e.node].contentHeight+=Ue[t.trackID].width),d=t.trackID}),a+=25}),B(e,n)}function B(e,t){var r=0,n=Number.MAX_SAFE_INTEGER;t.forEach(function(t){Y(e,t)<n&&(n=Y(e,t),r=t)}),e.forEach(function(e){null!==e.node&&(_e[e.node].y+=r),e.tracks.forEach(function(e){Ue[e.trackID].path[e.segmentID].y+=r})})}function Q(e,t){e.hasOwnProperty("order")&&Qe[e.order].forEach(function(r){if(null!==r.node){var n=_e[r.node];n!==e&&n.y>e.y&&(n.y+=t,r.tracks.forEach(function(e){Ue[e.trackID].path[e.segmentID].y+=t}))}else r.tracks.forEach(function(r){Ue[r.trackID].path[r.segmentID].y>=e.y&&(Ue[r.trackID].path[r.segmentID].y+=t)})})}function Y(e,t){var r=0;return e.forEach(function(e){e.tracks.forEach(function(e){null!==e.idealY&&"read"!==Ue[e.trackID].type&&(r+=Math.abs(e.idealY-t-Ue[e.trackID].path[e.segmentID].y)*Ue[e.trackID].width)})}),r}function J(e,t){return e.hasOwnProperty("idealLane")?t.hasOwnProperty("idealLane")?e.idealLane<t.idealLane?-1:e.idealLane>t.idealLane?1:0:-1:t.hasOwnProperty("idealLane")?1:0}function z(e,t){if(null===e)return null===t?0:-1;if(null===t)return 1;if(e.hasOwnProperty("order")){if(t.hasOwnProperty("order")){if(e.order<t.order)return-1;if(e.order>t.order)return 1;if(e.hasOwnProperty("y")&&t.hasOwnProperty("y")){if(e.y<t.y)return-1;if(e.y>t.y)return 1}return 0}return-1}return t.hasOwnProperty("order")?1:0}function Z(){var e=void 0,t=void 0,r={};tt.forEach(function(n){for(var a=0;a<He&&Ue[a].name!==n.track;)a+=1;a<He&&(e=0,Ue[a].path.forEach(function(a){null!==a.node&&(r={},t=_e[a.node].hasOwnProperty("sequenceLength")?e+_e[a.node].sequenceLength-1:e+_e[a.node].width-1,e>=n.start&&e<=n.end&&(r.start=0),e<n.start&&t>=n.start&&(r.start=n.start-e),t<=n.end&&t>=n.start&&(r.end=t-e,t<n.end&&(r.continue=!0)),t>n.end&&e<=n.end&&(r.end=n.end-e),r.hasOwnProperty("start")&&(r.type=n.type,r.name=n.name,a.hasOwnProperty("features")||(a.features=[]),a.features.push(r)),e=t+1)}))})}function j(){Ue.forEach(function(e){e.hasOwnProperty("freq")?e.width=Math.round(4*(Math.log(e.freq)+1)):(e.width=15,e.hasOwnProperty("type")&&"read"===e.type&&(e.width=4))})}function V(e){Ze.colorScheme=e,Pe=d3.select(De);c();ue()}function G(e,t){void 0===t&&(t="plain");var r=void 0;return e.hasOwnProperty("type")&&"read"===e.type?(r=Ie[e.id%Ie.length],"-"===e.sequence[0].charAt(0)&&(r=Me[e.id%Me.length])):0===Ze.colorScheme?r=Ze.showExonsFlag===!1||"plain"!==t?Ne[e.id%Ne.length]:Le[e.id%Le.length]:1===Ze.colorScheme&&(r=Ze.showExonsFlag===!1||"plain"===t?Me[e.id%Me.length]:Ie[e.id%Ie.length]),r}function X(e){var t=void 0,r=void 0,n=_e[e.path[0].node],a=n.x-4,o=n.x+n.pixelWidth+4;return e.path[0].isForward?(r=e.firstNodeOffset,t=a+r/n.sequenceLength*(o-a)):(r=e.firstNodeOffset,t=o-r/n.sequenceLength*(o-a)),t}function K(e){var t=void 0,r=void 0,n=_e[e.path[e.path.length-1].node],a=n.x-4,o=n.x+n.pixelWidth+4;return e.path[e.path.length-1].isForward?(r=e.finalNodeCoverLength,t=a+r/n.sequenceLength*(o-a)):(r=n.sequenceLength-e.finalNodeCoverLength,t=a+r/n.sequenceLength*(o-a)),t}function ee(){for(var e=void 0,t=void 0,r=void 0,n=void 0,a=void 0,o=void 0,d=void 0,i=void 0,h=0;h<=ze;h+=1)Ye.push(0),Je.push(0);var s=[],c=[];_e.forEach(function(e){e.hasOwnProperty("order")&&(s[e.order]=e.x,void 0===c[e.order]?c[e.order]=e.x+e.pixelWidth:c[e.order]=Math.max(c[e.order],e.x+e.pixelWidth))}),Ue.forEach(function(h){o="plain",a=G(h,o),r=h.path[0].y,e="read"!==h.type?"-"===h.sequence[0].charAt(0)?c[h.path[0].order]+20:s[h.path[0].order]-20:X(h),Ke=Math.max(Ke,r+h.width),et=Math.min(et,r);for(var l=0;l<h.path.length;l+=1)h.path[l].y===r?h.path[l].hasOwnProperty("features")&&(i=l>0&&h.path[l-1].order===h.path[l].order,d=te(h.path[l],s[h.path[l].order],c[h.path[l].order],o,h,e,r,a,i),o=d.highlight,e=d.xStart):(t=h.path[l-1].isForward?c[h.path[l-1].order]:s[h.path[l-1].order],t!==e&&(a=G(h,o),je.push({xStart:Math.min(e,t),yStart:r,xEnd:Math.max(e,t),yEnd:r+h.width-1,color:a,id:h.id,type:h.type})),h.path[l].order-1===h.path[l-1].order?(e=t,t=s[h.path[l].order],n=h.path[l].y,a=G(h,o),Ve.push({xStart:e,yStart:r,xEnd:t+1,yEnd:n,width:h.width,color:a,laneChange:Math.abs(h.path[l].lane-h.path[l-1].lane),id:h.id,type:h.type}),e=t,r=n):h.path[l].order+1===h.path[l-1].order?(e=t,t=c[h.path[l].order],n=h.path[l].y,a=G(h,o),Ve.push({xStart:e+1,yStart:r,xEnd:t,yEnd:n,width:h.width,color:a,laneChange:Math.abs(h.path[l].lane-h.path[l-1].lane),id:h.id,type:h.type}),e=t,r=n):h.path[l-1].isForward?(n=h.path[l].y,re(t,r,n,h.width,a,h.id,h.path[l].order,h.type),e=c[h.path[l].order],r=h.path[l].y):(n=h.path[l].y,ne(t,r,n,h.width,a,h.id,h.path[l].order,h.type),e=s[h.path[l].order],r=h.path[l].y),h.path[l].hasOwnProperty("features")&&(i=h.path[l-1].order===h.path[l].order,d=te(h.path[l],s[h.path[l].order],c[h.path[l].order],o,h,e,r,a,i),o=d.highlight,e=d.xStart),Ke=Math.max(Ke,r+h.width),et=Math.min(et,r));Ke=Math.max(Ke,r+h.width),et=Math.min(et,r),t="read"!==h.type?h.path[h.path.length-1].isForward?c[h.path[h.path.length-1].order]+20:s[h.path[h.path.length-1].order]-20:K(h),je.push({xStart:Math.min(e,t),yStart:r,xEnd:Math.max(e,t),yEnd:r+h.width-1,color:a,id:h.id,type:h.type})})}function te(e,t,r,n,a,o,d,i,h){var s=void 0,c=n,l=void 0,p=void 0,u=void 0,f=void 0;return t-=8,r+=8,s=_e[e.node].hasOwnProperty("sequenceLength")?_e[e.node].sequenceLength:_e[e.node].width,e.features.sort(function(e,t){return e.start-t.start}),e.features.forEach(function(n){c!==n.type&&(l=G(a,c),e.isForward===!0?(u=t+Math.round(n.start*(r-t+1)/s),h&&u<t+8&&(f=t+Math.round((n.end+1)*(r-t+1)/s)-1,p=G(a,n.type),Xe.push({xStart:u,yStart:d,xEnd:f,yEnd:d+a.width-1,color:p,id:a.id,type:a.type})),u>o+1&&Xe.push({xStart:o,yStart:d,xEnd:u-1,yEnd:d+a.width-1,color:l,id:a.id,type:a.type})):(u=r-Math.round(n.start*(r-t+1)/s),h&&u>r-8&&(f=r-Math.round((n.end+1)*(r-t+1)/s)-1,p=G(a,n.type),Xe.push({xStart:f,yStart:d,xEnd:u,yEnd:d+a.width-1,color:p,id:a.id,type:a.type})),o>u+1&&Xe.push({xStart:u+1,yStart:d,xEnd:o,yEnd:d+a.width-1,color:l,id:a.id,type:a.type})),o=u,c=n.type),(n.end<s-1||!n.hasOwnProperty("continue"))&&(l=G(a,c),e.isForward===!0?(f=t+Math.round((n.end+1)*(r-t+1)/s)-1,Xe.push({xStart:o,yStart:d,xEnd:f,yEnd:d+a.width-1,color:l,id:a.id,type:a.type})):(f=r-Math.round((n.end+1)*(r-t+1)/s)-1,Xe.push({xStart:f,yStart:d,xEnd:o,yEnd:d+a.width-1,color:l,id:a.id,type:a.type})),o=f+1,c="plain")}),{xStart:o,highlight:c}}function re(e,t,r,n,a,o,d,i){e+=10*Je[d];var h=Math.min(t,r),s=Math.max(t,r);Ge.push({xStart:e-10*Je[d],yStart:t,xEnd:e+5,yEnd:t+n-1,color:a,id:o,type:i}),Ge.push({xStart:e+5+7,yStart:h+n+7-1,xEnd:e+5+7+Math.min(7,n)-1,yEnd:s-7+1,color:a,id:o,type:i}),Ge.push({xStart:e-10*Je[d],yStart:r,xEnd:e+5,yEnd:r+n-1,color:a,id:o,type:i});var c="M "+(e+5)+" "+s;c+=" Q "+(e+5+7)+" "+s+" "+(e+5+7)+" "+(s-7),c+=" H "+(e+5+7+Math.min(7,n)),c+=" Q "+(e+5+7+Math.min(7,n))+" "+(s+n)+" "+(e+5)+" "+(s+n),c+=" Z ",$e.push({path:c,color:a,id:o,type:i}),c="M "+(e+5)+" "+h,c+=" Q "+(e+5+7+Math.min(7,n))+" "+h+" "+(e+5+7+Math.min(7,n))+" "+(h+n+7),c+=" H "+(e+5+7),c+=" Q "+(e+5+7)+" "+(h+n)+" "+(e+5)+" "+(h+n),c+=" Z ",$e.push({path:c,color:a,id:o,type:i}),Je[d]+=1}function ne(e,t,r,n,a,o,d,i){var h=Math.min(t,r),s=Math.max(t,r);e-=10*Ye[d],Ge.push({xStart:e-6,yStart:t,xEnd:e+10*Ye[d],yEnd:t+n-1,color:a,id:o,type:i}),Ge.push({xStart:e-5-7-Math.min(7,n),yStart:h+n+7-1,xEnd:e-5-7-1,yEnd:s-7+1,color:a,id:o,type:i}),Ge.push({xStart:e-6,yStart:r,xEnd:e+10*Ye[d],yEnd:r+n-1,color:a,id:o,type:i});var c="M "+(e-5)+" "+s;c+=" Q "+(e-5-7)+" "+s+" "+(e-5-7)+" "+(s-7),c+=" H "+(e-5-7-Math.min(7,n)),c+=" Q "+(e-5-7-Math.min(7,n))+" "+(s+n)+" "+(e-5)+" "+(s+n),c+=" Z ",$e.push({path:c,color:a,id:o,type:i}),c="M "+(e-5)+" "+h,c+=" Q "+(e-5-7-Math.min(7,n))+" "+h+" "+(e-5-7-Math.min(7,n))+" "+(h+n+7),c+=" H "+(e-5-7),c+=" Q "+(e-5-7)+" "+(h+n)+" "+(e-5)+" "+(h+n),c+=" Z ",$e.push({path:c,color:a,id:o,type:i}),Ye[d]+=1}function ae(e,t,r){void 0===r&&(r="haplo");var n=new Set;t.forEach(function(e){n.add(e.color)}),n.forEach(function(n){he(t.filter(ie("color",n)),r),pe(e.filter(ie("color",n)),r)})}function oe(){var e=void 0,t=void 0;_e.forEach(function(r){r.d="M "+(r.x-9)+" "+r.y+" Q "+(r.x-9)+" "+(r.y-9)+" "+r.x+" "+(r.y-9),e=r.x,t=r.y-9,r.width>1&&(e+=r.pixelWidth,r.d+=" L "+e+" "+t),r.d+=" Q "+(e+9)+" "+t+" "+(e+9)+" "+(t+9),e+=9,t+=9,r.contentHeight>0&&(t+=r.contentHeight-0,r.d+=" L "+e+" "+t),r.d+=" Q "+e+" "+(t+9)+" "+(e-9)+" "+(t+9),e-=9,t+=9,r.width>1&&(e-=r.pixelWidth,r.d+=" L "+e+" "+t),r.d+=" Q "+(e-9)+" "+t+" "+(e-9)+" "+(t-9),e-=9,t-=9,r.contentHeight>0&&(t-=r.contentHeight-0,r.d+=" L "+e+" "+t)}),Pe.selectAll(".node").data(_e).enter().append("path").attr("id",function(e){return e.name}).attr("d",function(e){return e.d}).on("mouseover",ge).on("mouseout",ve).on("dblclick",xe).style("fill","#fff").style("fill-opacity",Ze.showExonsFlag?"0.4":"0.8").style("stroke","black").style("stroke-width","2px").append("svg:title").text(function(e){return e.name})}function de(){0===Ze.nodeWidthOption&&Pe.selectAll("text").data(_e).enter().append("text").attr("x",function(e){return e.x-4}).attr("y",function(e){return e.y+4}).text(function(e){return e.seq}).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none")}function ie(e,t){return function(r){return r[e]===t}}function he(e,t){void 0===t&&(t="haplo"),e=e.filter(ie("type",t)),Pe.selectAll("trackRectangles").data(e).enter().append("rect").attr("x",function(e){return e.xStart}).attr("y",function(e){return e.yStart}).attr("width",function(e){return e.xEnd-e.xStart+1}).attr("height",function(e){return e.yEnd-e.yStart+1}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",fe).on("mouseout",ye).on("dblclick",we)}function se(e,t){return e[6]<t[6]?-1:e[6]>t[6]?1:0}function ce(){var e=Pe.append("defs").append("pattern").attr({id:"patternA",width:"7",height:"7",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"});e.append("rect").attr({x:"0",y:"0",width:"7",height:"7",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"0",y:"4",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"4",y:"0",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"4",y:"4",width:"3",height:"3",fill:"#505050"}),e=Pe.append("defs").append("pattern").attr({id:"patternB",width:"8",height:"8",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"8",height:"8",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"0",y:"5",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"5",y:"0",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"5",y:"5",width:"3",height:"3",fill:"#1f77b4"}),e=Pe.append("defs").append("pattern").attr({id:"plaid0",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#1f77b4"}),e=Pe.append("defs").append("pattern").attr({id:"plaid1",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),e=Pe.append("defs").append("pattern").attr({id:"plaid2",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#2ca02c"}),e=Pe.append("defs").append("pattern").attr({id:"plaid3",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#d62728"}),e=Pe.append("defs").append("pattern").attr({id:"plaid4",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#9467bd"}),e=Pe.append("defs").append("pattern").attr({id:"plaid5",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#8c564b"})}function le(e){void 0===e&&(e="haplo");var t=Ve.filter(ie("type",e));t.sort(se),t.forEach(function(e){var t=(e.xStart+e.xEnd)/2,r="M "+e.xStart+" "+e.yStart;r+=" C "+t+" "+e.yStart+" "+t+" "+e.yEnd+" "+e.xEnd+" "+e.yEnd,r+=" V "+(e.yEnd+e.width),r+=" C "+t+" "+(e.yEnd+e.width)+" "+t+" "+(e.yStart+e.width)+" "+e.xStart+" "+(e.yStart+e.width),r+=" Z",e.path=r}),Pe.selectAll("trackCurves").data(Ve).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",fe).on("mouseout",ye).on("dblclick",we)}function pe(e,t){void 0===t&&(t="haplo"),e=e.filter(ie("type",t)),Pe.selectAll("trackCorners").data(e).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",fe).on("mouseout",ye).on("dblclick",we)}function ue(){for(var e='<table class="table table-condensed table-nonfluid"><thead><tr><th>Color</th><th>Trackname</th><th>Show Track</th></tr></thead>',t=[],r=0;r<Ue.length;r+=1)"haplo"===Ue[r].type&&(e+='<tr><td><span style="color: '+G(Ue[r],"exon")+'"><span class="glyphicon glyphicon-stop" aria-hidden="true"></span></td>',e+=Ue[r].hasOwnProperty("name")?"<td>"+Ue[r].name+"</td>":"<td>"+Ue[r].id+"</td>",e+='<td><input type="checkbox" checked=true id="showTrack'+r+'"></td>',t.push(r));e+="</table",$("#legendDiv").html(e),t.forEach(function(e){document.getElementById("showTrack"+e).addEventListener("click",function(){return d(e)},!1)})}function fe(){var e=d3.select(this).attr("trackID");d3.selectAll(".track"+e).style("fill","url(#patternA)")}function ge(){d3.select(this).style("stroke-width","4px")}function ye(){var e=d3.select(this).attr("trackID");d3.selectAll(".track"+e).each(function(){var e=d3.select(this).attr("color");d3.select(this).style("fill",e)})}function ve(){d3.select(this).style("stroke-width","2px")}function we(){for(var e=d3.select(this).attr("trackID"),t=0;Ae[t].id!==e;)t+=1;console.log("moving index: "+t),a(t),c()}function xe(){var e=d3.select(this).attr("id");Ze.clickableNodesFlag&&(document.getElementById("nodeID").value=e,document.getElementById("postButton").click())}function me(e){var t=[];return e.node.forEach(function(e){t.push({name:""+e.id,sequenceLength:e.sequence.length,seq:e.sequence})}),t}
function Ee(){switch(_e.forEach(function(e){e.hasOwnProperty("sequenceLength")||(e.sequenceLength=e.seq.length)}),Ze.nodeWidthOption){case 1:_e.forEach(function(e){e.width=1+Math.log(e.sequenceLength)/Math.log(2),e.pixelWidth=Math.round(8.401*(e.width-1))});break;case 2:_e.forEach(function(e){e.width=e.sequenceLength/100,e.pixelWidth=Math.round(8.401*(e.width-1))});break;default:_e.forEach(function(e){e.width=e.sequenceLength,Pe.append("text").attr("x",0).attr("y",100).attr("id","dummytext").text(e.seq.substr(1)).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none"),e.pixelWidth=Math.round(document.getElementById("dummytext").getComputedTextLength()),$("#dummytext").remove()})}}function qe(e){var t=[];return e.path.forEach(function(e,r){var n=[],a=!0;e.mapping.forEach(function(e){e.position.hasOwnProperty("is_reverse")&&e.position.is_reverse===!0?n.push("-"+e.position.node_id):(n.push(""+e.position.node_id),a=!1)}),a&&(n.reverse(),n.forEach(function(e,t){n[t]=e.substr(1)}));var o={};o.id=r,o.sequence=n,e.hasOwnProperty("freq")&&(o.freq=e.freq),e.hasOwnProperty("name")&&(o.name=e.name),t.push(o)}),t}function Fe(e,t,r){var n=[],a=[];e.forEach(function(e){a.push(parseInt(e.name,10))});for(var o=0;o<r.length;o+=1)!function(e){var o=r[e],d=[],i=-1,h=-1;o.path.mapping.forEach(function(e,t){a.indexOf(e.position.node_id)>-1&&(e.position.hasOwnProperty("is_reverse")&&e.position.is_reverse===!0?d.push("-"+e.position.node_id):d.push(""+e.position.node_id),i<0&&(i=t),h=t)}),0===d.length&&console.log("read "+e+" is empty");var s={};s.id=t.length+n.length,s.sequence=d,s.type="read",o.path.hasOwnProperty("freq")&&(s.freq=o.path.freq),o.path.hasOwnProperty("name")&&(s.name=o.path.name),s.firstNodeOffset=0,o.path.mapping[i].position.hasOwnProperty("offset")&&(s.firstNodeOffset=o.path.mapping[i].position.offset);var c=o.path.mapping[h].edit;s.finalNodeCoverLength=0,o.path.mapping[h].position.hasOwnProperty("offset")&&(s.finalNodeCoverLength+=o.path.mapping[h].position.offset),c.forEach(function(e){e.hasOwnProperty("from_length")&&(s.finalNodeCoverLength+=e.from_length)}),n.push(s)}(o);return n}function Oe(){for(var e=void 0,t=void 0,r=[],n=[],a=0;a<_e.length;a+=1)r.push(new Set),n.push(new Set);Ue.forEach(function(a){if("haplo"===a.type)for(var o=0;o<a.sequence.length;o+=1)"-"!==a.sequence[o].charAt(0)?(o>0?(e=a.sequence[o-1],r[Be.get(a.sequence[o])].add(e),"-"===e.charAt(0)&&r[Be.get(a.sequence[o])].add(e.substr(1))):r[Be.get(a.sequence[o])].add("None"),o<a.sequence.length-1?(e=a.sequence[o+1],n[Be.get(a.sequence[o])].add(e),"-"===e.charAt(0)&&n[Be.get(a.sequence[o])].add(e.substr(1))):n[Be.get(a.sequence[o])].add("None")):(e=a.sequence[o].substr(1),o>0?(t=a.sequence[o-1],"-"===t.charAt(0)?n[Be.get(e)].add(t.substr(1)):(n[Be.get(e)].add(t),n[Be.get(e)].add("-"+t))):n[Be.get(e)].add("None"),o<a.sequence.length-1?(t=a.sequence[o+1],"-"===t.charAt(0)?r[Be.get(e)].add(t.substr(1)):(r[Be.get(e)].add(t),r[Be.get(e)].add("-"+t))):r[Be.get(e)].add("None"))});for(var o=0;o<_e.length;o+=1)n[o]=Array.from(n[o]),r[o]=Array.from(r[o]);if(We){var d=_e.slice();d.sort(z);var i=new Map,h=new Map;d.forEach(function(e){var t=ke(Be.get(e.name),r,n);t?(i.set(e.name,i.get(t)+_e[Be.get(t)].sequenceLength),h.set(e.name,h.get(t))):(i.set(e.name,0),h.set(e.name,e.name))}),We.forEach(function(e){e.firstNodeOffset+=i.get(e.sequence[0]),e.finalNodeCoverLength+=i.get(e.sequence[e.sequence.length-1]);for(var t=e.sequence.length-1;t>=0;t-=1)if(ke(Be.get(e.sequence[t]),r,n)){var a=Be.get(e.sequence[t]),o=_e[a].predecessors[0].toString(),d=(Be.get(o),ke(Be.get(e.sequence[t]),r,n));Se(Be.get(d),r,n)&&(t>0?e.sequence.splice(t,1):e.sequence[0]=h.get(e.sequence[0]))}})}for(var s=0;s<_e.length;s+=1)if(Se(s,r,n)&&!ke(s,r,n))for(var c=s;Se(c,r,n);)c=n[c][0],"-"===c.charAt(0)&&(c=c.substr(1)),c=Be.get(c),_e[s].hasOwnProperty("sequenceLength")?_e[s].sequenceLength+=_e[c].sequenceLength:_e[s].width+=_e[c].width,_e[s].seq+=_e[c].seq;Ue.forEach(function(t){for(var a=t.sequence.length-1;a>=0;a-=1){e=t.sequence[a],"-"===e.charAt(0)&&(e=e.substr(1));ke(Be.get(e),r,n)&&t.sequence.splice(a,1)}});for(var l=_e.length-1;l>=0;l-=1)ke(l,r,n)&&_e.splice(l,1);return{nodes:_e,tracks:Ue}}function ke(e,t,r){if(1!==t[e].length)return!1;if("None"===t[e][0])return!1;var n=t[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var a=Be.get(n);return 1===r[a].length&&("None"!==r[a][0]&&n)}function Se(e,t,r){if(1!==r[e].length)return!1;if("None"===r[e][0])return!1;var n=r[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var a=Be.get(n);return 1===t[a].length&&"None"!==t[a][0]}Object.defineProperty(r,"__esModule",{value:!0}),r.create=n,r.changeTrackVisibility=d,r.changeExonVisibility=i,r.setMergeNodesFlag=h,r.setNodeWidthOption=s,r.useColorScheme=V,r.vgExtractNodes=me,r.vgExtractTracks=qe,r.vgExtractReads=Fe;var be=!1,Me=["#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],Ie=["#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],Ne=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],Le=["#ABCCE3","#FFCFA5","#B0DBB0","#F0AEAE","#D7C6E6","#C6ABA5","#F4CCE8","#CFCFCF","#E6E6AC","#A8E7ED"],De=void 0,Pe=void 0,Ce=[],Ae=[],Te=[],_e=void 0,Ue=void 0,We=void 0,Re=void 0,He=void 0,Be=void 0,Qe=[],Ye=[],Je=[],ze=void 0,Ze={mergeNodesFlag:!0,clickableNodesFlag:!1,showExonsFlag:!1,colorScheme:1,nodeWidthOption:0},je=[],Ve=[],$e=[],Ge=[],Xe=[],Ke=0,et=0,tt=void 0},{}]},{},[1]);