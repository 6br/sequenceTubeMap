!function e(t,r,n){function o(i,d){if(!r[i]){if(!t[i]){var s="function"==typeof require&&require;if(!d&&s)return s(i,!0);if(a)return a(i,!0);var h=new Error("Cannot find module '"+i+"'");throw h.code="MODULE_NOT_FOUND",h}var c=r[i]={exports:{}};t[i][0].call(c.exports,function(e){var r=t[i][1][e];return o(r?r:e)},c,c.exports,e,t,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,r){"use strict";var n=e("./tubemap"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n),a=[{name:"A",seq:"AAAA"},{name:"B",seq:"TTG"},{name:"C",seq:"CC"}],i=[{id:0,name:"Track 1",sequence:["A","B","C"]},{id:1,name:"Track 2",sequence:["A","-B","C"]},{id:2,name:"Track 3",sequence:["A","C"]}];o.create({svgID:"#svg",nodes:a,tracks:i}),o.useColorScheme(0)},{"./tubemap":2}],2:[function(e,t,r){"use strict";function n(e){nt=e.svgID,ot=d3.select(e.svgID),at=JSON.parse(JSON.stringify(e.nodes)),it=JSON.parse(JSON.stringify(e.tracks)),dt=e.reads||null,Mt=e.bed||null,xt.clickableNodesFlag=e.clickableNodes||!1,xt.hideLegendFlag=e.hideLegend||!1;p();xt.hideLegendFlag||be()}function o(e){it.unshift(it[e]),it.splice(e+1,1),a(0)}function a(e){var t=void 0,r=void 0,n=[],o=void 0,a=void 0;for(o=it[e].sequence,t=0;t<o.length;t+=1)"-"===o[t].charAt(0)&&(a=o[t].substr(1),(o.indexOf(a)===-1||o.indexOf(a)>t)&&n.push(o[t].substr(1)));for(t=0;t<it.length;t+=1)for(o=it[t].sequence,r=0;r<o.length;r+=1)"-"!==o[r].charAt(0)?n.indexOf(o[r])!==-1&&(o[r]="-"+o[r]):n.indexOf(o[r].substr(1))!==-1&&(o[r]=o[r].substr(1));at.forEach(function(e){n.indexOf(e.name)!==-1&&(e.seq=e.seq.split("").reverse().join(""))})}function i(e){for(var t=0;t<it.length&&it[t].id!==e;)t+=1;t<it.length&&(it[t].hasOwnProperty("hidden")?it[t].hidden=!it[t].hidden:it[t].hidden=!0),p()}function d(){xt.showExonsFlag=!xt.showExonsFlag,p()}function s(e){xt.mergeNodesFlag!==e&&(xt.mergeNodesFlag=e,ot=d3.select(nt),p())}function h(e){xt.showSoftClips!==e&&(xt.showSoftClips=e,ot=d3.select(nt),p())}function c(e){xt.showReads!==e&&(xt.showReads=e,ot=d3.select(nt),p())}function l(e,t){xt[e]=t;p();xt.hideLegendFlag||be()}function u(e){0!==e&&1!==e&&2!==e||xt.nodeWidthOption!==e&&(xt.nodeWidthOption=e,void 0!==ot&&(ot=d3.select(nt),p()))}function p(){mt=[],qt=[],Et=[],bt=[],Ot=[],gt=[],yt=[],vt=[],kt=0,Ft=0,Nt=0,St=void 0,ot=d3.select(nt),ot.selectAll("*").remove(),st=JSON.parse(JSON.stringify(at)),ht=JSON.parse(JSON.stringify(it)),ct=JSON.parse(JSON.stringify(dt)),re();for(var e=ht.length-1;e>=0;e-=1)ht[e].hasOwnProperty("type")||(ht[e].type="haplo"),ht[e].hasOwnProperty("hidden")&&ht[e].hidden===!0&&ht.splice(e,1),ht[e].hasOwnProperty("indexOfFirstBase")&&(St=ht[e].name);pt=L(),F(ht),ct&&xt.showReads&&F(ct),Ce(),ct&&xt.mergeNodesFlag&&(C(),D(),ct&&xt.showReads&&O(),De(),pt=L(),Ce(),F(ht),ct&&xt.showReads&&F(ct)),lt=st.length,ut=ht.length,C(),B(),Ze&&console.log(lt+" nodes."),D(),wt=R(),ee(),Y(),xt.showExonsFlag===!0&&null!==Mt&&K(),W(),ct&&xt.showReads&&(f(),O(),F(ct),y(),ht=ht.concat(ct)),se(),console.log("Tracks:"),console.log(ht),console.log("Nodes:"),console.log(st),console.log("Lane assignment:"),console.log(gt),S(),M(),me(),we(mt),qe(),ue(Et,bt),we(Ot),we(mt,"read"),qe("read");var t=N(st);return pe(t),ue(Et,bt,"read"),0===xt.nodeWidthOption&&fe(t),void 0!==St&&ge(),0===xt.nodeWidthOption&&_e(),Ze&&(console.log("number of tracks: "+ut),console.log("number of nodes: "+lt)),ht}function f(){ft=[];for(var e=0;e<=wt;e+=1)ft[e]=[];var t=new Map;st.forEach(function(e){e.hasOwnProperty("order")&&e.hasOwnProperty("y")&&(t.has(e.order)?t.set(e.order,Math.max(e.y+e.contentHeight,t.get(e.order))):t.set(e.order,e.y+e.contentHeight))}),st.forEach(function(e,r){e.hasOwnProperty("order")&&!e.hasOwnProperty("y")&&(console.log("adding to "+e.name),e.y=t.get(e.order)+25,e.contentHeight=0,ft[e.order].push(r))})}function g(){st.forEach(function(e){e.incomingReads=[],e.outgoingReads=[],e.internalReads=[]}),ct.forEach(function(e,t){e.width=7,1===e.path.length?st[e.path[0].node].internalReads.push(t):e.path.forEach(function(r,n){0===n?st[e.path[0].node].outgoingReads.push([t,n]):null!==e.path[n].node&&st[e.path[n].node].incomingReads.push([t,n])})})}function y(){b(),g();var e=st.slice();e.sort(X),e.forEach(function(e){e.incomingReads.sort(m);var t=e.y+e.contentHeight,r=new Map;e.incomingReads.forEach(function(n){ct[n[0]].path[n[1]].y=t,v(r,ct[n[0]],n[1],t,e),t+=7});var n=t;e.outgoingReads.sort(x);var o=new Map;t=e.y+e.contentHeight,e.outgoingReads.forEach(function(a){ct[a[0]].path[a[1]].y=t,o.set(t,ct[a[0]].firstNodeOffset),!r.has(t)||r.get(t)+1<ct[a[0]].firstNodeOffset?(t+=7,n=Math.max(n,t)):(r.set(t,0),e.incomingReads.forEach(function(n){var o=ct[n[0]],a=o.path[n[1]];a.y>=t&&(a.y+=7,v(r,o,n[1],a.y,e))}),t+=7,n+=7)}),e.internalReads.sort(q),e.internalReads.forEach(function(a){var i=ct[a];for(t=e.y+e.contentHeight;i.firstNodeOffset<r.get(t)+2||i.finalNodeCoverLength>o.get(t)-3;)t+=7;i.path[0].y=t,r.set(t,i.finalNodeCoverLength),n=Math.max(n,t)});var a=n-e.y-e.contentHeight;e.contentHeight+=a,j(e,a)});var t=E(),r=[];ct.forEach(function(e,t){e.path.forEach(function(e,n){e.hasOwnProperty("y")||r.push({readIndex:t,pathIndex:n,previousY:ct[t].path[n-1].y})})}),r.sort(w),r.forEach(function(e){var r=ct[e.readIndex].path[e.pathIndex];r.y=t[r.order],t[r.order]+=ct[e.readIndex].width}),console.log("Reads:"),console.log(ct)}function v(e,t,r,n,o){r===t.path.length-1?e.set(n,t.finalNodeCoverLength):e.set(n,o.sequenceLength)}function w(e,t){var r=ct[e.readIndex].path[e.pathIndex],n=ct[t.readIndex].path[t.pathIndex];return r.order===n.order?e.previousY-t.previousY:r.order-n.order}function x(e,t){for(var r=e[1],n=t[1],o=st[ct[e[0]].path[r].node],a=st[ct[t[0]].path[n].node];null!==o&&null!==a&&o===a;){if(r<ct[e[0]].path.length-1){for(r+=1;null===ct[e[0]].path[r].node;)r+=1;o=st[ct[e[0]].path[r].node]}else o=null;if(n<ct[t[0]].path.length-1){for(n+=1;null===ct[t[0]].path[n].node;)n+=1;a=st[ct[t[0]].path[n].node]}else a=null}if(null!==o)return null!==a?X(o,a):1;if(null!==a)return-1;var i=ct[e[0]].firstNodeOffset-ct[t[0]].firstNodeOffset;return 0!==i?i:ct[e[0]].finalNodeCoverLength-ct[t[0]].finalNodeCoverLength}function m(e,t){var r=ct[e[0]].path[e[1]-1],n=ct[t[0]].path[t[1]-1];return r.hasOwnProperty("y")?n.hasOwnProperty("y")?r.y-n.y:-1:n.hasOwnProperty("y")?1:m([e[0],e[1]-1],[t[0],t[1]-1])}function q(e,t){var r=ct[e],n=ct[t];return r.firstNodeOffset<n.firstNodeOffset?-1:r.firstNodeOffset>n.firstNodeOffset?1:r.finalNodeCoverLength<n.finalNodeCoverLength?-1:r.finalNodeCoverLength>n.finalNodeCoverLength?1:0}function E(){for(var e=[],t=0;t<=wt;t+=1)e.push(0);return st.forEach(function(t){e[t.order]=Math.max(e[t.order],t.y+t.contentHeight+20)}),ht.forEach(function(t){t.path.forEach(function(r){e[r.order]=Math.max(e[r.order],r.y+t.width)})}),e}function b(){var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0;ct.forEach(function(a){e=Math.abs(a.indexSequence[0]),t=a.indexSequence[0]>=0,r=st[e],a.path=[],a.path.push({order:r.order,isForward:t,node:e});for(var i=1;i<a.sequence.length;i+=1)if(n=r,o=t,e=Math.abs(a.indexSequence[i]),t=a.indexSequence[i]>=0,r=st[e],r.order>n.order){o||a.path.push({order:n.order,isForward:!0,node:null});for(var d=n.order+1;d<r.order;d+=1)a.path.push({order:d,isForward:!0,node:null});t?a.path.push({order:r.order,isForward:!0,node:e}):(a.path.push({order:r.order,isForward:!0,node:null}),a.path.push({order:r.order,isForward:!1,node:e}))}else if(r.order<n.order){o&&a.path.push({order:n.order,isForward:!1,node:null});for(var s=n.order-1;s>r.order;s-=1)a.path.push({order:s,isForward:!1,node:null});t?(a.path.push({order:r.order,isForward:!1,node:null}),a.path.push({order:r.order,isForward:!0,node:e})):a.path.push({order:r.order,isForward:!1,node:e})}else t!==o?a.path.push({order:r.order,isForward:t,node:e}):(a.path.push({order:r.order,isForward:!t,node:null}),a.path.push({order:r.order,isForward:t,node:e}))})}function O(){ct.forEach(function(e){for(var t=0;t<e.sequence.length&&"-"===e.sequence[t].charAt(0);)t+=1;if(t===e.sequence.length){e.is_reverse=!0,e.sequence=e.sequence.reverse();for(var r=0;r<e.sequence.length;r+=1)e.sequence[r]=e.sequence[r].substr(1);e.sequenceNew=e.sequenceNew.reverse();for(var n=0;n<e.sequenceNew.length;n+=1)!function(t){e.sequenceNew[t].nodeName=e.sequenceNew[t].nodeName.substr(1);var r=st[pt.get(e.sequenceNew[t].nodeName)].width;e.sequenceNew[t].mismatches.forEach(function(e){"insertion"===e.type?(e.pos=r-e.pos,e.seq=k(e.seq)):"deletion"===e.type?e.pos=r-e.pos-e.length:"substitution"===e.type&&(e.pos=r-e.pos-e.seq.length,e.seq=k(e.seq)),e.hasOwnProperty("seq")&&(e.seq=e.seq.split("").reverse().join(""))})}(n);var o=e.firstNodeOffset,a=st[pt.get(e.sequence[0])].sequenceLength;e.firstNodeOffset=a-e.finalNodeCoverLength,a=st[pt.get(e.sequence[e.sequence.length-1])].sequenceLength,e.finalNodeCoverLength=a-o}})}function k(e){for(var t="",r=e.length-1;r>=0;r-=1)switch(e.charAt(r)){case"A":t+="T";break;case"T":t+="A";break;case"C":t+="G";break;case"G":t+="C";break;default:t+="N"}return t}function F(e){e.forEach(function(e){e.indexSequence=[],e.sequence.forEach(function(t){"-"===t.charAt(0)?e.indexSequence.push(-pt.get(t.substr(1))):e.indexSequence.push(pt.get(t))})})}function N(e){var t=e.slice(0),r=void 0;for(r=t.length-1;r>=0;r-=1)t[r].hasOwnProperty("x")||t.splice(r,1);return t}function S(){Nt=-99,Ft=99,kt=-99,st.forEach(function(e){e.hasOwnProperty("x")&&(Nt=Math.max(Nt,e.x+20+e.pixelWidth)),e.hasOwnProperty("y")&&(Ft=Math.min(Ft,e.y-10),kt=Math.max(kt,e.y+e.contentHeight+10))}),ht.forEach(function(e){e.path.forEach(function(t){kt=Math.max(kt,t.y+e.width),Ft=Math.min(Ft,t.y)})})}function M(){var e=d3.behavior.zoom().scaleExtent([.1,5]).on("zoom",function(){ot.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")});ot=ot.call(e).on("dblclick.zoom",null).append("g"),e.translate([0,25-Ft]),e.event(ot);var t=d3.select(nt);t.attr("height",kt-Ft+50),t.attr("width",Math.max(Nt,$(nt).parent().width()))}function L(){return pt=new Map,st.forEach(function(e,t){pt.set(e.name,t)}),pt}function C(){var e=void 0,t=void 0;st.forEach(function(e){e.successors=[],e.predecessors=[]}),ht.forEach(function(r){for(var n=0;n<r.indexSequence.length-1;n+=1)e=Math.abs(r.indexSequence[n]),t=Math.abs(r.indexSequence[n+1]),st[e].successors.indexOf(t)===-1&&st[e].successors.push(t),st[t].predecessors.indexOf(e)===-1&&st[t].predecessors.push(e)}),ct&&xt.showReads&&ct.forEach(function(r){for(var n=0;n<r.indexSequence.length-1;n+=1)e=Math.abs(r.indexSequence[n]),t=Math.abs(r.indexSequence[n+1]),st[e].successors.indexOf(t)===-1&&st[e].successors.push(t),st[t].predecessors.indexOf(e)===-1&&st[t].predecessors.push(e)})}function I(e){var t=0,r=0,n=void 0,o=0;e.forEach(function(e){e<0?(n=st[Math.abs(e)],n.hasOwnProperty("order")||(n.order=r),n.order<o&&(o=n.order),t=n.order,r=n.order-1):(n=st[e],n.hasOwnProperty("order")||(n.order=t),t=n.order+1,r=n.order)}),o<0&&H(-o)}function P(e){for(var t=0,r=void 0,n=void 0,o=0,a=void 0;!st[Math.abs(e[t])].hasOwnProperty("order");)t+=1;e[t]>=0?(r=st[e[t]].order-1,a=-1):(r=st[-e[t]].order+1,a=1);for(var i=t-1;i>=0;i-=1)n=st[Math.abs(e[i])],n.hasOwnProperty("order")||(n.order=r,o=Math.min(o,r),r+=a);return o<0&&H(-o),t}function D(){var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0,a=0,i=void 0;i=ct&&xt.showReads?ht.concat(ct):ht,st.forEach(function(e){delete e.order}),I(ht[0].indexSequence);for(var d=1;d<i.length;d+=1)for(Ze&&console.log("generating order for track "+(d+1)),n=P(i[d].indexSequence),e=_(i[d].indexSequence);n<e.length;){for(o=n,n+=1;n<e.length&&!st[e[n]].hasOwnProperty("order");)n+=1;if(n<e.length){t=st[e[o]].order+1;for(var s=o+1;s<n;s+=1)st[e[s]].order=t,t+=1;if(st[e[n]].order>st[e[o]].order)st[e[n]].order<t&&T(e[n],e[n-1],t);else if(i[d].indexSequence[n]>=0&&!A(e[n],e[o]))T(e[n],e[n-1],t);else if(i[d].sequence[o]<0||st[e[o+1]].degree<2&&st[e[n]].order<st[e[o]].order){t=st[e[o]].order-1;for(var h=o+1;h<n;h+=1)st[e[h]].order=t,t-=1}}else if(i[d].sequence[o]>=0){t=st[e[o]].order+1;for(var c=o+1;c<e.length;c+=1)r=st[e[c]],r.hasOwnProperty("order")||(r.order=t,t+=1)}else{t=st[e[o]].order-1;for(var l=o+1;l<e.length;l+=1)r=st[e[l]],r.hasOwnProperty("order")||(r.order=t,a=Math.min(a,t),t-=1)}}a<0&&H(-a)}function A(e,t){var r=new Array(lt).fill(!1),n=[];for(n.push(e),r[e]=!0;n.length>0;){var o=n.pop();if(o===t)return!0;for(var a=0;a<st[o].successors.length;a+=1){var i=st[o].successors[a];r[i]||(r[i]=!0,n.push(i))}}return!1}function R(){var e=-1;return st.forEach(function(t){t.hasOwnProperty("order")&&t.order>e&&(e=t.order)}),e}function _(e){for(var t=[],r=0;r<e.length;r+=1)e[r]>=0?t.push(e[r]):t.push(-e[r]);return t}function H(e){st.forEach(function(t){t.hasOwnProperty("order")&&(t.order+=e)})}function T(e,t,r){var n=new Map,o=[];o.push([e,r]);for(;o.length>0;)!function(){var r=o.shift(),a=r[0],i=r[1];st[a].hasOwnProperty("order")&&st[a].order<i&&(!n.has(a)||n.get(a)<i)&&(n.set(a,i),st[a].successors.forEach(function(e){st[e].order>st[a].order&&e!==t&&o.push([e,i+1])}),a!==e&&st[a].predecessors.forEach(function(e){st[e].order>a.order&&e!==t&&o.push([e,i+1])}))}();n.forEach(function(e,t){st[t].order=e})}function B(){st.forEach(function(e){e.tracks=[]}),ht.forEach(function(e){e.indexSequence.forEach(function(t){st[Math.abs(t)].tracks.push(e.id)})}),st.forEach(function(e){e.hasOwnProperty("tracks")&&(e.degree=e.tracks.length)})}function W(){var e=0,t=20,r=-1,n=st.slice();n.sort(X);var o=U();n.forEach(function(n){n.hasOwnProperty("order")&&(n.order>r&&(r=n.order,e=t+10*o[n.order]),n.x=e,t=Math.max(t,e+40+n.pixelWidth))})}function U(){for(var e=[],t=[],r=[],n=0;n<=wt;n+=1)e.push(0),t.push(0);ht.forEach(function(r){for(var n=1;n<r.path.length;n+=1)r.path[n].order===r.path[n-1].order&&(r.path[n].isForward===!0?e[r.path[n].order]+=1:t[r.path[n].order]+=1)}),r.push(Math.max(0,e[0]-1));for(var o=1;o<=wt;o+=1)r.push(Math.max(0,e[o]-1)+Math.max(0,t[o-1]-1));return r}function Y(){for(var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0,a=void 0,i=[],d=0;d<=wt;d+=1){gt[d]=[],i[d]=[];for(var s=0;s<ut;s+=1)i[d][s]=null}ht.forEach(function(d,s){t=Math.abs(d.indexSequence[0]),r=d.indexSequence[0]>=0,n=st[t],d.path=[],d.path.push({order:n.order,lane:null,isForward:r,node:t}),Q(n.order,t,s,0,i),e=1;for(var h=1;h<d.sequence.length;h+=1)if(o=n,a=r,t=Math.abs(d.indexSequence[h]),r=d.indexSequence[h]>=0,n=st[t],n.order>o.order){a||(d.path.push({order:o.order,lane:null,isForward:!0,node:null}),Q(o.order,null,s,e,i),e+=1);for(var c=o.order+1;c<n.order;c+=1)d.path.push({order:c,lane:null,isForward:!0,node:null}),Q(c,null,s,e,i),e+=1;r?(d.path.push({order:n.order,lane:null,isForward:!0,node:t}),Q(n.order,t,s,e,i),e+=1):(d.path.push({order:n.order,lane:null,isForward:!0,node:null}),Q(n.order,null,s,e,i),e+=1,d.path.push({order:n.order,lane:null,isForward:!1,node:t}),Q(n.order,t,s,e,i),e+=1)}else if(n.order<o.order){a&&(d.path.push({order:o.order,lane:null,isForward:!1,node:null}),Q(o.order,null,s,e,i),e+=1);for(var l=o.order-1;l>n.order;l-=1)d.path.push({order:l,lane:null,isForward:!1,node:null}),Q(l,null,s,e,i),e+=1;r?(d.path.push({order:n.order,lane:null,isForward:!1,node:null}),Q(n.order,null,s,e,i),e+=1,d.path.push({order:n.order,lane:null,isForward:!0,node:t}),Q(n.order,t,s,e,i),e+=1):(d.path.push({order:n.order,lane:null,isForward:!1,node:t}),Q(n.order,t,s,e,i),e+=1)}else r!==a?(d.path.push({order:n.order,lane:null,isForward:r,node:t}),Q(n.order,t,s,e,i),e+=1):(d.path.push({order:n.order,lane:null,isForward:!r,node:null}),Q(n.order,null,s,e,i),e+=1,d.path.push({order:n.order,lane:null,isForward:r,node:t}),Q(n.order,t,s,e,i),e+=1)});for(var h=0;h<=wt;h+=1)z(gt[h],h)}function Q(e,t,r,n,o){var a=o[e][r];if(null===t)gt[e].push({type:"single",node:null,tracks:[{trackID:r,segmentID:n,compareToFromSame:a}]}),o[e][r]=gt[e][gt[e].length-1].tracks[0];else{for(var i=0;i<gt[e].length;i+=1)if(gt[e][i].node===t)return gt[e][i].type="multiple",gt[e][i].tracks.push({trackID:r,segmentID:n,compareToFromSame:a}),void(o[e][r]=gt[e][i].tracks[gt[e][i].tracks.length-1]);gt[e].push({type:"single",node:t,tracks:[{trackID:r,segmentID:n,compareToFromSame:a}]}),o[e][r]=gt[e][gt[e].length-1].tracks[0]}}function J(e,t){var r=void 0;e.forEach(function(e){e.idealLane=0,e.tracks.forEach(function(n){if(0===n.segmentID)n.idealLane=n.trackID,n.idealY=null;else if(ht[n.trackID].path[n.segmentID-1].order===t-1)n.idealLane=ht[n.trackID].path[n.segmentID-1].lane,n.idealY=ht[n.trackID].path[n.segmentID-1].y;else if(n.segmentID<ht[n.trackID].path.length-1&&ht[n.trackID].path[n.segmentID+1].order===t-1)n.idealLane=ht[n.trackID].path[n.segmentID+1].lane,n.idealY=ht[n.trackID].path[n.segmentID+1].y;else{for(r=n.segmentID-1;r>=0&&ht[n.trackID].path[r].order!==t-1;)r-=1;r<0?(n.idealLane=n.trackID,n.idealY=null):(n.idealLane=ht[n.trackID].path[r].lane,n.idealY=ht[n.trackID].path[r].y)}e.idealLane+=n.idealLane}),e.idealLane/=e.tracks.length})}function z(e,t){var r=0,n=new Set,o=20,a=!1,i=-1;J(e,t),e.sort(V),e.forEach(function(e){null!==e.node?(st[e.node].topLane=r,a&&(o-=10),st[e.node].y=o,st[e.node].contentHeight=0,a=!1):(a?o-=25:o>20&&(o-=10),a=!0),e.tracks.sort(V),e.tracks.forEach(function(t){t.lane=r,t.trackID===i&&null===e.node&&a&&(o+=10),ht[t.trackID].path[t.segmentID].lane=r,ht[t.trackID].path[t.segmentID].y=o,null!==t.idealY&&n.add(t.idealY-o),r+=1,o+=ht[t.trackID].width,null!==e.node&&(st[e.node].contentHeight+=ht[t.trackID].width),i=t.trackID}),o+=25}),Z(e,n)}function Z(e,t){var r=0,n=Number.MAX_SAFE_INTEGER;t.forEach(function(t){G(e,t)<n&&(n=G(e,t),r=t)}),e.forEach(function(e){null!==e.node&&(st[e.node].y+=r),e.tracks.forEach(function(e){ht[e.trackID].path[e.segmentID].y+=r})})}function j(e,t){e.hasOwnProperty("order")&&(gt[e.order].forEach(function(r){if(null!==r.node){var n=st[r.node];n!==e&&n.y>e.y&&(n.y+=t,r.tracks.forEach(function(e){ht[e.trackID].path[e.segmentID].y+=t}))}else r.tracks.forEach(function(r){ht[r.trackID].path[r.segmentID].y>=e.y&&(ht[r.trackID].path[r.segmentID].y+=t)})}),ft[e.order].length>0&&ft[e.order].forEach(function(r){st[r]!==e&&st[r].y>e.y&&(st[r].y+=t)}))}function G(e,t){var r=0;return e.forEach(function(e){e.tracks.forEach(function(e){null!==e.idealY&&"read"!==ht[e.trackID].type&&(r+=Math.abs(e.idealY-t-ht[e.trackID].path[e.segmentID].y)*ht[e.trackID].width)})}),r}function V(e,t){return e.hasOwnProperty("idealLane")?t.hasOwnProperty("idealLane")?e.idealLane<t.idealLane?-1:e.idealLane>t.idealLane?1:0:-1:t.hasOwnProperty("idealLane")?1:0}function X(e,t){if(null===e)return null===t?0:-1;if(null===t)return 1;if(e.hasOwnProperty("order")){if(t.hasOwnProperty("order")){if(e.order<t.order)return-1;if(e.order>t.order)return 1;if(e.hasOwnProperty("y")&&t.hasOwnProperty("y")){if(e.y<t.y)return-1;if(e.y>t.y)return 1}return 0}return-1}return t.hasOwnProperty("order")?1:0}function K(){var e=void 0,t=void 0,r={};Mt.forEach(function(n){for(var o=0;o<ut&&ht[o].name!==n.track;)o+=1;o<ut&&(e=0,ht[o].path.forEach(function(o){null!==o.node&&(r={},t=st[o.node].hasOwnProperty("sequenceLength")?e+st[o.node].sequenceLength-1:e+st[o.node].width-1,e>=n.start&&e<=n.end&&(r.start=0),e<n.start&&t>=n.start&&(r.start=n.start-e),t<=n.end&&t>=n.start&&(r.end=t-e,t<n.end&&(r.continue=!0)),t>n.end&&e<=n.end&&(r.end=n.end-e),r.hasOwnProperty("start")&&(r.type=n.type,r.name=n.name,o.hasOwnProperty("features")||(o.features=[]),o.features.push(r)),e=t+1)}))})}function ee(){ht.forEach(function(e){e.hasOwnProperty("freq")?e.width=Math.round(4*(Math.log(e.freq)+1)):(e.width=15,e.hasOwnProperty("type")&&"read"===e.type&&(e.width=4))})}function te(e){xt.colorScheme=e,ot=d3.select(nt);p();xt.hideLegendFlag||be()}function re(){Ke=ne(xt.haplotypeColors),et=ne(xt.forwardReadColors),tt=ne(xt.reverseReadColors),rt=ne(xt.exonColors)}function ne(e){switch(e){case"plainColors":return Xe;case"reds":return Ve;case"blues":return Ge;case"greys":return je;case"lightColors":return $e;default:return je}}function oe(e,t){void 0===t&&(t="plain");return e.hasOwnProperty("type")&&"read"===e.type?e.hasOwnProperty("is_reverse")&&e.is_reverse===!0?tt[e.id%tt.length]:et[e.id%et.length]:xt.showExonsFlag===!1||"plain"!==t?Ke[e.id%Ke.length]:rt[e.id%rt.length]}function ae(e){var t=st[e.path[0].node];return e.path[0].isForward?de(t,e.firstNodeOffset):de(t,t.sequenceLength-e.firstNodeOffset)}function ie(e){var t=st[e.path[e.path.length-1].node];return e.path[e.path.length-1].isForward?de(t,e.finalNodeCoverLength):de(t,t.sequenceLength-e.finalNodeCoverLength)}function de(e,t){if(t>e.sequenceLength)return null;var r=e.x-4,n=e.x+e.pixelWidth+4;return r+t/e.sequenceLength*(n-r)}function se(){for(var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0,a=void 0,i=void 0,d=void 0,s=0;s<=wt;s+=1)yt.push(0),vt.push(0);var h=[],c=[];st.forEach(function(e){e.hasOwnProperty("order")&&(h[e.order]=e.x,void 0===c[e.order]?c[e.order]=e.x+e.pixelWidth:c[e.order]=Math.max(c[e.order],e.x+e.pixelWidth))}),ht.forEach(function(s){a="plain",o=oe(s,a),r=s.path[0].y,e="read"!==s.type?"-"===s.sequence[0].charAt(0)?c[s.path[0].order]+20:h[s.path[0].order]-20:ae(s);for(var l=0;l<s.path.length;l+=1)s.path[l].y===r?s.path[l].hasOwnProperty("features")&&(d=l>0&&s.path[l-1].order===s.path[l].order,i=he(s.path[l],h[s.path[l].order],c[s.path[l].order],a,s,e,r,o,d),a=i.highlight,e=i.xStart):(t=s.path[l-1].isForward?c[s.path[l-1].order]:h[s.path[l-1].order],t!==e&&(o=oe(s,a),mt.push({xStart:Math.min(e,t),yStart:r,xEnd:Math.max(e,t),yEnd:r+s.width-1,color:o,id:s.id,type:s.type})),s.path[l].order-1===s.path[l-1].order?(e=t,t=h[s.path[l].order],n=s.path[l].y,o=oe(s,a),qt.push({xStart:e,yStart:r,xEnd:t+1,yEnd:n,width:s.width,color:o,laneChange:Math.abs(s.path[l].lane-s.path[l-1].lane),id:s.id,type:s.type}),e=t,r=n):s.path[l].order+1===s.path[l-1].order?(e=t,t=c[s.path[l].order],n=s.path[l].y,o=oe(s,a),qt.push({xStart:e+1,yStart:r,xEnd:t,yEnd:n,width:s.width,color:o,laneChange:Math.abs(s.path[l].lane-s.path[l-1].lane),id:s.id,type:s.type}),e=t,r=n):s.path[l-1].isForward?(n=s.path[l].y,ce(t,r,n,s.width,o,s.id,s.path[l].order,s.type),e=c[s.path[l].order],r=s.path[l].y):(n=s.path[l].y,le(t,r,n,s.width,o,s.id,s.path[l].order,s.type),e=h[s.path[l].order],r=s.path[l].y),s.path[l].hasOwnProperty("features")&&(d=s.path[l-1].order===s.path[l].order,i=he(s.path[l],h[s.path[l].order],c[s.path[l].order],a,s,e,r,o,d),a=i.highlight,e=i.xStart));t="read"!==s.type?s.path[s.path.length-1].isForward?c[s.path[s.path.length-1].order]+20:h[s.path[s.path.length-1].order]-20:ie(s),mt.push({xStart:Math.min(e,t),yStart:r,xEnd:Math.max(e,t),yEnd:r+s.width-1,color:o,id:s.id,type:s.type})})}function he(e,t,r,n,o,a,i,d,s){var h=void 0,c=n,l=void 0,u=void 0,p=void 0,f=void 0;return t-=8,r+=8,h=st[e.node].hasOwnProperty("sequenceLength")?st[e.node].sequenceLength:st[e.node].width,e.features.sort(function(e,t){return e.start-t.start}),e.features.forEach(function(n){c!==n.type&&(l=oe(o,c),e.isForward===!0?(p=t+Math.round(n.start*(r-t+1)/h),s&&p<t+8&&(f=t+Math.round((n.end+1)*(r-t+1)/h)-1,u=oe(o,n.type),Ot.push({xStart:p,yStart:i,xEnd:f,yEnd:i+o.width-1,color:u,id:o.id,type:o.type})),p>a+1&&Ot.push({xStart:a,yStart:i,xEnd:p-1,yEnd:i+o.width-1,color:l,id:o.id,type:o.type})):(p=r-Math.round(n.start*(r-t+1)/h),s&&p>r-8&&(f=r-Math.round((n.end+1)*(r-t+1)/h)-1,u=oe(o,n.type),Ot.push({xStart:f,yStart:i,xEnd:p,yEnd:i+o.width-1,color:u,id:o.id,type:o.type})),a>p+1&&Ot.push({xStart:p+1,yStart:i,xEnd:a,yEnd:i+o.width-1,color:l,id:o.id,type:o.type})),a=p,c=n.type),(n.end<h-1||!n.hasOwnProperty("continue"))&&(l=oe(o,c),e.isForward===!0?(f=t+Math.round((n.end+1)*(r-t+1)/h)-1,Ot.push({xStart:a,yStart:i,xEnd:f,yEnd:i+o.width-1,color:l,id:o.id,type:o.type})):(f=r-Math.round((n.end+1)*(r-t+1)/h)-1,Ot.push({xStart:f,yStart:i,xEnd:a,yEnd:i+o.width-1,color:l,id:o.id,type:o.type})),a=f+1,c="plain")}),{xStart:a,highlight:c}}function ce(e,t,r,n,o,a,i,d){e+=10*vt[i];var s=Math.min(t,r),h=Math.max(t,r);bt.push({xStart:e-10*vt[i],yStart:t,xEnd:e+5,yEnd:t+n-1,color:o,id:a,type:d}),bt.push({xStart:e+5+7,yStart:s+n+7-1,xEnd:e+5+7+Math.min(7,n)-1,yEnd:h-7+1,color:o,id:a,type:d}),bt.push({xStart:e-10*vt[i],yStart:r,xEnd:e+5,yEnd:r+n-1,color:o,id:a,type:d});var c="M "+(e+5)+" "+h;c+=" Q "+(e+5+7)+" "+h+" "+(e+5+7)+" "+(h-7),c+=" H "+(e+5+7+Math.min(7,n)),c+=" Q "+(e+5+7+Math.min(7,n))+" "+(h+n)+" "+(e+5)+" "+(h+n),c+=" Z ",Et.push({path:c,color:o,id:a,type:d}),c="M "+(e+5)+" "+s,c+=" Q "+(e+5+7+Math.min(7,n))+" "+s+" "+(e+5+7+Math.min(7,n))+" "+(s+n+7),c+=" H "+(e+5+7),c+=" Q "+(e+5+7)+" "+(s+n)+" "+(e+5)+" "+(s+n),c+=" Z ",Et.push({path:c,color:o,id:a,type:d}),vt[i]+=1}function le(e,t,r,n,o,a,i,d){var s=Math.min(t,r),h=Math.max(t,r);e-=10*yt[i],bt.push({xStart:e-6,yStart:t,xEnd:e+10*yt[i],yEnd:t+n-1,color:o,id:a,type:d}),bt.push({xStart:e-5-7-Math.min(7,n),yStart:s+n+7-1,xEnd:e-5-7-1,yEnd:h-7+1,color:o,id:a,type:d}),bt.push({xStart:e-6,yStart:r,xEnd:e+10*yt[i],yEnd:r+n-1,color:o,id:a,type:d});var c="M "+(e-5)+" "+h;c+=" Q "+(e-5-7)+" "+h+" "+(e-5-7)+" "+(h-7),c+=" H "+(e-5-7-Math.min(7,n)),c+=" Q "+(e-5-7-Math.min(7,n))+" "+(h+n)+" "+(e-5)+" "+(h+n),c+=" Z ",Et.push({path:c,color:o,id:a,type:d}),c="M "+(e-5)+" "+s,c+=" Q "+(e-5-7-Math.min(7,n))+" "+s+" "+(e-5-7-Math.min(7,n))+" "+(s+n+7),c+=" H "+(e-5-7),c+=" Q "+(e-5-7)+" "+(s+n)+" "+(e-5)+" "+(s+n),c+=" Z ",Et.push({path:c,color:o,id:a,type:d}),yt[i]+=1}function ue(e,t,r){void 0===r&&(r="haplo");var n=new Set;t.forEach(function(e){n.add(e.color)}),n.forEach(function(n){we(t.filter(ve("color",n)),r),Ee(e.filter(ve("color",n)),r)})}function pe(e){var t=void 0,r=void 0;e.forEach(function(e){e.d="M "+(e.x-9)+" "+e.y+" Q "+(e.x-9)+" "+(e.y-9)+" "+e.x+" "+(e.y-9),t=e.x,r=e.y-9,e.width>1&&(t+=e.pixelWidth,e.d+=" L "+t+" "+r),e.d+=" Q "+(t+9)+" "+r+" "+(t+9)+" "+(r+9),t+=9,r+=9,e.contentHeight>0&&(r+=e.contentHeight-0,e.d+=" L "+t+" "+r),e.d+=" Q "+t+" "+(r+9)+" "+(t-9)+" "+(r+9),t-=9,r+=9,e.width>1&&(t-=e.pixelWidth,e.d+=" L "+t+" "+r),e.d+=" Q "+(t-9)+" "+r+" "+(t-9)+" "+(r-9),t-=9,r-=9,e.contentHeight>0&&(r-=e.contentHeight-0,e.d+=" L "+t+" "+r)}),ot.selectAll(".node").data(e).enter().append("path").attr("id",function(e){return e.name}).attr("d",function(e){return e.d}).on("mouseover",ke).on("mouseout",Ne).on("dblclick",Me).style("fill","#fff").style("fill-opacity",xt.showExonsFlag?"0.4":"0.6").style("stroke","black").style("stroke-width","2px").append("svg:title").text(function(e){return e.name})}function fe(e){0===xt.nodeWidthOption&&ot.selectAll("text").data(e).enter().append("text").attr("x",function(e){return e.x-4}).attr("y",function(e){return e.y+4}).text(function(e){return e.seq}).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none")}function ge(){for(var e=0;ht[e].name!==St;)e+=1;var t=ht[e];ot.append("line").attr("x1",0).attr("y1",Ft-10).attr("x2",Nt).attr("y2",Ft-10).attr("stroke-width",1).attr("stroke","black");var r=100;0===xt.nodeWidthOption&&(r=20);var n=t.indexOfFirstBase,o=!1;t.indexSequence.forEach(function(e){for(var t=st[e],a=Math.ceil(n/r)*r;a<n+t.sequenceLength;){ye(a,de(t,a-n)),o=!0,a+=r}n+=st[e].sequenceLength}),o||ye(t.indexOfFirstBase,st[t.indexSequence[0]].x-4)}function ye(e,t){ot.append("text").attr("x",t).attr("y",Ft-13).text("|"+e).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","12px").attr("fill","black").style("pointer-events","none")}function ve(e,t){return function(r){return r[e]===t}}function we(e,t){void 0===t&&(t="haplo"),e=e.filter(ve("type",t)),ot.selectAll("trackRectangles").data(e).enter().append("rect").attr("x",function(e){return e.xStart}).attr("y",function(e){return e.yStart}).attr("width",function(e){return e.xEnd-e.xStart+1}).attr("height",function(e){return e.yEnd-e.yStart+1}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",Oe).on("mouseout",Fe).on("dblclick",Se)}function xe(e,t){return e[6]<t[6]?-1:e[6]>t[6]?1:0}function me(){var e=ot.append("defs").append("pattern").attr({id:"patternA",width:"7",height:"7",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"});e.append("rect").attr({x:"0",y:"0",width:"7",height:"7",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"0",y:"4",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"4",y:"0",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"4",y:"4",width:"3",height:"3",fill:"#505050"}),e=ot.append("defs").append("pattern").attr({id:"patternB",width:"8",height:"8",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"8",height:"8",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"0",y:"5",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"5",y:"0",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"5",y:"5",width:"3",height:"3",fill:"#1f77b4"}),e=ot.append("defs").append("pattern").attr({id:"plaid0",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#1f77b4"}),e=ot.append("defs").append("pattern").attr({id:"plaid1",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),e=ot.append("defs").append("pattern").attr({id:"plaid2",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#2ca02c"}),e=ot.append("defs").append("pattern").attr({id:"plaid3",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#d62728"}),e=ot.append("defs").append("pattern").attr({id:"plaid4",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#9467bd"}),e=ot.append("defs").append("pattern").attr({id:"plaid5",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#8c564b"}),
e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#8c564b"})}function qe(e){void 0===e&&(e="haplo");var t=qt.filter(ve("type",e));t.sort(xe),t.forEach(function(e){var t=(e.xStart+e.xEnd)/2,r="M "+e.xStart+" "+e.yStart;r+=" C "+t+" "+e.yStart+" "+t+" "+e.yEnd+" "+e.xEnd+" "+e.yEnd,r+=" V "+(e.yEnd+e.width),r+=" C "+t+" "+(e.yEnd+e.width)+" "+t+" "+(e.yStart+e.width)+" "+e.xStart+" "+(e.yStart+e.width),r+=" Z",e.path=r}),ot.selectAll("trackCurves").data(qt).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",Oe).on("mouseout",Fe).on("dblclick",Se)}function Ee(e,t){void 0===t&&(t="haplo"),e=e.filter(ve("type",t)),ot.selectAll("trackCorners").data(e).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",Oe).on("mouseout",Fe).on("dblclick",Se)}function be(){for(var e='<table class="table-sm table-condensed table-nonfluid"><thead><tr><th>Color</th><th>Trackname</th><th>Show Track</th></tr></thead>',t=[],r=0;r<ht.length;r+=1)"haplo"===ht[r].type&&(e+='<tr><td style="text-align:right"><div class="color-box" style="background-color: '+oe(ht[r],"exon")+';"></div></td>',e+=ht[r].hasOwnProperty("name")?"<td>"+ht[r].name+"</td>":"<td>"+ht[r].id+"</td>",e+='<td><input type="checkbox" checked=true id="showTrack'+r+'"></td>',t.push(r));e+="</table",$("#legendDiv").html(e),t.forEach(function(e){document.getElementById("showTrack"+e).addEventListener("click",function(){return i(e)},!1)})}function Oe(){var e=d3.select(this).attr("trackID");d3.selectAll(".track"+e).style("fill","url(#patternA)")}function ke(){d3.select(this).style("stroke-width","4px")}function Fe(){var e=d3.select(this).attr("trackID");d3.selectAll(".track"+e).each(function(){var e=d3.select(this).attr("color");d3.select(this).style("fill",e)})}function Ne(){d3.select(this).style("stroke-width","2px")}function Se(){for(var e=d3.select(this).attr("trackID"),t=0;t<it.length&&it[t].id!==Number(e);)t+=1;t>=it.length||(console.log("moving index: "+t),o(t),p())}function Me(){var e=d3.select(this).attr("id");xt.clickableNodesFlag&&(ct&&xt.showReads?(document.getElementById("hgvmNodeID").value=e,document.getElementById("hgvmPostButton").click()):(document.getElementById("nodeID").value=e,document.getElementById("postButton").click()))}function Le(e){var t=[];return e.node.forEach(function(e){t.push({name:""+e.id,sequenceLength:e.sequence.length,seq:e.sequence})}),t}function Ce(){switch(st.forEach(function(e){e.hasOwnProperty("sequenceLength")||(e.sequenceLength=e.seq.length)}),xt.nodeWidthOption){case 1:st.forEach(function(e){e.width=1+Math.log(e.sequenceLength)/Math.log(2),e.pixelWidth=Math.round(8.401*(e.width-1))});break;case 2:st.forEach(function(e){e.width=e.sequenceLength/100,e.pixelWidth=Math.round(8.401*(e.width-1))});break;default:st.forEach(function(e){e.width=e.sequenceLength,ot.append("text").attr("x",0).attr("y",100).attr("id","dummytext").text(e.seq.substr(1)).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none"),e.pixelWidth=Math.round(document.getElementById("dummytext").getComputedTextLength()),$("#dummytext").remove()})}}function Ie(e){var t=[];return e.path.forEach(function(e,r){var n=[],o=!0;e.mapping.forEach(function(e){e.position.hasOwnProperty("is_reverse")&&e.position.is_reverse===!0?n.push("-"+e.position.node_id):(n.push(""+e.position.node_id),o=!1)}),o&&(n.reverse(),n.forEach(function(e,t){n[t]=e.substr(1)}));var a={};a.id=r,a.sequence=n,e.hasOwnProperty("freq")&&(a.freq=e.freq),e.hasOwnProperty("name")&&(a.name=e.name),e.hasOwnProperty("indexOfFirstBase")&&(a.indexOfFirstBase=Number(e.indexOfFirstBase)),t.push(a)}),t}function Pe(e,t,r){console.log(r);var n=[],o=[];e.forEach(function(e){o.push(parseInt(e.name,10))});for(var a=0;a<r.length;a+=1)!function(e){var a=r[e],i=[],d=[],s=-1,h=-1;if(a.path.mapping.forEach(function(t,r){if(o.indexOf(t.position.node_id)>-1){var n={},a=0;t.position.hasOwnProperty("is_reverse")&&t.position.is_reverse===!0?(i.push("-"+t.position.node_id),n.nodeName="-"+t.position.node_id):(i.push(""+t.position.node_id),n.nodeName=t.position.node_id.toString()),s<0&&(s=r,t.position.hasOwnProperty("offset")&&(a=t.position.offset)),h=r;var c=[],l=a;t.edit.forEach(function(n){n.hasOwnProperty("to_length")&&!n.hasOwnProperty("from_length")?c.push({type:"insertion",pos:l,seq:n.sequence}):!n.hasOwnProperty("to_length")&&n.hasOwnProperty("from_length")?c.push({type:"deletion",pos:l,length:n.from_length}):n.hasOwnProperty("sequence")&&(n.sequence.length>1&&console.log("found substitution at read "+e+", node "+r+" = "+t.position.node_id+", seq = "+n.sequence),c.push({type:"substitution",pos:l,seq:n.sequence})),n.hasOwnProperty("from_length")&&(l+=n.from_length)}),n.mismatches=c,d.push(n)}}),0===i.length)console.log("read "+e+" is empty");else{var c={};c.id=t.length+n.length,c.sequence=i,c.sequenceNew=d,c.type="read",a.path.hasOwnProperty("freq")&&(c.freq=a.path.freq),a.path.hasOwnProperty("name")&&(c.name=a.path.name),c.firstNodeOffset=0,a.path.mapping[s].position.hasOwnProperty("offset")&&(c.firstNodeOffset=a.path.mapping[s].position.offset);var l=a.path.mapping[h].edit;c.finalNodeCoverLength=0,a.path.mapping[h].position.hasOwnProperty("offset")&&(c.finalNodeCoverLength+=a.path.mapping[h].position.offset),l.forEach(function(e){e.hasOwnProperty("from_length")&&(c.finalNodeCoverLength+=e.from_length)}),n.push(c)}}(a);return n}function De(){for(var e=void 0,t=void 0,r=[],n=[],o=0;o<st.length;o+=1)r.push(new Set),n.push(new Set);var a=void 0;a=ct&&xt.showReads?ht.concat(ct):ht,a.forEach(function(o){for(var a=0;a<o.sequence.length;a+=1)"-"!==o.sequence[a].charAt(0)?(a>0?(e=o.sequence[a-1],r[pt.get(o.sequence[a])].add(e),"-"===e.charAt(0)&&r[pt.get(o.sequence[a])].add(e.substr(1))):"haplo"===o.type&&r[pt.get(o.sequence[a])].add("None"),a<o.sequence.length-1?(e=o.sequence[a+1],n[pt.get(o.sequence[a])].add(e),"-"===e.charAt(0)&&n[pt.get(o.sequence[a])].add(e.substr(1))):"haplo"===o.type&&n[pt.get(o.sequence[a])].add("None")):(e=o.sequence[a].substr(1),a>0?(t=o.sequence[a-1],"-"===t.charAt(0)?n[pt.get(e)].add(t.substr(1)):(n[pt.get(e)].add(t),n[pt.get(e)].add("-"+t))):"haplo"===o.type&&n[pt.get(e)].add("None"),a<o.sequence.length-1?(t=o.sequence[a+1],"-"===t.charAt(0)?r[pt.get(e)].add(t.substr(1)):(r[pt.get(e)].add(t),r[pt.get(e)].add("-"+t))):"haplo"===o.type&&r[pt.get(e)].add("None"))});for(var i=0;i<st.length;i+=1)n[i]=Array.from(n[i]),r[i]=Array.from(r[i]);if(ct&&xt.showReads){var d=st.slice();d.sort(X);var s=new Map,h=new Map;d.forEach(function(e){var t=Ae(pt.get(e.name),r,n);t?(s.set(e.name,s.get(t)+st[pt.get(t)].sequenceLength),h.set(e.name,h.get(t))):(s.set(e.name,0),h.set(e.name,e.name))}),ct.forEach(function(e){e.firstNodeOffset+=s.get(e.sequence[0]),e.finalNodeCoverLength+=s.get(e.sequence[e.sequence.length-1]);for(var t=e.sequence.length-1;t>=0;t-=1)Ae(pt.get(e.sequence[t]),r,n)&&function(){var o=Ae(pt.get(e.sequence[t]),r,n);Re(pt.get(o),r,n)&&(t>0?(e.sequence.splice(t,1),e.sequenceNew[t].mismatches.forEach(function(e){e.pos+=st[pt.get(o)].sequenceLength}),e.sequenceNew[t-1].mismatches=e.sequenceNew[t-1].mismatches.concat(e.sequenceNew[t].mismatches),e.sequenceNew.splice(t,1)):(e.sequence[0]=h.get(e.sequence[0]),e.sequenceNew[t].mismatches.forEach(function(t){t.pos+=s.get(e.sequenceNew[0].nodeName)}),e.sequenceNew[0].nodeName=h.get(e.sequenceNew[0].nodeName)))}()})}for(var c=0;c<st.length;c+=1)if(Re(c,r,n)&&!Ae(c,r,n))for(var l=c;Re(l,r,n);)l=n[l][0],"-"===l.charAt(0)&&(l=l.substr(1)),l=pt.get(l),st[c].hasOwnProperty("sequenceLength")?st[c].sequenceLength+=st[l].sequenceLength:st[c].width+=st[l].width,st[c].seq+=st[l].seq;ht.forEach(function(t){for(var o=t.sequence.length-1;o>=0;o-=1){e=t.sequence[o],"-"===e.charAt(0)&&(e=e.substr(1));Ae(pt.get(e),r,n)&&t.sequence.splice(o,1)}});for(var u=st.length-1;u>=0;u-=1)Ae(u,r,n)&&st.splice(u,1)}function Ae(e,t,r){if(1!==t[e].length)return!1;if("None"===t[e][0])return!1;var n=t[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var o=pt.get(n);return 1===r[o].length&&("None"!==r[o][0]&&n)}function Re(e,t,r){if(1!==r[e].length)return!1;if("None"===r[e][0])return!1;var n=r[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var o=pt.get(n);return 1===t[o].length&&"None"!==t[o][0]}function _e(){ht.forEach(function(e,t){"read"===e.type&&e.sequenceNew.forEach(function(t,r){t.mismatches.forEach(function(n){for(var o=pt.get(t.nodeName),a=st[o],i=de(a,n.pos),d=r;e.path[d].node!==o;)d+=1;var s=e.path[d].y;if("insertion"===n.type)!xt.showSoftClips&&(n.pos===e.firstNodeOffset&&0===r||n.pos===e.finalNodeCoverLength&&r===e.sequenceNew.length-1)||He(i-3,s+7,n.seq,a.y);else if("deletion"===n.type){var h=de(a,n.pos+n.length);Be(i,h,s+4,a.y)}else if("substitution"===n.type){var c=de(a,n.pos+n.seq.length);Te(i+1,c,s+7,a.y,n.seq)}})})})}function He(e,t,r,n){ot.append("text").attr("x",e).attr("y",t).text("*").attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","12px").attr("fill","black").attr("nodeY",n).on("mouseover",We).on("mouseout",Qe).append("svg:title").text(r)}function Te(e,t,r,n,o){ot.append("text").attr("x",e).attr("y",r).text(o).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","12px").attr("fill","black").attr("nodeY",n).attr("rightX",t).on("mouseover",Ye).on("mouseout",ze)}function Be(e,t,r,n){ot.append("line").attr("x1",e).attr("y1",r-1).attr("x2",t).attr("y2",r-1).attr("stroke-width",7).attr("stroke","grey").attr("nodeY",n).on("mouseover",Ue).on("mouseout",Je)}function We(){d3.select(this).attr("fill","red");var e=Number(d3.select(this).attr("x")),t=Number(d3.select(this).attr("y")),r=Number(d3.select(this).attr("nodeY"));ot.append("line").attr("class","insertionHighlight").attr("x1",e+4).attr("y1",t-10).attr("x2",e+4).attr("y2",r+5).attr("stroke-width",1).attr("stroke","black")}function Ue(){d3.select(this).attr("stroke","red");var e=Number(d3.select(this).attr("x1")),t=Number(d3.select(this).attr("x2")),r=Number(d3.select(this).attr("y1")),n=Number(d3.select(this).attr("nodeY"));ot.append("line").attr("class","deletionHighlight").attr("x1",e).attr("y1",r-3).attr("x2",e).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black"),ot.append("line").attr("class","deletionHighlight").attr("x1",t).attr("y1",r-3).attr("x2",t).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black")}function Ye(){d3.select(this).attr("fill","red");var e=Number(d3.select(this).attr("x")),t=Number(d3.select(this).attr("rightX")),r=Number(d3.select(this).attr("y")),n=Number(d3.select(this).attr("nodeY"));ot.append("line").attr("class","substitutionHighlight").attr("x1",e-1).attr("y1",r-7).attr("x2",e-1).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black"),ot.append("line").attr("class","substitutionHighlight").attr("x1",t+1).attr("y1",r-7).attr("x2",t+1).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black")}function Qe(){d3.select(this).attr("fill","black"),d3.selectAll(".insertionHighlight").remove()}function Je(){d3.select(this).attr("stroke","grey"),d3.selectAll(".deletionHighlight").remove()}function ze(){d3.select(this).attr("fill","grey"),d3.selectAll(".substitutionHighlight").remove()}Object.defineProperty(r,"__esModule",{value:!0}),r.create=n,r.changeTrackVisibility=i,r.changeExonVisibility=d,r.setMergeNodesFlag=s,r.setSoftClipsFlag=h,r.setShowReadsFlag=c,r.setColorSet=l,r.setNodeWidthOption=u,r.useColorScheme=te,r.vgExtractNodes=Le,r.vgExtractTracks=Ie,r.vgExtractReads=Pe;var Ze=!1,je=["#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],Ge=["#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],Ve=["#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],Xe=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],$e=["#ABCCE3","#FFCFA5","#B0DBB0","#F0AEAE","#D7C6E6","#C6ABA5","#F4CCE8","#CFCFCF","#E6E6AC","#A8E7ED"],Ke=[],et=[],tt=[],rt=[],nt=void 0,ot=void 0,at=[],it=[],dt=[],st=void 0,ht=void 0,ct=void 0,lt=void 0,ut=void 0,pt=void 0,ft=void 0,gt=[],yt=[],vt=[],wt=void 0,xt={mergeNodesFlag:!0,clickableNodesFlag:!1,showExonsFlag:!1,colorScheme:0,nodeWidthOption:0,showReads:!0,showSoftClips:!0,haplotypeColors:"plainColors",forwardReadColors:"reds",reverseReadColors:"blues",exonColors:"lightColors",hideLegendFlag:!1},mt=[],qt=[],Et=[],bt=[],Ot=[],kt=0,Ft=0,Nt=0,St=void 0,Mt=void 0},{}]},{},[1]);