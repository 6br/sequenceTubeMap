# Sequence Tube Maps

![Header Graphic](/images/header.png)

### A JavaScript module for the visualization of genomic sequence graphs. It automatically generates a "tube map"-like visualization of given sequence graphs.

Graph data structures allow the encoding of multiple related sequences in a single data structure. The intention is to simplify the comparison of multiple sequences by making it easy to find the sequences' similarities and differences.

The purpose of this module is to generate visual representations of such graph data structures, which display the data in an intuitive way.

Genomic sequence graphs consist of nodes and paths:

* A **Node** represents a specific sequence of bases. The length of this sequence determines the node's width in the graphical display.
* A **Path** connects multiple nodes. Each path represents one of the sequences underlying the graph data structure and its walk along multiple nodes.

This simple example shows to paths along three nodes:

![Simple Example 1](/images/example1.png)

Since both paths connect the same nodes, their sequences are identical (and the three nodes could actually be merged into a single one). If the two sequences would differ somewhere in the middle, this would result in the following image:

![Simple Example 2](/images/example2.png)

The way genomic sequences change in living organisms can lead to subsequences being inverted. For these cases, instead of creating two different nodes, a single node is traversed in two different directions:

![Simple Example 3](/images/example3.png)

## Usage

There is a working demo at [https://wolfib.github.io/sequenceTubeMap/](https://wolfib.github.io/sequenceTubeMap/). It contains example visualizations as well as a way to generate visalizations from custom data.

A second option is to include the module in your own code. The whole visualization logic is contained in [`sequenceTubeMap.js`](https://github.com/wolfib/sequenceTubeMap/blob/master/sequenceTubeMap.js). There are a handful of css rules defined in [`sequenceTubeMapStyle.css`](https://github.com/wolfib/sequenceTubeMap/blob/master/sequenceTubeMapStyle.css). For the actual drawing the module uses [d3.js](https://d3js.org/), so this library has to be included as well. A minimal example would look like this:

```html
<!DOCTYPE html>
<html>
<head>
  <title>sequenceTubeMap.js Minimal Example</title>
  <script type="text/javascript" src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="sequenceTubeMap.js"></script>
  <link rel="stylesheet" type="text/css" href="sequenceTubeMapStyle.css">
</head>
<body>
  <p>A minimal example created with sequenceTubeMap.js:</p>
  <div id="chart"></div>

  <script type="text/javascript">

    var nodes = [
      {name: "A", width: 1},
      {name: "B", width: 2},
      {name: "C", width: 3}
    ];

    var paths = [
      {id: 0, sequence: ["A", "B", "C"]},
      {id: 1, sequence: ["A", "B", "C"]},
      {id: 2, sequence: ["A", "C"]}
    ];

    var svg = d3.select("#chart").append("svg");

    sequenceTubeMap.create(svg, nodes, paths);

  </script>
</body>
</html>
```
(See the result [here](https://wolfib.github.io/sequenceTubeMap/miniExample.html).)

[`sequenceTubeMap.js`](https://github.com/wolfib/sequenceTubeMap/blob/master/sequenceTubeMap.js) uses very simple custom JSON data structures for its input data:

Nodes are defined by a `name` attribute (has to be unique) and either a `width` or a `sequenceLength` attribute. `width` determines the node's width directly whereas `sequenceLength` is used as input into a scaling function whose return value is the actual node 'width' attribute to be used in the visualization.
```javascript
var nodes = [
  {name: "A", width: 1},
  {name: "B", width: 2},
  {name: "C", width: 3}
];

var nodes = [
  {name: "A", sequenceLength: 1},
  {name: "B", sequenceLength: 2},
  {name: "C", sequenceLength: 3}
];
```

Paths each have a unique and consecutively numbered `id` attribute (starting with 0) and a `sequence` attribute which contains a array of node `name` attributes. If a node is traversed in reversed direction, the node `name` is prefixed by a `-`-symbol.
```javascript
var paths = [
  {id: 0, sequence: ["A", "B", "C"]},
  {id: 1, sequence: ["A", "-C", "-B"]},
  {id: 2, sequence: ["A", "C"]}
];
```

The sequence tube maps module also has the ability to parse json data generated by [vg](https://github.com/vgteam/vg/) ([https://github.com/vgteam/vg/](https://github.com/vgteam/vg/)). vg builds variation graphs from sequence data. Its output are typically binary .vg files, which it can transform into JSON files via
```
vg view -j filename.vg >filename.json
```
JSON files generated in such a way can be parsed and displayed by the demo at [https://wolfib.github.io/sequenceTubeMap/](https://wolfib.github.io/sequenceTubeMap/).

## License
Copyright (c) 2016 Wolfgang Beyer, licensed under the MIT License.
