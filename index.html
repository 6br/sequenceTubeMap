<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>sequenceTubeMap.js Demo</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="sequenceTubeMap.js"></script>

<style type="text/css">

  body {
    margin: 25px
  }

  label {
    font-weight: normal;
  }

  .tab-content {
    border-left: 1px solid #ddd;
    border-right: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
    padding: 10px;
  }

  .nav-tabs {
    margin-bottom: 0;
  }

  .limWidth {
    max-width: 500px;
  }

  .footer {
    font-size: 85%;
  }

  #chart0 {
    overflow: auto;
    width: 100%;
  }

</style>
</head>

<body>
  <div>
    <h1>Displaying Sequence Graphs as Tube Maps</h1>

    <ul class="nav nav-tabs">
      <li class="active"><a data-toggle="tab" href="#smallExamples">Small Examples</a></li>
      <li><a data-toggle="tab" href="#realExamples">Examples from Real Data</a></li>
      <li><a data-toggle="tab" href="#customData">Use Custom Data</a></li>
    </ul>

    <div class="tab-content">

      <div id="smallExamples" class="tab-pane fade in active">
        <p>
          <button type="button" class="btn btn-primary active" aria-pressed="true" id="example1">Example 1</button> Only indels and polymorphisms
        </p>
        <p>
          <button type="button" class="btn btn-primary" id="example2">Example 2</button> Inversions
        </p>
        <p>
          <button type="button" class="btn btn-primary" id="example3">Example 3</button> Nested Inversions
        </p>
        <p>
          <button type="button" class="btn btn-primary" id="example4">Example 4</button> Duplications
        </p>
        <p>
          <button type="button" class="btn btn-primary" id="example5">Example 5</button> Translocations
        </p>
      </div>

      <div id="realExamples" class="tab-pane fade">
        <p class="limWidth">
          The data for these examples has been taken from the GRCh38 Primary Assembly of the Homo sapiens chromosome 6
          and are part of the genomic scaffold. The graph data structures which are being visualized here were
          generated by <a href="https://github.com/vgteam/vg">vg vg (https://github.com/vgteam/vg/)</a>.
        </p>
        <p>
          <button type="button" class="btn btn-primary" id="example6">B-3106</button> &nbsp;
          sequence file: <a href="exampleData/B-3106.fa">B-3106.fa</a> &nbsp;&nbsp;&nbsp;
          vg file: <a href="exampleData/B-3106.vg">B-3106.vg</a>
        </p>
        <p>
          <button type="button" class="btn btn-primary" id="example7">C-3107</button> &nbsp;
          sequence file: <a href="exampleData/C-3107.fa">C-3107.fa</a> &nbsp;&nbsp;&nbsp;
          vg file: <a href="exampleData/C-3107.vg">C-3107.vg</a>
        </p>
        <p>
          <button type="button" class="btn btn-primary" id="example8">DQA1-3117</button> &nbsp;
          sequence file: <a href="exampleData/DQA1-3117.fa">DQA1-3117.fa</a> &nbsp;&nbsp;&nbsp;
          vg file: <a href="exampleData/DQA1-3117.vg">DQA1-3117.vg</a>
        </p>
        <p>
          <button type="button" class="btn btn-primary" id="example9">F-3134</button> &nbsp;
          sequence file: <a href="exampleData/F-3134.fa">F-3134.fa</a> &nbsp;&nbsp;&nbsp;
          vg file: <a href="exampleData/F-3134.vg">F-3134.vg</a>
        </p>
        <br />
        <form class="form">
          <p>
            Node width proportional to...
          </p>
          <div class="radio">
            <label>
              <input type="radio" name="scalingRadios1" id="linear1" value="option1">
              number of the node's base pairs
            </label>
          </div>
          <div class="radio">
            <label>
              <input type="radio" name="scalingRadios1" id="log21" value="option2" checked>
              log<sub>2</sub> of the number of the node's base pairs
            </label>
          </div>
          <div class="radio">
            <label>
              <input type="radio" name="scalingRadios1" id="log101" value="option3">
              log<sub>10</sub> of the number of the node's base pairs
            </label>
          </div>
          <label><input type="checkbox" id="redundantNodesCheckbox1"> Remove redundant nodes</label><br>
        </form>
      </div>

      <div id="customData" class="tab-pane fade">
        <p>
          Parses JSON data generated by <a href="https://github.com/vgteam/vg/">vg (https://github.com/vgteam/vg/)</a>.
        </p>
        <p class="limWidth">
          vg generates variation graphs from sequence data. It is able to output these sequence graphs in a JSON format via the following command:
          <pre class="form limWidth">vg view -j filename.vg >filename.json</pre>
        </p>
        <form class="form limWidth">
          <textarea class="form-control" id="textarea1" rows="12" cols="90" placeholder="Paste vg-generated JSON here or pick file..."></textarea><br />
          <input type="file" id="inputFile"><br />
          <p>
            Node width proportional to...
          </p>
          <div class="radio">
            <label>
              <input type="radio" name="scalingRadios2" id="linear2" value="option1">
              number of the node's base pairs
            </label>
          </div>
          <div class="radio">
            <label>
              <input type="radio" name="scalingRadios2" id="log22" value="option2" checked>
              log<sub>2</sub> of the number of the node's base pairs
            </label>
          </div>
          <div class="radio">
            <label>
              <input type="radio" name="scalingRadios2" id="log102" value="option3">
              log<sub>10</sub> of the number of the node's base pairs
            </label>
          </div>

        </form><br />
        <p>
          <button type="button" class="btn btn-primary" id="parseButton">Parse</button>
        </p>
        <form class="form-horizontal">
          <label><input type="checkbox" id="redundantNodesCheckbox2"> Remove redundant nodes</label><br>
        </form>
      </div>
    </div>

    <br />
    <div id="chart0">
      <svg id="svg">
      </svg>
    </div>
    <p class="footer"><br /><br /><br />
      Hover over a track to highlight.<br />
      Click on a track to move it to the top and rearrange the visualization according to the clicked track's sequence.<br />
      <!--<a href="index.html" id="downloadLink">Save image</a>-->
    </p>
      &nbsp;
  </div>

<script type="text/javascript">

  document.getElementById("example1").onclick = function() {
    sequenceTubeMap.create(svg, inputNodes, inputTracks1);
    makeSaveable();
  };

  document.getElementById("example2").onclick = function() {
    $("#example1").removeClass("active");
    sequenceTubeMap.create(svg, inputNodes, inputTracks2);
    makeSaveable();
  };

  document.getElementById("example3").onclick = function() {
    $("#example1").removeClass("active");
    sequenceTubeMap.create(svg, inputNodes, inputTracks3);
    makeSaveable();
  };

  document.getElementById("example4").onclick = function() {
    $("#example1").removeClass("active");
    sequenceTubeMap.create(svg, inputNodes, inputTracks4);
    makeSaveable();
  };

  document.getElementById("example5").onclick = function() {
    $("#example1").removeClass("active");
    sequenceTubeMap.create(svg, inputNodes, inputTracks5);
    makeSaveable();
  };

  document.getElementById("example6").onclick = function() {
    $("#example1").removeClass("active");
    displayVGjson('exampleData/B-3106.json');
  };

  document.getElementById("example7").onclick = function() {
    $("#example1").removeClass("active");
    displayVGjson('exampleData/C-3107.json');
  };

  document.getElementById("example8").onclick = function() {
    $("#example1").removeClass("active");
    displayVGjson('exampleData/DQA1-3117.json');
  };

  document.getElementById("example9").onclick = function() {
    $("#example1").removeClass("active");
    displayVGjson('exampleData/F-3134.json');
  };

  document.getElementById("parseButton").onclick = function() {
    $("#example1").removeClass("active");
    var vg = JSON.parse(document.getElementById("textarea1").value);
    var nodes = sequenceTubeMap.vgExtractNodes(vg);
    var tracks = sequenceTubeMap.vgExtractTracks(vg);
    sequenceTubeMap.create(svg, nodes, tracks);
    makeSaveable();
  };

  document.getElementById('inputFile').addEventListener('change', function(e) {
    var file = document.getElementById('inputFile').files[0];
    var reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById("textarea1").value = reader.result;
		};
		reader.readAsText(file);
  });

  document.getElementById("redundantNodesCheckbox1").onclick = function() {
    document.getElementById("redundantNodesCheckbox2").checked = document.getElementById("redundantNodesCheckbox1").checked;
    if (document.getElementById("redundantNodesCheckbox1").checked === true) sequenceTubeMap.setMergeNodesFlag(true);
    else sequenceTubeMap.setMergeNodesFlag(false);
  };

  document.getElementById("redundantNodesCheckbox2").onclick = function() {
    document.getElementById("redundantNodesCheckbox1").checked = document.getElementById("redundantNodesCheckbox2").checked;
    if (document.getElementById("redundantNodesCheckbox2").checked === true) sequenceTubeMap.setMergeNodesFlag(true);
    else sequenceTubeMap.setMergeNodesFlag(false);
  };

  document.getElementById("linear1").onchange = function() {
    document.getElementById("linear2").checked = true;
    sequenceTubeMap.setNodeWidthOption(0);
  };

  document.getElementById("log21").onchange = function() {
    document.getElementById("log22").checked = true;
    sequenceTubeMap.setNodeWidthOption(1);
  };

  document.getElementById("log101").onchange = function() {
    document.getElementById("log102").checked = true;
    sequenceTubeMap.setNodeWidthOption(2);
  };

  document.getElementById("linear2").onchange = function() {
    document.getElementById("linear1").checked = true;
    sequenceTubeMap.setNodeWidthOption(0);
  };

  document.getElementById("log22").onchange = function() {
    document.getElementById("log21").checked = true;
    sequenceTubeMap.setNodeWidthOption(1);
  };

  document.getElementById("log102").onchange = function() {
    document.getElementById("log101").checked = true;
    sequenceTubeMap.setNodeWidthOption(2);
  };

  var inputNodes = [
    {name: "A", width: 1, seq: "A"},
    {name: "B", width: 2, seq: "AA"},
    {name: "C", width: 1, seq: "T"},
    {name: "D", width: 3, seq: "GGG"},
    {name: "E", width: 1, seq: "A"},
    {name: "F", width: 1, seq: "G"},
    {name: "G", width: 3, seq: "ATG"},
    {name: "H", width: 1, seq: "T"},
    {name: "I", width: 1, seq: "C"},
    {name: "J", width: 3, seq: "TAA"},
    {name: "K", width: 1, seq: "C"},
    {name: "L", width: 1, seq: "G"},
    {name: "M", width: 1, seq: "C"},
    {name: "N", width: 1, seq: "A"},
    {name: "O", width: 1, seq: "C"},
    {name: "P", width: 2, seq: "AA"},
    {name: "Q", width: 1, seq: "T"},
    {name: "R", width: 1, seq: "C"},
    {name: "S", width: 2, seq: "GA"},
    {name: "T", width: 3, seq: "GTT"},
    {name: "U", width: 1, seq: "A"},
    {name: "V", width: 1, seq: "G"},
    {name: "W", width: 8, seq: "TTGTCTCT"},
    {name: "X", width: 1, seq: "T"},
    {name: "Y", width: 1, seq: "C"},
    {name: "Z", width: 1, seq: "A"},
    {name: "AA", width: 1, seq: "C"},
    {name: "AB", width: 1, seq: "T"},
    {name: "AC", width: 1, seq: "G"},
    {name: "AD", width: 1, seq: "A"},
    {name: "AE", width: 1, seq: "G"},
    {name: "AF", width: 1, seq: "T"},
    {name: "AG", width: 3, seq: "GTG"}
  ];

  var inputTracks1 = [
    {id: 0, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "U", "W", "X", "Z", "AA", "AE", "AG"]},
    {id: 1, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "Q", "S", "U", "AA", "AE", "AG"]},
    {id: 2, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "V", "W", "X", "Z", "AB", "AE", "AG"]},
    {id: 3, sequence: ["B", "C", "D", "E", "G", "H", "J", "L", "M", "N", "P", "R", "S", "U", "W", "Y", "Z", "AC", "AF", "AG"]},
    {id: 4, sequence: ["B", "D", "F", "G", "I", "J", "L", "M", "O", "P", "Q", "S", "T", "V", "W", "Y", "Z", "AD", "AF", "AG"]}
  ];

  var inputTracks2 = [
    {id: 0, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "U", "W", "X", "Z", "AA", "AE", "AG"]},
    {id: 1, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "Q", "S", "U", "AA", "AE", "AG"]},
    {id: 2, sequence: ["A", "B", "D", "F", "-H", "-G", "-E", "J", "K", "M", "N", "P", "Q", "S", "AB", "V", "W", "X", "-AE", "-AA", "-Z", "AG"]},
    {id: 3, sequence: ["B", "C", "D", "E", "G", "H", "J", "L", "-P", "-N", "-M", "R", "S", "U", "W", "Y", "Z", "AC", "AF", "AG"]},
    {id: 4, sequence: ["B", "D", "F", "-J", "-I", "-G", "L", "M", "O", "P", "Q", "S", "T", "V", "W", "Y", "Z", "AD", "AF", "AG"]}
  ];

  var inputTracks3 = [
    {id: 0, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "U", "W", "X", "Z", "AA", "AE", "AG"]},
    {id: 1, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "Q", "S", "U", "AA", "AE", "AG"]},
    {id: 2, sequence: ["A", "B", "D", "-H", "G", "-E", "J", "K", "M", "N", "P", "Q", "S", "AB", "V", "W", "X", "-AE", "-AA", "-Z", "AG"]},
    {id: 3, sequence: ["B", "C", "D", "E", "G", "H", "J", "L", "-P", "-N", "-M", "R", "S", "U", "W", "Y", "Z", "AC", "AF", "AG"]},
    {id: 4, sequence: ["B", "D", "F", "G", "I", "J", "L", "M", "O", "P", "Q", "S", "T", "V", "W", "Y", "Z", "AD", "AF", "AG"]}
  ];

  var inputTracks4 = [
    {id: 0, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "U", "W", "X", "Z", "AA", "AE", "AG"]},
    {id: 1, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "J", "N", "Q", "S", "U", "AA", "AE", "AG"]},
    {id: 2, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "V", "W", "X", "Z", "AB", "AE", "AG"]},
    {id: 3, sequence: ["B", "C", "D", "E", "D", "E", "G", "H", "J", "L", "M", "N", "P", "R", "S", "U", "W", "Y", "Z", "AC", "AF", "AG"]},
    {id: 4, sequence: ["B", "D", "F", "G", "I", "J", "L", "M", "O", "P", "Q", "S", "T", "V", "W", "Y", "Z", "AD", "AF", "AG"]}
  ];

  var inputTracks5 = [
    {id: 0, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "U", "W", "X", "Z", "AA", "AE", "AG"]},
    {id: 1, sequence: ["A", "B", "D", "E", "G", "H", "J", "Q", "K", "M", "N", "S", "U", "AA", "AE", "AG"]},
    {id: 2, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "V", "W", "X", "Z", "AB", "AE", "AG"]},
    {id: 3, sequence: ["B", "C", "D", "H", "E", "G", "J", "L", "M", "N", "P", "R", "S", "U", "W", "Y", "Z", "AC", "AF", "AG"]},
    {id: 4, sequence: ["B", "D", "F", "G", "I", "J", "L", "M", "O", "P", "Q", "S", "T", "V", "W", "Y", "Z", "AD", "AF", "AG"]}
  ];

  //var svg = d3.select("#chart0") //Create SVG element
  //  .append("svg");
  var svg = d3.select("#svg"); //Create SVG element

  function loadJSON(filename, callback) {
    var xobj = new XMLHttpRequest();
    xobj.overrideMimeType("application/json");
    xobj.open('GET', filename, true);
    xobj.onreadystatechange = function () {
      if (xobj.readyState == 4 && xobj.status == "200") {
        callback(xobj.responseText);
      }
    };
    xobj.send(null);
   }

  function displayVGjson(filename) {
    loadJSON(filename, function(response) {
      var vg = JSON.parse(response);
      var nodes = sequenceTubeMap.vgExtractNodes(vg);
      var tracks = sequenceTubeMap.vgExtractTracks(vg);
        sequenceTubeMap.create(svg, nodes, tracks);
        makeSaveable();
    });
  }

  function makeSaveable() {
    /*
    //get svg element.
    var svgN = document.getElementById("svg");

    //get svg source.
    var serializer = new XMLSerializer();
    var source = serializer.serializeToString(svgN);

    //add name spaces.
    if(!source.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)){
        source = source.replace(/^<svg/, '<svg xmlns="http://www.w3.org/2000/svg"');
    }
    if(!source.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)){
        source = source.replace(/^<svg/, '<svg xmlns:xlink="http://www.w3.org/1999/xlink"');
    }

    //add xml declaration
    source = '<?xml version="1.0" standalone="no"?>\r\n' + source;

    //convert svg source to URI data scheme.
    var url = "data:image/svg+xml;charset=utf-8,"+encodeURIComponent(source);

    //set url value to a element's href attribute.
    document.getElementById("downloadLink").href = url;
    //you can download svg file by right click menu.
    */
  }

  document.getElementById("example1").click();
  makeSaveable();

</script>
</body>
</html>
