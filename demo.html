<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>sequenceTubeMap.js Demo</title>
<!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">-->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script type="text/javascript" src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="sequenceTubeMap.js"></script>
<style type="text/css">
  .node {
	fill: #fff;
	stroke: #444;
	stroke-width: 3px;
  }
  .link {
    fill: none;
    /*stroke: #ccc;*/
    stroke-width: 7px;
  }
  .backgr {
	fill: #fff;
  fill-opacity: 0.8;
	stroke: #fff;
	stroke-width: 0px;
  }
  .linkArc {
    stroke-width: 0px;
  }
  div {
    /*background-color: lightgrey;
    width: 300px;
    padding: 25px;
    border: 25px solid navy;*/
  /*  margin: 25px;*/
  }
  body {
    margin: 25px
  }
  label {
    font-weight: normal;
  }
  .tab-content {
    margin: 10px;
    min-height: 280px;
  }
  #chart0 {
    overflow: auto;
    width: 100%;
  }
</style>
</head>
<body>
  <div>
    <h1>Displaying Sequence Graphs as Tube Maps</h1>
    <ul class="nav nav-tabs">
      <li class="active"><a data-toggle="tab" href="#smallExamples">Small Examples</a></li>
      <li><a data-toggle="tab" href="#realExamples">Examples from Real Data</a></li>
      <li><a data-toggle="tab" href="#customData">Use Custom Data</a></li>
    </ul>

    <div class="tab-content">
      <div id="smallExamples" class="tab-pane fade in active">
        <!--<div>
          <div class = "floater left">-->
            <p>
              <button type="button" class="btn btn-primary active" aria-pressed="true" id="example1">Example 1</button> Only indels and polymorphisms
            </p>
            <p>
              <button type="button" class="btn btn-primary" id="example2">Example 2</button> Inversions
            </p>
            <p>
              <button type="button" class="btn btn-primary" id="example3">Example 3</button> Nested Inversions
            </p>
            <p>
              <button type="button" class="btn btn-primary" id="example4">Example 4</button> Duplications
            </p>
            <p>
              <button type="button" class="btn btn-primary" id="example5">Example 5</button> Translocations
            </p>
          <!--</div>
          <div style="clear: both;"></div>
        </div>-->
      </div>

      <div id="realExamples" class="tab-pane fade">
        <p>
          <button type="button" class="btn btn-primary" id="example6">B-3106</button>
        </p>
        <p>
          <button type="button" class="btn btn-primary" id="example7">C-3107</button>
        </p>
        <p>
          <button type="button" class="btn btn-primary" id="example8">DRA-3122</button>
        </p>
      </div>

      <div id="customData" class="tab-pane fade">
        <form class="form-horizontal">
          <textarea class="form-control" id="textarea1" rows="7" cols="90" placeholder="Paste json here or pick file..."></textarea><br />
          <input type="file" id="inputFile">
          <label><input type="checkbox" id="redundantNodesCheckbox"> Remove redundant nodes (requires redraw)</label><br>
        </form><br />
        <p>
          <button type="button" class="btn btn-primary" id="parseButton">Parse</button>
        </p>
      </div>
    </div>
    <div id="chart0"></div>
    <p>&nbsp;
  </div>

<script type="text/javascript">
  /*jshint loopfunc: true */
  /*jshint esversion: 6*/

  document.getElementById("example1").onclick = function() {
    sequenceTubeMap.create(svg, inputNodes, inputTracks1);
  };

  document.getElementById("example2").onclick = function() {
    $("#example1").removeClass("active");
    sequenceTubeMap.create(svg, inputNodes, inputTracks2);
  };

  document.getElementById("example3").onclick = function() {
    $("#example1").removeClass("active");
    sequenceTubeMap.create(svg, inputNodes, inputTracks3);
  };

  document.getElementById("example4").onclick = function() {
    $("#example1").removeClass("active");
    sequenceTubeMap.create(svg, inputNodes, inputTracks4);
  };

  document.getElementById("example5").onclick = function() {
    $("#example1").removeClass("active");
    sequenceTubeMap.create(svg, inputNodes, inputTracks5);
  };

  document.getElementById("example6").onclick = function() {
    $("#example1").removeClass("active");
    displayVGjson('B-3106.json');
  };

  document.getElementById("example7").onclick = function() {
    $("#example1").removeClass("active");
    displayVGjson('C-3107.json');
  };

  document.getElementById("example8").onclick = function() {
    $("#example1").removeClass("active");
    displayVGjson('DRA-3122.json');
  };

  document.getElementById("parseButton").onclick = function() {
    $("#example1").removeClass("active");
    var vg = JSON.parse(document.getElementById("textarea1").value);
    var nodes = sequenceTubeMap.vgExtractNodes(vg);
    var tracks = sequenceTubeMap.vgExtractTracks(vg);
    if (removeRedundantNodes) {
      var NodesAndTracks = sequenceTubeMap.vgMergeNodes(nodes, tracks);
      sequenceTubeMap.create(svg, NodesAndTracks.nodes, NodesAndTracks.tracks);
    } else {
      sequenceTubeMap.create(svg, nodes, tracks);
    }
  };

  document.getElementById('inputFile').addEventListener('change', function(e) {
    var file = document.getElementById('inputFile').files[0];
    var reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById("textarea1").value = reader.result;
		};
		reader.readAsText(file);
  });

  document.getElementById("redundantNodesCheckbox").onclick = function() {
    removeRedundantNodes = !removeRedundantNodes;
  };

  var removeRedundantNodes = false;

  var inputNodes = [
    { name: "A", width: 1},
    { name: "B", width: 2},
    { name: "C", width: 1},
    { name: "D", width: 3},
    { name: "E", width: 1},
    { name: "F", width: 1},
    { name: "G", width: 3},
    { name: "H", width: 1},
    { name: "I", width: 1},
    { name: "J", width: 3},
    { name: "K", width: 1},
    { name: "L", width: 1},
    { name: "M", width: 1},
    { name: "N", width: 1},
    { name: "O", width: 1},
    { name: "P", width: 2},
    { name: "Q", width: 1},
    { name: "R", width: 1},
    { name: "S", width: 2},
    { name: "T", width: 3},
    { name: "U", width: 1},
    { name: "V", width: 1},
    { name: "W", width: 8},
    { name: "X", width: 1},
    { name: "Y", width: 1},
    { name: "Z", width: 1},
    { name: "AA", width: 1},
    { name: "AB", width: 1},
    { name: "AC", width: 1},
    { name: "AD", width: 1},
    { name: "AE", width: 1},
    { name: "AF", width: 1},
    { name: "AG", width: 3}
  ];

  var inputTracks1 = [
    {id: 0, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "U", "W", "X", "Z", "AA", "AE", "AG"]},
    {id: 1, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "Q", "S", "U", "AA", "AE", "AG"]},
    {id: 2, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "V", "W", "X", "Z", "AB", "AE", "AG"]},
    {id: 3, sequence: ["B", "C", "D", "E", "G", "H", "J", "L", "M", "N", "P", "R", "S", "U", "W", "Y", "Z", "AC", "AF", "AG"]},
    {id: 4, sequence: ["B", "D", "F", "G", "I", "J", "L", "M", "O", "P", "Q", "S", "T", "V", "W", "Y", "Z", "AD", "AF", "AG"]}
  ];

  var inputTracks2 = [
    {id: 0, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "U", "W", "X", "Z", "AA", "AE", "AG"]},
    {id: 1, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "Q", "S", "U", "AA", "AE", "AG"]},
    //{id: 2, sequence: ["A", "B", "D", "-H", "-G", "-E", "J", "K", "M", "N", "P", "Q", "S", "AB", "V", "W", "X", "-AE", "-AA", "-Z", "AG"]},
    {id: 2, sequence: ["A", "B", "D", "F", "-H", "-G", "-E", "J", "K", "M", "N", "P", "Q", "S", "AB", "V", "W", "X", "-AE", "-AA", "-Z", "AG"]},
    {id: 3, sequence: ["B", "C", "D", "E", "G", "H", "J", "L", "-P", "-N", "-M", "R", "S", "U", "W", "Y", "Z", "AC", "AF", "AG"]},
    //{id: 3, sequence: ["B", "D", "E", "G", "H", "J", "L", "-P", "-N", "-M", "R", "S", "U", "W", "Y", "Z", "AC", "AF", "AG"]},
    {id: 4, sequence: ["B", "D", "F", "-J", "-I", "-G", "L", "M", "O", "P", "Q", "S", "T", "V", "W", "Y", "Z", "AD", "AF", "AG"]}
    //{id: 4, sequence: ["B", "D", "F", "-J", "-I", "-G", "-E", "L", "M", "O", "P", "R", "S", "T", "V", "W", "Y", "Z", "AD", "AF", "AG"]}
    //{id: 4, sequence: ["B", "D", "-J", "-I", "-G", "-E", "L", "M", "O", "P", "Q", "S", "T", "V", "W", "Y", "Z", "AD", "AF", "AG"]}
  ];

  var inputTracks3 = [
    {id: 0, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "U", "W", "X", "Z", "AA", "AE", "AG"]},
    {id: 1, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "Q", "S", "U", "AA", "AE", "AG"]},
    {id: 2, sequence: ["A", "B", "D", "-H", "G", "-E", "J", "K", "M", "N", "P", "Q", "S", "AB", "V", "W", "X", "-AE", "-AA", "-Z", "AG"]},
    //{id: 2, sequence: ["A", "B", "D", "-H", "AB", "G", "-E", "J", "K", "M", "N", "P", "Q", "S", "V", "W", "X", "-AE", "-Z", "AG"]},
    {id: 3, sequence: ["B", "C", "D", "E", "G", "H", "J", "L", "-P", "-N", "-M", "R", "S", "U", "W", "Y", "Z", "AC", "AF", "AG"]},
    {id: 4, sequence: ["B", "D", "F", "G", "I", "J", "L", "M", "O", "P", "Q", "S", "T", "V", "W", "Y", "Z", "AD", "AF", "AG"]}
  ];

  var inputTracks4 = [
    //{id: 1, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "J", "N", "Q", "S", "U", "AA", "AE", "AG"]},
    {id: 0, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "U", "W", "X", "Z", "AA", "AE", "AG"]},
    {id: 1, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "J", "N", "Q", "S", "U", "AA", "AE", "AG"]},
    //{id: 1, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "J", "K", "J", "N", "Q", "S", "U", "AA", "AE", "AG"]}, //double repeat
    //{id: 1, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "J", "K", "J", "J", "N", "Q", "S", "U", "AA", "AE", "AG"]}, //max. call stack size exceeded ???
    {id: 2, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "V", "W", "X", "Z", "AB", "AE", "AG"]},
    {id: 3, sequence: ["B", "C", "D", "E", "D", "E", "G", "H", "J", "L", "M", "N", "P", "R", "S", "U", "W", "Y", "Z", "AC", "AF", "AG"]},
    {id: 4, sequence: ["B", "D", "F", "G", "I", "J", "L", "M", "O", "P", "Q", "S", "T", "V", "W", "Y", "Z", "AD", "AF", "AG"]}
  ];

  var inputTracks5 = [
    {id: 0, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "U", "W", "X", "Z", "AA", "AE", "AG"]},
    //{id: 1, sequence: ["A", "B", "D", "E", "G", "H", "M", "J", "K", "N", "Q", "S", "U", "AA", "AE", "AG"]},
    {id: 1, sequence: ["A", "B", "D", "E", "G", "H", "J", "Q", "K", "M", "N", "S", "U", "AA", "AE", "AG"]},
    {id: 2, sequence: ["A", "B", "D", "E", "G", "H", "J", "K", "M", "N", "P", "Q", "S", "V", "W", "X", "Z", "AB", "AE", "AG"]},
    {id: 3, sequence: ["B", "C", "D", "H", "E", "G", "J", "L", "M", "N", "P", "R", "S", "U", "W", "Y", "Z", "AC", "AF", "AG"]},
    {id: 4, sequence: ["B", "D", "F", "G", "I", "J", "L", "M", "O", "P", "Q", "S", "T", "V", "W", "Y", "Z", "AD", "AF", "AG"]}
  ];

  var svg = d3.select("#chart0") //Create SVG element
    .append("svg");
    //.attr("width", 1600)
    //.attr("height", 500);

  function loadJSON(filename, callback) {
    var xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
    xobj.open('GET', filename, true);
    xobj.onreadystatechange = function () {
          if (xobj.readyState == 4 && xobj.status == "200") {
            callback(xobj.responseText);
          }
    };
    xobj.send(null);
   }

  function displayVGjson(filename) {
    loadJSON(filename, function(response) {
      var vg = JSON.parse(response);
      var nodes = sequenceTubeMap.vgExtractNodes(vg);
      var tracks = sequenceTubeMap.vgExtractTracks(vg);
      if (removeRedundantNodes) {
        var NodesAndTracks = sequenceTubeMap.vgMergeNodes(nodes, tracks);
        sequenceTubeMap.create(svg, NodesAndTracks.nodes, NodesAndTracks.tracks);
      } else {
        sequenceTubeMap.create(svg, nodes, tracks);
      }
    });
  }

  document.getElementById("example1").click();

</script>
</body>
</html>
